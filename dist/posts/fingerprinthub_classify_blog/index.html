<!DOCTYPE html><html lang="zh-CN" class="scroll-smooth"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Mr. Feng — 暗黑科技博客</title><meta name="description" content="编程不仅是科学，也是艺术。在代码中，我们找到了表达自我和解决问题的新途径。"><link rel="stylesheet" href="/my-blog/_astro/about.CNZkhIex.css">
<style>.prose[data-astro-cid-gjtny2mx]{color:#fff}.prose[data-astro-cid-gjtny2mx] h1[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h2[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h3[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h4[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h5[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h6[data-astro-cid-gjtny2mx]{color:#fff;font-weight:700}.prose[data-astro-cid-gjtny2mx] h2[data-astro-cid-gjtny2mx]{border-bottom:2px solid rgba(0,255,136,.3);padding-bottom:.75rem;margin-top:2.5rem;margin-bottom:1.5rem;color:#0f8;text-shadow:0 0 10px rgba(0,255,136,.3)}.prose[data-astro-cid-gjtny2mx] h3[data-astro-cid-gjtny2mx]{color:#0f8;margin-top:2rem;margin-bottom:1rem}.prose[data-astro-cid-gjtny2mx] a[data-astro-cid-gjtny2mx]{color:#0f8;text-decoration:none;text-shadow:0 0 5px rgba(0,255,136,.3)}.prose[data-astro-cid-gjtny2mx] a[data-astro-cid-gjtny2mx]:hover{color:#fff;text-shadow:0 0 10px #00ff88;text-decoration:underline}.prose[data-astro-cid-gjtny2mx] code[data-astro-cid-gjtny2mx]{background:#00ff8826;border:1px solid rgba(0,255,136,.3);border-radius:.375rem;padding:.25rem .5rem;color:#0f8;font-size:.9em;font-weight:600}.prose[data-astro-cid-gjtny2mx] pre[data-astro-cid-gjtny2mx]{background:#0a0a0a;border:1px solid rgba(0,255,136,.3);border-radius:.75rem;padding:1.5rem;overflow-x:auto;box-shadow:0 0 20px #00ff881a}.prose[data-astro-cid-gjtny2mx] pre[data-astro-cid-gjtny2mx] code[data-astro-cid-gjtny2mx]{background:transparent;border:none;padding:0;color:#fff;text-shadow:none;font-weight:400}.prose[data-astro-cid-gjtny2mx] blockquote[data-astro-cid-gjtny2mx]{border-left:4px solid #00ff88;background:#00ff880d;margin:1.5rem 0;padding:1rem 1.5rem;font-style:italic;border-radius:0 .5rem .5rem 0}.prose[data-astro-cid-gjtny2mx] ul[data-astro-cid-gjtny2mx] li[data-astro-cid-gjtny2mx]::marker,.prose[data-astro-cid-gjtny2mx] ol[data-astro-cid-gjtny2mx] li[data-astro-cid-gjtny2mx]::marker{color:#0f8}.prose[data-astro-cid-gjtny2mx] strong[data-astro-cid-gjtny2mx]{color:#fff;font-weight:700}.prose[data-astro-cid-gjtny2mx] p[data-astro-cid-gjtny2mx]{line-height:1.8;margin-bottom:1.25rem}
</style>
<link rel="stylesheet" href="/my-blog/_astro/fingerprinthub_classify_blog.f-DxDeVJ.css"></head> <body class="dark-bg grid-bg min-h-screen text-white font-sans relative overflow-x-hidden"> <!-- 增强的粒子背景 --> <div class="particles" id="particles"></div> <header class="bg-black/80 backdrop-blur-md border-b border-neon-green/30 sticky top-0 z-50"> <div class="max-w-6xl mx-auto px-4 flex items-center justify-between h-16"> <!-- Logo --> <a href="/my-blog/" class="flex items-center space-x-3 group"> <div class="w-12 h-12"> <!-- 代码风格Logo图标 - 基于第一个设计方案 --><svg viewBox="0 0 48 48" class="w-full h-full" data-astro-cid-hit3dubr> <defs data-astro-cid-hit3dubr> <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%" data-astro-cid-hit3dubr> <stop offset="0%" style="stop-color:#00ff88;stop-opacity:1" data-astro-cid-hit3dubr></stop> <stop offset="100%" style="stop-color:#3742fa;stop-opacity:1" data-astro-cid-hit3dubr></stop> </linearGradient> <filter id="logoGlow" data-astro-cid-hit3dubr> <feGaussianBlur stdDeviation="2" result="coloredBlur" data-astro-cid-hit3dubr></feGaussianBlur> <feMerge data-astro-cid-hit3dubr> <feMergeNode in="coloredBlur" data-astro-cid-hit3dubr></feMergeNode> <feMergeNode in="SourceGraphic" data-astro-cid-hit3dubr></feMergeNode> </feMerge> </filter> </defs> <!-- 外框 --> <rect x="2" y="2" width="44" height="44" fill="none" stroke="url(#logoGrad)" stroke-width="2" rx="8" filter="url(#logoGlow)" class="group-hover:stroke-width-3 transition-all duration-300" data-astro-cid-hit3dubr></rect> <!-- 字母F的代码风格设计 --> <path d="M12 12 L32 12 M12 12 L12 36 M12 24 L28 24" stroke="#00ff88" stroke-width="3" stroke-linecap="round" fill="none" filter="url(#logoGlow)" class="group-hover:stroke-white transition-all duration-300" data-astro-cid-hit3dubr></path> <!-- 装饰点 --> <circle cx="36" cy="16" r="2" fill="#00ff88" class="animate-pulse group-hover:fill-white transition-all duration-300" data-astro-cid-hit3dubr></circle> <circle cx="36" cy="28" r="1.5" fill="#3742fa" class="animate-pulse group-hover:fill-white transition-all duration-300" style="animation-delay: 0.5s" data-astro-cid-hit3dubr></circle> </svg>  </div> <span class="font-bold text-2xl neon-logo group-hover:neon-logo transition-all duration-300">
MR.FENG
</span> </a> <!-- 导航菜单 --> <nav class="hidden md:flex items-center space-x-8"> <a href="/my-blog/" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
首页
</a> <a href="/my-blog/categories" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
分类
</a> <a href="/my-blog/tags" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
标签
</a> <a href="/my-blog/about" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
关于
</a> </nav> <!-- 右侧工具栏 --> <div class="flex items-center space-x-4"> <div class="relative"> <input id="search-input" type="search" placeholder="搜索文章…" class="dark-input w-full sm:w-64 px-4 py-2 text-sm placeholder-gray-400"> <ul id="search-results" class="absolute top-full mt-2 w-full sm:w-96 bg-black/90 backdrop-blur-md border border-neon-green/30 rounded-lg shadow-2xl max-h-60 overflow-y-auto hidden z-50"></ul> </div> <script type="module">
  import Fuse from 'https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.esm.min.js';

  const input = document.getElementById('search-input');
  const resultsEl = document.getElementById('search-results');
  let fuse;

  async function initSearch() {
    const res = await fetch('/my-blog/search.json');
    const data = await res.json();
    fuse = new Fuse(data, {
      keys: ['title', 'content', 'category', 'tags'],
      threshold: 0.3,
      ignoreLocation: true,
    });
  }

  function render(results) {
    if (!results.length) {
      resultsEl.innerHTML = '<li class="p-4 text-center text-gray-400">无匹配结果</li>';
      return;
    }
    resultsEl.innerHTML = results
      .slice(0, 8)
      .map(r => `
        <li>
          <a href="${r.item.url}" class="block px-4 py-3 text-white hover:bg-neon-green/10 hover:border-l-2 hover:border-neon-green transition-all duration-300 border-l-2 border-transparent">
            <div class="font-medium">${r.item.title}</div>
            <div class="text-xs text-gray-400 mt-1">${r.item.category || '未分类'}</div>
          </a>
        </li>
      `) 
      .join('');
  }

  input.addEventListener('focus', () => {
    resultsEl.classList.remove('hidden');
    if (!fuse) initSearch();
  });

  document.addEventListener('click', (e) => {
    if (!input.contains(e.target) && !resultsEl.contains(e.target)) {
      resultsEl.classList.add('hidden');
    }
  });

  input.addEventListener('input', () => {
    if (!fuse) return;
    const q = input.value.trim();
    if (!q) {
      resultsEl.innerHTML = '';
      return;
    }
    const results = fuse.search(q);
    render(results);
  });
</script> <button id="theme-toggle" aria-label="切换暗色模式" class="w-9 h-9 rounded-full flex items-center justify-center hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"> <svg id="icon-sun" class="w-5 h-5 hidden" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"> <path d="M12 4.5V2m0 20v-2.5m7.778-12.728l1.768-1.768M2.454 21.546l1.768-1.768m0-14.556L2.454 4.454m18.092 16.092l-1.768-1.768M4.5 12H2m20 0h-2.5M6.222 17.778l-1.768 1.768m16.092-18.092l-1.768 1.768" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg id="icon-moon" class="w-5 h-5 hidden" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"> <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z"></path> </svg> </button> <script type="module">const l=document.getElementById("theme-toggle"),t=document.getElementById("icon-sun"),o=document.getElementById("icon-moon");if(l&&t&&o){const n=d=>{d?(o.style.display="none",t.style.display="block"):(t.style.display="none",o.style.display="block")},c=window.matchMedia("(prefers-color-scheme: dark)").matches,s=localStorage.getItem("theme");let e=s?s==="dark":c;document.documentElement.classList.toggle("dark",e),n(e),l.addEventListener("click",()=>{e=!e,document.documentElement.classList.toggle("dark",e),localStorage.setItem("theme",e?"dark":"light"),n(e)})}</script> <!-- 移动端菜单按钮 --> <button class="md:hidden p-2 text-white hover:neon-text transition-all duration-300" id="mobile-menu-btn"> <div class="w-6 h-0.5 bg-current mb-1 transition-all duration-300"></div> <div class="w-6 h-0.5 bg-current mb-1 transition-all duration-300"></div> <div class="w-6 h-0.5 bg-current transition-all duration-300"></div> </button> </div> </div> <!-- 移动端菜单 --> <div class="md:hidden bg-black/90 backdrop-blur-md border-t border-neon-green/30 hidden" id="mobile-menu"> <div class="px-4 py-6 space-y-4"> <a href="/my-blog/" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">首页</a> <a href="/my-blog/categories" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">分类</a> <a href="/my-blog/tags" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">标签</a> <a href="/my-blog/about" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">关于</a> </div> </div> </header> <script type="module">document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("mobile-menu-btn"),n=document.getElementById("mobile-menu");t?.addEventListener("click",()=>{n?.classList.toggle("hidden");const e=t.querySelectorAll("div");n?.classList.contains("hidden")?(e[0].style.transform="rotate(0deg)",e[1].style.opacity="1",e[2].style.transform="rotate(0deg)"):(e[0].style.transform="rotate(45deg) translate(5px, 5px)",e[1].style.opacity="0",e[2].style.transform="rotate(-45deg) translate(7px, -6px)")})});</script> <main class="max-w-6xl mx-auto px-4 py-8 relative z-10">   <nav class="mb-8 text-sm" data-astro-cid-gjtny2mx> <div class="flex items-center space-x-3 text-gray-400" data-astro-cid-gjtny2mx> <a href="/my-blog/" class="hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>首页</a> <span class="neon-text" data-astro-cid-gjtny2mx>•</span> <a href="/my-blog/categories" class="hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>分类</a> <span class="neon-text" data-astro-cid-gjtny2mx>•</span> <span class="neon-text font-bold" data-astro-cid-gjtny2mx>网络安全</span> </div> </nav>  <header class="mb-12" data-astro-cid-gjtny2mx> <div class="dark-card p-10 rounded-xl" data-astro-cid-gjtny2mx> <!-- 分类标签 --> <div class="mb-6" data-astro-cid-gjtny2mx> <span class="px-4 py-2 text-sm font-bold bg-neon-green/20 text-neon-green rounded-full border border-neon-green/40 uppercase tracking-wider" data-astro-cid-gjtny2mx> 网络安全 </span> </div> <!-- 文章标题 --> <h1 class="text-4xl md:text-5xl font-black text-white mb-6 leading-tight" data-astro-cid-gjtny2mx> 给 Nuclei 模板做自动分类 —— 一个编辑距离算法的进化历程 </h1> <!-- 文章描述 --> <p class="text-xl text-gray-300 mb-8 leading-relaxed" data-astro-cid-gjtny2mx> 记录一下怎么用编辑距离算法把 Nuclei 模板和 FingerprintHub 自动匹配分类的过程，从自己手写到用现成库优化的折腾经历 </p> <!-- 文章元信息 --> <div class="flex flex-wrap items-center gap-6 text-sm" data-astro-cid-gjtny2mx> <div class="flex items-center space-x-3" data-astro-cid-gjtny2mx> <div class="w-3 h-3 bg-neon-green rounded-full animate-pulse" data-astro-cid-gjtny2mx></div> <time class="font-mono text-gray-300 bg-dark-600/50 px-3 py-1 rounded" data-astro-cid-gjtny2mx> 2024年1月16日 </time> </div> <div class="flex items-center space-x-3" data-astro-cid-gjtny2mx> <div class="w-3 h-3 bg-neon-blue rounded-full animate-pulse" data-astro-cid-gjtny2mx></div> <div class="flex gap-2 flex-wrap" data-astro-cid-gjtny2mx> <span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#Nuclei </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#FingerprintHub </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#编辑距离 </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#自动化工具 </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#算法优化 </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#漏洞扫描 </span> </div> </div> </div> </div> </header>  <div class="grid lg:grid-cols-4 gap-8" data-astro-cid-gjtny2mx> <!-- 主要内容 --> <article class="lg:col-span-3" data-astro-cid-gjtny2mx> <div class="dark-card p-10 rounded-xl" data-astro-cid-gjtny2mx> <div class="prose prose-invert prose-lg max-w-none" data-astro-cid-gjtny2mx> <h1 id="给-nuclei-模板做自动分类--一个编辑距离算法的进化历程">给 Nuclei 模板做自动分类 —— 一个编辑距离算法的进化历程</h1>
<blockquote>
<p>最近在搞 Nuclei 模板分类，踩了不少坑，记录一下整个过程。</p>
</blockquote>
<h2 id="1-为啥要搞这个事">1. 为啥要搞这个事</h2>
<p>大家都知道，做渗透测试的时候一般都是先识别指纹，然后根据指纹选对应的漏洞模板去扫，这是很常见的套路。所以把 <strong>FingerprintHub</strong> 和 <strong>Nuclei</strong> 结合起来做自动化扫描是个挺不错的想法。</p>
<p>但是有个问题：要实现自动化，就得把 <strong>Nuclei</strong> 的模板和 <strong>FingerprintHub</strong> 里的产品一一对应起来，让脚本知道识别到什么指纹就用什么模板去扫。</p>
<p>问题来了：<strong>Nuclei</strong> 模板太多了，而且命名完全不统一。你想啊，同一个产品可能有不同的大小写、版本号、分隔符，甚至各种缩写，简单的关键词匹配根本搞不定。所以我就想到用 <strong>字符串相似度算法</strong> 来让匹配更准更快。</p>
<hr/>
<h2 id="2-试过的几条弯路">2. 试过的几条”弯路”</h2>

























<table><thead><tr><th>方案</th><th>我是怎么想的</th><th>结果踩坑了</th></tr></thead><tbody><tr><td><strong>Jaccard / Cosine</strong></td><td>把名字拆成词，然后做集合/向量比较</td><td>对中文、厂商缩写效果一般；格式差异导致相似度贼低</td></tr><tr><td><strong>N-gram + 余弦</strong></td><td>按窗口拆字符，再做余弦计算</td><td>对短字符串（常见 3〜15 字符）噪声太大</td></tr><tr><td><strong>正则 &amp; 手工规则</strong></td><td>针对常见前缀/后缀写规则</td><td>规则越写越多，维护起来要命</td></tr></tbody></table>
<p>这些方案多少都能提高点命中率，但想写个”一劳永逸”的脚本基本不可能。最后我还是回到了 <strong>编辑距离（Levenshtein）</strong> —— 这玩意儿天然就能算出两个字符串的最小变更成本。</p>
<hr/>
<h2 id="3-第一版自己手撸-levenshtein看着挺优雅就是慢得要死">3. 第一版：自己手撸 Levenshtein，看着挺优雅，就是慢得要死</h2>
<p>第一版我直接自己写了个经典的动态规划实现：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> re</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> clean_name</span><span style="color:#E1E4E8">(name):</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;&quot;&quot;清理产品名称，去除特殊字符&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">    name </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> re.sub(</span><span style="color:#F97583">r</span><span style="color:#9ECBFF">&#39;</span><span style="color:#79B8FF">[</span><span style="color:#F97583">^</span><span style="color:#79B8FF">\w\s</span><span style="color:#85E89D;font-weight:bold">\-</span><span style="color:#79B8FF">]</span><span style="color:#9ECBFF">&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&#39;&#39;</span><span style="color:#E1E4E8">, name)</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> name.strip()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> levenshtein_distance</span><span style="color:#E1E4E8">(s1, s2):</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;&quot;&quot;计算编辑距离&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(s1) </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(s2):</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> levenshtein_distance(s2, s1)</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(s2) </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(s1)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    previous_row </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> list</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">range</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">len</span><span style="color:#E1E4E8">(s2) </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">))</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i, c1 </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> enumerate</span><span style="color:#E1E4E8">(s1):</span></span>
<span class="line"><span style="color:#E1E4E8">        current_row </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [i </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> j, c2 </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> enumerate</span><span style="color:#E1E4E8">(s2):</span></span>
<span class="line"><span style="color:#E1E4E8">            insertions </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> previous_row[j </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#E1E4E8">            deletions  </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> current_row[j]    </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#E1E4E8">            substitutions </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> previous_row[j] </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> (c1 </span><span style="color:#F97583">!=</span><span style="color:#E1E4E8"> c2)</span></span>
<span class="line"><span style="color:#E1E4E8">            current_row.append(</span><span style="color:#79B8FF">min</span><span style="color:#E1E4E8">(insertions, deletions, substitutions))</span></span>
<span class="line"><span style="color:#E1E4E8">        previous_row </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> current_row</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> previous_row[</span><span style="color:#F97583">-</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span></code></pre>
<p>结果呢？1.2万条模板 × 2.2万条指纹的全量比对，这段代码 <strong>单进程跑了 2 个多小时</strong>，CPU 风扇呼呼转得像飞机起飞。</p>
<hr/>
<h2 id="4-优化用-python-自带的-difflibsequencematcher">4. 优化①：用 Python 自带的 <code>difflib.SequenceMatcher</code></h2>
<p>后来我发现 Python 自带了 C 扩展的 <code>difflib</code> 模块，里面的 <code>SequenceMatcher</code> 对短字符串相似度挺友好的，于是重构了脚本，核心就一行：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> calculate_similarity</span><span style="color:#E1E4E8">(self, text1, text2):</span></span>
<span class="line"><span style="color:#9ECBFF">        &quot;&quot;&quot;计算两个文本的相似度&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#F97583"> not</span><span style="color:#E1E4E8"> text1 </span><span style="color:#F97583">or</span><span style="color:#F97583"> not</span><span style="color:#E1E4E8"> text2:</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> SequenceMatcher(</span><span style="color:#79B8FF">None</span><span style="color:#E1E4E8">, text1.lower(), text2.lower()).ratio()</span></span></code></pre>
<p>单进程时间压到了 <strong>30 分钟</strong>，进步不小，但还是不够快。</p>
<hr/>
<h2 id="5-优化上-python-levenshtein--多进程">5. 优化②：上 <code>python-Levenshtein</code> + 多进程</h2>
<p><code>python-Levenshtein</code> 这个库完全用 C 写的，单次计算的开销只有纯 Python 的 20% 左右。<br/>
同时，我用 <code>multiprocessing.Pool</code> 把指纹表切块并行处理，8 核 CPU 上直接把运行时间打到 <strong>5分 30 秒</strong> 左右，这下终于能满足日常批量任务了。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> Levenshtein </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> ratio</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> multiprocessing </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> Pool</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> worker</span><span style="color:#E1E4E8">(chunk):</span></span>
<span class="line"><span style="color:#6A737D">    # chunk 里装的是若干 (template, fingerprint) 对</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> [(t, f, ratio(t, f)) </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> t, f </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> chunk]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#79B8FF"> __name__</span><span style="color:#F97583"> ==</span><span style="color:#9ECBFF"> &quot;__main__&quot;</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">    with</span><span style="color:#E1E4E8"> Pool() </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> p:</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> result </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> p.imap_unordered(worker, split_chunks(data)):</span></span>
<span class="line"><span style="color:#E1E4E8">            save(result)</span></span></code></pre>
<hr/>
<h2 id="6-最终版本fingerprinthub_classifypy功能概览">6. 最终版本（<code>fingerprinthub_classify.py</code>）功能概览</h2>
<ul>
<li><strong>读取指纹库</strong>：遍历 FingerprintHub 目录，收集产品名称和关键词</li>
<li><strong>解析模板</strong>：提取 <code>name / description / tags / metadata</code> 这些信息</li>
<li><strong>相似度计算</strong>：用 <code>SequenceMatcher</code> 进行文本比对</li>
<li><strong>打分策略</strong>：
<ol>
<li>完全匹配加 10 分</li>
<li>关键词 / 标签匹配加 2-5 分</li>
<li>文件路径包含产品名加 2 分</li>
</ol>
</li>
<li><strong>阈值过滤</strong>：得分低于 3 的认为是”未知”，避免乱归类</li>
<li><strong>结果输出</strong>：生成 <code>fingerprinthub_classification.json</code> 并按产品名把模板复制到独立目录</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="python"><code><span class="line"><span style="color:#6A737D">#!/usr/bin/env python3</span></span>
<span class="line"><span style="color:#6A737D"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#9ECBFF">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#9ECBFF">基于FingerprintHub指纹库的Nuclei模板智能归类脚本</span></span>
<span class="line"><span style="color:#9ECBFF">将Nuclei模板按FingerprintHub的产品分类进行归类，实现一一对应</span></span>
<span class="line"><span style="color:#9ECBFF">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> os</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> json</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> yaml</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> re</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> pathlib </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> Path</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> collections </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> defaultdict</span></span>
<span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> difflib </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> SequenceMatcher</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> FingerprintHubClassifier</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#79B8FF"> __init__</span><span style="color:#E1E4E8">(self, fingerprinthub_dir</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&quot;FingerprintHub&quot;</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#79B8FF">        self</span><span style="color:#E1E4E8">.fingerprinthub_dir </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Path(fingerprinthub_dir)</span></span>
<span class="line"><span style="color:#79B8FF">        self</span><span style="color:#E1E4E8">.product_names </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> set</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#79B8FF">        self</span><span style="color:#E1E4E8">.product_keywords </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> defaultdict(</span><span style="color:#79B8FF">list</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">        self</span><span style="color:#E1E4E8">.load_fingerprinthub_products()</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> load_fingerprinthub_products</span><span style="color:#E1E4E8">(self):</span></span>
<span class="line"><span style="color:#9ECBFF">        &quot;&quot;&quot;加载FingerprintHub的所有产品名和关键词&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#79B8FF">        print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;正在加载FingerprintHub产品库...&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # 1. 从web-fingerprint目录加载</span></span>
<span class="line"><span style="color:#E1E4E8">        web_fp_dir </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.fingerprinthub_dir </span><span style="color:#F97583">/</span><span style="color:#9ECBFF"> &quot;web-fingerprint&quot;</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> web_fp_dir.exists():</span></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> product_dir </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> web_fp_dir.iterdir():</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> product_dir.is_dir():</span></span>
<span class="line"><span style="color:#E1E4E8">                    product_name </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> product_dir.name</span></span>
<span class="line"><span style="color:#79B8FF">                    self</span><span style="color:#E1E4E8">.product_names.add(product_name)</span></span>
<span class="line"><span style="color:#6A737D">                    # 加载该产品的所有指纹文件</span></span>
<span class="line"><span style="color:#F97583">                    for</span><span style="color:#E1E4E8"> fp_file </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> product_dir.rglob(</span><span style="color:#9ECBFF">&quot;*.yaml&quot;</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#79B8FF">                        self</span><span style="color:#E1E4E8">.load_fingerprint_keywords(fp_file, product_name)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # 2. 从service-fingerprint目录加载</span></span>
<span class="line"><span style="color:#E1E4E8">        service_fp_dir </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.fingerprinthub_dir </span><span style="color:#F97583">/</span><span style="color:#9ECBFF"> &quot;service-fingerprint&quot;</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> service_fp_dir.exists():</span></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> product_dir </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> service_fp_dir.iterdir():</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> product_dir.is_dir():</span></span>
<span class="line"><span style="color:#E1E4E8">                    product_name </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> product_dir.name</span></span>
<span class="line"><span style="color:#79B8FF">                    self</span><span style="color:#E1E4E8">.product_names.add(product_name)</span></span>
<span class="line"><span style="color:#6A737D">                    # 加载该产品的所有指纹文件</span></span>
<span class="line"><span style="color:#F97583">                    for</span><span style="color:#E1E4E8"> fp_file </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> product_dir.rglob(</span><span style="color:#9ECBFF">&quot;*.yaml&quot;</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#79B8FF">                        self</span><span style="color:#E1E4E8">.load_fingerprint_keywords(fp_file, product_name)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # 3. 从plugins目录加载</span></span>
<span class="line"><span style="color:#E1E4E8">        plugins_dir </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.fingerprinthub_dir </span><span style="color:#F97583">/</span><span style="color:#9ECBFF"> &quot;plugins&quot;</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> plugins_dir.exists():</span></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> product_dir </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> plugins_dir.iterdir():</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> product_dir.is_dir():</span></span>
<span class="line"><span style="color:#E1E4E8">                    product_name </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> product_dir.name</span></span>
<span class="line"><span style="color:#79B8FF">                    self</span><span style="color:#E1E4E8">.product_names.add(product_name)</span></span>
<span class="line"><span style="color:#6A737D">                    # 加载该产品的所有指纹文件</span></span>
<span class="line"><span style="color:#F97583">                    for</span><span style="color:#E1E4E8"> fp_file </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> product_dir.rglob(</span><span style="color:#9ECBFF">&quot;*.yaml&quot;</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#79B8FF">                        self</span><span style="color:#E1E4E8">.load_fingerprint_keywords(fp_file, product_name)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#79B8FF">        print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">&quot;已加载 </span><span style="color:#79B8FF">{len</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">self</span><span style="color:#E1E4E8">.product_names)</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF"> 个产品，</span><span style="color:#79B8FF">{sum</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">len</span><span style="color:#E1E4E8">(keywords) </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> keywords </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.product_keywords.values())</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF"> 个关键词&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> load_fingerprint_keywords</span><span style="color:#E1E4E8">(self, fp_file, product_name):</span></span>
<span class="line"><span style="color:#9ECBFF">        &quot;&quot;&quot;从指纹文件中提取关键词&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#F97583">        try</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">            with</span><span style="color:#79B8FF"> open</span><span style="color:#E1E4E8">(fp_file, </span><span style="color:#9ECBFF">&#39;r&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">encoding</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;utf-8&#39;</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> f:</span></span>
<span class="line"><span style="color:#E1E4E8">                data </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> yaml.safe_load(f)</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#F97583"> not</span><span style="color:#E1E4E8"> data:</span></span>
<span class="line"><span style="color:#F97583">                    return</span></span>
<span class="line"><span style="color:#E1E4E8">                </span></span>
<span class="line"><span style="color:#6A737D">                # 提取关键词</span></span>
<span class="line"><span style="color:#E1E4E8">                keywords </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#E1E4E8">                </span></span>
<span class="line"><span style="color:#6A737D">                # 从info.name提取</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#9ECBFF"> &#39;info&#39;</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> data </span><span style="color:#F97583">and</span><span style="color:#9ECBFF"> &#39;name&#39;</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> data[</span><span style="color:#9ECBFF">&#39;info&#39;</span><span style="color:#E1E4E8">]:</span></span>
<span class="line"><span style="color:#E1E4E8">                    keywords.append(data[</span><span style="color:#9ECBFF">&#39;info&#39;</span><span style="color:#E1E4E8">][</span><span style="color:#9ECBFF">&#39;name&#39;</span><span style="color:#E1E4E8">].lower())</span></span>
<span class="line"><span style="color:#E1E4E8">                </span></span>
<span class="line"><span style="color:#6A737D">                # 从metadata.product提取</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#9ECBFF"> &#39;metadata&#39;</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> data </span><span style="color:#F97583">and</span><span style="color:#9ECBFF"> &#39;product&#39;</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> data[</span><span style="color:#9ECBFF">&#39;metadata&#39;</span><span style="color:#E1E4E8">]:</span></span>
<span class="line"><span style="color:#E1E4E8">                    keywords.append(data[</span><span style="color:#9ECBFF">&#39;metadata&#39;</span><span style="color:#E1E4E8">][</span><span style="color:#9ECBFF">&#39;product&#39;</span><span style="color:#E1E4E8">].lower())</span></span>
<span class="line"><span style="color:#E1E4E8">                </span></span>
<span class="line"><span style="color:#6A737D">                # 从tags提取</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#9ECBFF"> &#39;info&#39;</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> data </span><span style="color:#F97583">and</span><span style="color:#9ECBFF"> &#39;tags&#39;</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> data[</span><span style="color:#9ECBFF">&#39;info&#39;</span><span style="color:#E1E4E8">]:</span></span>
<span class="line"><span style="color:#E1E4E8">                    tags </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> data[</span><span style="color:#9ECBFF">&#39;info&#39;</span><span style="color:#E1E4E8">][</span><span style="color:#9ECBFF">&#39;tags&#39;</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#F97583">                    if</span><span style="color:#79B8FF"> isinstance</span><span style="color:#E1E4E8">(tags, </span><span style="color:#79B8FF">list</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#E1E4E8">                        keywords.extend([tag.lower() </span><span style="color:#F97583">for</span><span style="color:#E1E4E8"> tag </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> tags </span><span style="color:#F97583">if</span><span style="color:#E1E4E8"> tag.lower() </span><span style="color:#F97583">not</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">&#39;detect&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&#39;tech&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&#39;service&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&#39;web&#39;</span><span style="color:#E1E4E8">]])</span></span>
<span class="line"><span style="color:#E1E4E8">                </span></span>
<span class="line"><span style="color:#6A737D">                # 从http matchers提取</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#9ECBFF"> &#39;http&#39;</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> data:</span></span>
<span class="line"><span style="color:#F97583">                    for</span><span style="color:#E1E4E8"> http_item </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> data[</span><span style="color:#9ECBFF">&#39;http&#39;</span><span style="color:#E1E4E8">]:</span></span>
<span class="line"><span style="color:#F97583">                        if</span><span style="color:#9ECBFF"> &#39;matchers&#39;</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> http_item:</span></span>
<span class="line"><span style="color:#F97583">                            for</span><span style="color:#E1E4E8"> matcher </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> http_item[</span><span style="color:#9ECBFF">&#39;matchers&#39;</span><span style="color:#E1E4E8">]:</span></span>
<span class="line"><span style="color:#F97583">                                if</span><span style="color:#9ECBFF"> &#39;words&#39;</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> matcher:</span></span>
<span class="line"><span style="color:#F97583">                                    for</span><span style="color:#E1E4E8"> word </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> matcher[</span><span style="color:#9ECBFF">&#39;words&#39;</span><span style="color:#E1E4E8">]:</span></span>
<span class="line"><span style="color:#6A737D">                                        # 提取产品相关的关键词</span></span>
<span class="line"><span style="color:#F97583">                                        if</span><span style="color:#79B8FF"> isinstance</span><span style="color:#E1E4E8">(word, </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">and</span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(word) </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#6A737D">                                            # 过滤掉HTML标签、通用词汇等</span></span>
<span class="line"><span style="color:#E1E4E8">                                            clean_word </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> re.sub(</span><span style="color:#F97583">r</span><span style="color:#9ECBFF">&#39;</span><span style="color:#79B8FF">[&lt;&gt;&quot;/\s]</span><span style="color:#9ECBFF">&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&#39;&#39;</span><span style="color:#E1E4E8">, word)</span></span>
<span class="line"><span style="color:#F97583">                                            if</span><span style="color:#E1E4E8"> clean_word </span><span style="color:#F97583">and</span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(clean_word) </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">                                                keywords.append(clean_word.lower())</span></span>
<span class="line"><span style="color:#E1E4E8">                </span></span>
<span class="line"><span style="color:#6A737D">                # 添加到产品关键词库</span></span>
<span class="line"><span style="color:#F97583">                for</span><span style="color:#E1E4E8"> keyword </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> keywords:</span></span>
<span class="line"><span style="color:#F97583">                    if</span><span style="color:#E1E4E8"> keyword </span><span style="color:#F97583">and</span><span style="color:#E1E4E8"> keyword </span><span style="color:#F97583">not</span><span style="color:#F97583"> in</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.product_keywords[product_name]:</span></span>
<span class="line"><span style="color:#79B8FF">                        self</span><span style="color:#E1E4E8">.product_keywords[product_name].append(keyword)</span></span>
<span class="line"><span style="color:#E1E4E8">                        </span></span>
<span class="line"><span style="color:#F97583">        except</span><span style="color:#79B8FF"> Exception</span><span style="color:#F97583"> as</span><span style="color:#E1E4E8"> e:</span></span>
<span class="line"><span style="color:#79B8FF">            print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">&quot;加载指纹文件 </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">fp_file</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF"> 时出错: </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">e</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> extract_nuclei_info</span><span style="color:#E1E4E8">(self, yaml_file):</span></span>
<span class="line"><span style="color:#9ECBFF">        &quot;&quot;&quot;从Nuclei模板中提取关键信息&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#F97583">        try</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">            with</span><span style="color:#79B8FF"> open</span><span style="color:#E1E4E8">(yaml_file, </span><span style="color:#9ECBFF">&#39;r&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">encoding</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;utf-8&#39;</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> f:</span></span>
<span class="line"><span style="color:#E1E4E8">                data </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> yaml.safe_load(f)</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#F97583"> not</span><span style="color:#E1E4E8"> data:</span></span>
<span class="line"><span style="color:#F97583">                    return</span><span style="color:#E1E4E8"> {}</span></span>
<span class="line"><span style="color:#E1E4E8">                </span></span>
<span class="line"><span style="color:#E1E4E8">                info </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#9ECBFF">                    &#39;path&#39;</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(yaml_file),</span></span>
<span class="line"><span style="color:#9ECBFF">                    &#39;id&#39;</span><span style="color:#E1E4E8">: data.get(</span><span style="color:#9ECBFF">&#39;id&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&#39;&#39;</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#9ECBFF">                    &#39;name&#39;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&#39;&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">                    &#39;description&#39;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&#39;&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">                    &#39;tags&#39;</span><span style="color:#E1E4E8">: [],</span></span>
<span class="line"><span style="color:#9ECBFF">                    &#39;product&#39;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&#39;&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">                    &#39;vendor&#39;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&#39;&#39;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">                    &#39;reference&#39;</span><span style="color:#E1E4E8">: []</span></span>
<span class="line"><span style="color:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#E1E4E8">                </span></span>
<span class="line"><span style="color:#6A737D">                # 提取info字段</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#9ECBFF"> &#39;info&#39;</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> data:</span></span>
<span class="line"><span style="color:#E1E4E8">                    info_data </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> data[</span><span style="color:#9ECBFF">&#39;info&#39;</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">                    info[</span><span style="color:#9ECBFF">&#39;name&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> info_data.get(</span><span style="color:#9ECBFF">&#39;name&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&#39;&#39;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                    info[</span><span style="color:#9ECBFF">&#39;description&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> info_data.get(</span><span style="color:#9ECBFF">&#39;description&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&#39;&#39;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                    info[</span><span style="color:#9ECBFF">&#39;tags&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> info_data.get(</span><span style="color:#9ECBFF">&#39;tags&#39;</span><span style="color:#E1E4E8">, [])</span></span>
<span class="line"><span style="color:#E1E4E8">                    info[</span><span style="color:#9ECBFF">&#39;reference&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> info_data.get(</span><span style="color:#9ECBFF">&#39;reference&#39;</span><span style="color:#E1E4E8">, [])</span></span>
<span class="line"><span style="color:#E1E4E8">                </span></span>
<span class="line"><span style="color:#6A737D">                # 提取metadata字段</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#9ECBFF"> &#39;metadata&#39;</span><span style="color:#F97583"> in</span><span style="color:#E1E4E8"> data:</span></span>
<span class="line"><span style="color:#E1E4E8">                    metadata </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> data[</span><span style="color:#9ECBFF">&#39;metadata&#39;</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">                    info[</span><span style="color:#9ECBFF">&#39;product&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> metadata.get(</span><span style="color:#9ECBFF">&#39;product&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&#39;&#39;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                    info[</span><span style="color:#9ECBFF">&#39;vendor&#39;</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> metadata.get(</span><span style="color:#9ECBFF">&#39;vendor&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&#39;&#39;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                </span></span>
<span class="line"><span style="color:#F97583">                return</span><span style="color:#E1E4E8"> info</span></span>
<span class="line"><span style="color:#E1E4E8">                </span></span>
<span class="line"><span style="color:#F97583">        except</span><span style="color:#79B8FF"> Exception</span><span style="color:#F97583"> as</span><span style="color:#E1E4E8"> e:</span></span>
<span class="line"><span style="color:#79B8FF">            print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">&quot;解析Nuclei模板 </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">yaml_file</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF"> 时出错: </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">e</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> {}</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> calculate_similarity</span><span style="color:#E1E4E8">(self, text1, text2):</span></span>
<span class="line"><span style="color:#9ECBFF">        &quot;&quot;&quot;计算两个文本的相似度&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#F97583"> not</span><span style="color:#E1E4E8"> text1 </span><span style="color:#F97583">or</span><span style="color:#F97583"> not</span><span style="color:#E1E4E8"> text2:</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> SequenceMatcher(</span><span style="color:#79B8FF">None</span><span style="color:#E1E4E8">, text1.lower(), text2.lower()).ratio()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> find_best_match</span><span style="color:#E1E4E8">(self, nuclei_info):</span></span>
<span class="line"><span style="color:#9ECBFF">        &quot;&quot;&quot;为Nuclei模板找到最匹配的FingerprintHub产品&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">        best_match </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> None</span></span>
<span class="line"><span style="color:#E1E4E8">        best_score </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # 构建搜索文本</span></span>
<span class="line"><span style="color:#E1E4E8">        search_text </span><span style="color:#F97583">=</span><span style="color:#F97583"> f</span><span style="color:#9ECBFF">&quot;</span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">nuclei_info[</span><span style="color:#9ECBFF">&#39;name&#39;</span><span style="color:#E1E4E8">]</span><span style="color:#79B8FF">}</span><span style="color:#79B8FF"> {</span><span style="color:#E1E4E8">nuclei_info[</span><span style="color:#9ECBFF">&#39;description&#39;</span><span style="color:#E1E4E8">]</span><span style="color:#79B8FF">}</span><span style="color:#79B8FF"> {</span><span style="color:#9ECBFF">&#39; &#39;</span><span style="color:#E1E4E8">.join(nuclei_info[</span><span style="color:#9ECBFF">&#39;tags&#39;</span><span style="color:#E1E4E8">])</span><span style="color:#79B8FF">}</span><span style="color:#79B8FF"> {</span><span style="color:#E1E4E8">nuclei_info[</span><span style="color:#9ECBFF">&#39;product&#39;</span><span style="color:#E1E4E8">]</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">        search_text </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> search_text.lower()</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # 如果metadata中有明确的product，优先使用</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> nuclei_info[</span><span style="color:#9ECBFF">&#39;product&#39;</span><span style="color:#E1E4E8">]:</span></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> product_name </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.product_names:</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> nuclei_info[</span><span style="color:#9ECBFF">&#39;product&#39;</span><span style="color:#E1E4E8">].lower() </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> product_name.lower():</span></span>
<span class="line"><span style="color:#F97583">                    return</span><span style="color:#E1E4E8"> product_name</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # 遍历所有产品，计算相似度</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> product_name, keywords </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.product_keywords.items():</span></span>
<span class="line"><span style="color:#E1E4E8">            score </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 0</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#6A737D">            # 1. 直接名称匹配</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> nuclei_info[</span><span style="color:#9ECBFF">&#39;name&#39;</span><span style="color:#E1E4E8">].lower() </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> product_name.lower():</span></span>
<span class="line"><span style="color:#E1E4E8">                score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 10</span></span>
<span class="line"><span style="color:#F97583">            elif</span><span style="color:#E1E4E8"> product_name.lower() </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> nuclei_info[</span><span style="color:#9ECBFF">&#39;name&#39;</span><span style="color:#E1E4E8">].lower():</span></span>
<span class="line"><span style="color:#E1E4E8">                score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 8</span></span>
<span class="line"><span style="color:#F97583">            elif</span><span style="color:#E1E4E8"> nuclei_info[</span><span style="color:#9ECBFF">&#39;name&#39;</span><span style="color:#E1E4E8">].lower() </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> product_name.lower():</span></span>
<span class="line"><span style="color:#E1E4E8">                score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 6</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#6A737D">            # 2. 关键词匹配</span></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> keyword </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> keywords:</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> keyword </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> search_text:</span></span>
<span class="line"><span style="color:#E1E4E8">                    score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 3</span></span>
<span class="line"><span style="color:#F97583">                elif</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.calculate_similarity(keyword, search_text) </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> 0.8</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">                    score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#6A737D">            # 3. 标签匹配</span></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> tag </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> nuclei_info[</span><span style="color:#9ECBFF">&#39;tags&#39;</span><span style="color:#E1E4E8">]:</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> tag.lower() </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> product_name.lower():</span></span>
<span class="line"><span style="color:#E1E4E8">                    score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 5</span></span>
<span class="line"><span style="color:#F97583">                elif</span><span style="color:#E1E4E8"> product_name.lower() </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> tag.lower():</span></span>
<span class="line"><span style="color:#E1E4E8">                    score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 3</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#6A737D">            # 4. 描述匹配</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> product_name.lower() </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> nuclei_info[</span><span style="color:#9ECBFF">&#39;description&#39;</span><span style="color:#E1E4E8">].lower():</span></span>
<span class="line"><span style="color:#E1E4E8">                score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 4</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#6A737D">            # 5. 路径匹配</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> product_name.lower() </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> str</span><span style="color:#E1E4E8">(nuclei_info[</span><span style="color:#9ECBFF">&#39;path&#39;</span><span style="color:#E1E4E8">]).lower():</span></span>
<span class="line"><span style="color:#E1E4E8">                score </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> score </span><span style="color:#F97583">&gt;</span><span style="color:#E1E4E8"> best_score:</span></span>
<span class="line"><span style="color:#E1E4E8">                best_score </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> score</span></span>
<span class="line"><span style="color:#E1E4E8">                best_match </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> product_name</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        # 设置阈值，避免错误匹配</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> best_score </span><span style="color:#F97583">&gt;=</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> best_match</span></span>
<span class="line"><span style="color:#F97583">        else</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#9ECBFF"> &quot;unknown&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> classify_templates</span><span style="color:#E1E4E8">(self, templates_dir</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&quot;.&quot;</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#9ECBFF">        &quot;&quot;&quot;分类所有Nuclei模板&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">        templates_dir </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Path(templates_dir)</span></span>
<span class="line"><span style="color:#E1E4E8">        yaml_files </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> list</span><span style="color:#E1E4E8">(templates_dir.rglob(</span><span style="color:#9ECBFF">&quot;*.yaml&quot;</span><span style="color:#E1E4E8">))</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#79B8FF">        print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">&quot;开始分类 </span><span style="color:#79B8FF">{len</span><span style="color:#E1E4E8">(yaml_files)</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF"> 个Nuclei模板...&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        results </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {}</span></span>
<span class="line"><span style="color:#E1E4E8">        product_stats </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> defaultdict(</span><span style="color:#79B8FF">int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> idx, yaml_file </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> enumerate</span><span style="color:#E1E4E8">(yaml_files, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#6A737D">            # 跳过FingerprintHub目录</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#9ECBFF"> &quot;FingerprintHub&quot;</span><span style="color:#F97583"> in</span><span style="color:#79B8FF"> str</span><span style="color:#E1E4E8">(yaml_file):</span></span>
<span class="line"><span style="color:#F97583">                continue</span></span>
<span class="line"><span style="color:#E1E4E8">                </span></span>
<span class="line"><span style="color:#E1E4E8">            nuclei_info </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.extract_nuclei_info(yaml_file)</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> nuclei_info:</span></span>
<span class="line"><span style="color:#E1E4E8">                product </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> self</span><span style="color:#E1E4E8">.find_best_match(nuclei_info)</span></span>
<span class="line"><span style="color:#E1E4E8">                results[</span><span style="color:#79B8FF">str</span><span style="color:#E1E4E8">(yaml_file)] </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#9ECBFF">                    &#39;product&#39;</span><span style="color:#E1E4E8">: product,</span></span>
<span class="line"><span style="color:#9ECBFF">                    &#39;name&#39;</span><span style="color:#E1E4E8">: nuclei_info[</span><span style="color:#9ECBFF">&#39;name&#39;</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#9ECBFF">                    &#39;description&#39;</span><span style="color:#E1E4E8">: nuclei_info[</span><span style="color:#9ECBFF">&#39;description&#39;</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#9ECBFF">                    &#39;tags&#39;</span><span style="color:#E1E4E8">: nuclei_info[</span><span style="color:#9ECBFF">&#39;tags&#39;</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#E1E4E8">                product_stats[product] </span><span style="color:#F97583">+=</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#E1E4E8">                </span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> idx </span><span style="color:#F97583">%</span><span style="color:#79B8FF"> 100</span><span style="color:#F97583"> ==</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#79B8FF">                    print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">&quot;已处理 </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">idx</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">/</span><span style="color:#79B8FF">{len</span><span style="color:#E1E4E8">(yaml_files)</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF"> 个模板&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> results, product_stats</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    def</span><span style="color:#B392F0"> create_product_directories</span><span style="color:#E1E4E8">(self, results, output_dir</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&quot;products_fingerprinthub&quot;</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#9ECBFF">        &quot;&quot;&quot;按产品创建目录结构&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">        output_path </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Path(output_dir)</span></span>
<span class="line"><span style="color:#E1E4E8">        output_path.mkdir(</span><span style="color:#FFAB70">exist_ok</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        product_files </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> defaultdict(</span><span style="color:#79B8FF">list</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> template_path, info </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> results.items():</span></span>
<span class="line"><span style="color:#E1E4E8">            product </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> info[</span><span style="color:#9ECBFF">&#39;product&#39;</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">            product_files[product].append(template_path)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> product, files </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> product_files.items():</span></span>
<span class="line"><span style="color:#E1E4E8">            product_dir </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> output_path </span><span style="color:#F97583">/</span><span style="color:#E1E4E8"> product</span></span>
<span class="line"><span style="color:#E1E4E8">            product_dir.mkdir(</span><span style="color:#FFAB70">exist_ok</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#6A737D">            # 复制模板文件</span></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> template_path </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> files:</span></span>
<span class="line"><span style="color:#E1E4E8">                src </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Path(template_path)</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> src.exists():</span></span>
<span class="line"><span style="color:#E1E4E8">                    dst </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> product_dir </span><span style="color:#F97583">/</span><span style="color:#E1E4E8"> src.name</span></span>
<span class="line"><span style="color:#F97583">                    if</span><span style="color:#F97583"> not</span><span style="color:#E1E4E8"> dst.exists():</span></span>
<span class="line"><span style="color:#F97583">                        try</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#F97583">                            with</span><span style="color:#79B8FF"> open</span><span style="color:#E1E4E8">(src, </span><span style="color:#9ECBFF">&#39;r&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">encoding</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;utf-8&#39;</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> fin:</span></span>
<span class="line"><span style="color:#E1E4E8">                                content </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> fin.read()</span></span>
<span class="line"><span style="color:#F97583">                            with</span><span style="color:#79B8FF"> open</span><span style="color:#E1E4E8">(dst, </span><span style="color:#9ECBFF">&#39;w&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">encoding</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;utf-8&#39;</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> fout:</span></span>
<span class="line"><span style="color:#E1E4E8">                                fout.write(content)</span></span>
<span class="line"><span style="color:#F97583">                        except</span><span style="color:#79B8FF"> Exception</span><span style="color:#F97583"> as</span><span style="color:#E1E4E8"> e:</span></span>
<span class="line"><span style="color:#79B8FF">                            print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">&quot;复制 </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">src</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF"> 到 </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">dst</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF"> 出错: </span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">e</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#6A737D">            # 创建产品信息文件</span></span>
<span class="line"><span style="color:#E1E4E8">            product_info </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#9ECBFF">                &#39;product_name&#39;</span><span style="color:#E1E4E8">: product,</span></span>
<span class="line"><span style="color:#9ECBFF">                &#39;template_count&#39;</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">len</span><span style="color:#E1E4E8">(files),</span></span>
<span class="line"><span style="color:#9ECBFF">                &#39;templates&#39;</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#E1E4E8">                    {</span></span>
<span class="line"><span style="color:#9ECBFF">                        &#39;path&#39;</span><span style="color:#E1E4E8">: f,</span></span>
<span class="line"><span style="color:#9ECBFF">                        &#39;name&#39;</span><span style="color:#E1E4E8">: results[f][</span><span style="color:#9ECBFF">&#39;name&#39;</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#9ECBFF">                        &#39;description&#39;</span><span style="color:#E1E4E8">: results[f][</span><span style="color:#9ECBFF">&#39;description&#39;</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#9ECBFF">                        &#39;tags&#39;</span><span style="color:#E1E4E8">: results[f][</span><span style="color:#9ECBFF">&#39;tags&#39;</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">                    }</span></span>
<span class="line"><span style="color:#F97583">                    for</span><span style="color:#E1E4E8"> f </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> files</span></span>
<span class="line"><span style="color:#E1E4E8">                ]</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#F97583">            with</span><span style="color:#79B8FF"> open</span><span style="color:#E1E4E8">(product_dir </span><span style="color:#F97583">/</span><span style="color:#9ECBFF"> &#39;product_info.json&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&#39;w&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">encoding</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;utf-8&#39;</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> f:</span></span>
<span class="line"><span style="color:#E1E4E8">                json.dump(product_info, f, </span><span style="color:#FFAB70">indent</span><span style="color:#F97583">=</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">ensure_ascii</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#E1E4E8">    classifier </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> FingerprintHubClassifier()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    # 分类模板</span></span>
<span class="line"><span style="color:#E1E4E8">    results, product_stats </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> classifier.classify_templates()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    # 保存结果</span></span>
<span class="line"><span style="color:#F97583">    with</span><span style="color:#79B8FF"> open</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&#39;fingerprinthub_classification.json&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&#39;w&#39;</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">encoding</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">&#39;utf-8&#39;</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> f:</span></span>
<span class="line"><span style="color:#E1E4E8">        json.dump({</span></span>
<span class="line"><span style="color:#9ECBFF">            &#39;summary&#39;</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#9ECBFF">                &#39;total_templates&#39;</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">len</span><span style="color:#E1E4E8">(results),</span></span>
<span class="line"><span style="color:#9ECBFF">                &#39;total_products&#39;</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">len</span><span style="color:#E1E4E8">(product_stats)</span></span>
<span class="line"><span style="color:#E1E4E8">            },</span></span>
<span class="line"><span style="color:#9ECBFF">            &#39;products&#39;</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">dict</span><span style="color:#E1E4E8">(product_stats),</span></span>
<span class="line"><span style="color:#9ECBFF">            &#39;classifications&#39;</span><span style="color:#E1E4E8">: results</span></span>
<span class="line"><span style="color:#E1E4E8">        }, f, </span><span style="color:#FFAB70">indent</span><span style="color:#F97583">=</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">ensure_ascii</span><span style="color:#F97583">=</span><span style="color:#79B8FF">False</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    # 创建产品目录</span></span>
<span class="line"><span style="color:#E1E4E8">    classifier.create_product_directories(results)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    # 打印统计信息</span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">&quot;</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">分类完成！&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">&quot;总模板数: </span><span style="color:#79B8FF">{len</span><span style="color:#E1E4E8">(results)</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">&quot;总产品数: </span><span style="color:#79B8FF">{len</span><span style="color:#E1E4E8">(product_stats)</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">&quot;</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">前20个产品:&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;-&quot;</span><span style="color:#F97583"> *</span><span style="color:#79B8FF"> 60</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">&quot;</span><span style="color:#79B8FF">{</span><span style="color:#9ECBFF">&#39;排名&#39;</span><span style="color:#F97583">:&lt;4</span><span style="color:#79B8FF">}</span><span style="color:#79B8FF"> {</span><span style="color:#9ECBFF">&#39;产品名&#39;</span><span style="color:#F97583">:&lt;30</span><span style="color:#79B8FF">}</span><span style="color:#79B8FF"> {</span><span style="color:#9ECBFF">&#39;模板数&#39;</span><span style="color:#F97583">:&lt;8</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;-&quot;</span><span style="color:#F97583"> *</span><span style="color:#79B8FF"> 60</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    sorted_products </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> sorted</span><span style="color:#E1E4E8">(product_stats.items(), </span><span style="color:#FFAB70">key</span><span style="color:#F97583">=lambda</span><span style="color:#E1E4E8"> x: x[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">], </span><span style="color:#FFAB70">reverse</span><span style="color:#F97583">=</span><span style="color:#79B8FF">True</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i, (product, count) </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> enumerate</span><span style="color:#E1E4E8">(sorted_products[:</span><span style="color:#79B8FF">20</span><span style="color:#E1E4E8">], </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#79B8FF">        print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">&quot;</span><span style="color:#79B8FF">{</span><span style="color:#E1E4E8">i</span><span style="color:#F97583">:&lt;4</span><span style="color:#79B8FF">}</span><span style="color:#79B8FF"> {</span><span style="color:#E1E4E8">product</span><span style="color:#F97583">:&lt;30</span><span style="color:#79B8FF">}</span><span style="color:#79B8FF"> {</span><span style="color:#E1E4E8">count</span><span style="color:#F97583">:&lt;8</span><span style="color:#79B8FF">}</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">&quot;</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">结果已保存到:&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">&quot;- 分类报告: fingerprinthub_classification.json&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">    print</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">f</span><span style="color:#9ECBFF">&quot;- 产品目录: products_fingerprinthub/&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#79B8FF"> __name__</span><span style="color:#F97583"> ==</span><span style="color:#9ECBFF"> &quot;__main__&quot;</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">    main() </span></span></code></pre>
<hr/>
<h2 id="7-总结一下这次折腾">7. 总结一下这次折腾</h2>
<ol>
<li><strong>算法选择</strong>
<ul>
<li>关键词、N-gram、正则可以当”预过滤”用</li>
<li><strong>编辑距离</strong> 在处理「同义词、错拼、版本号」时表现最好，是最终筛选的利器</li>
</ul>
</li>
<li><strong>性能优化</strong>
<ul>
<li>自己写的 Levenshtein 性能稀烂，生产环境一定要 <strong>用 C 扩展</strong></li>
<li>多进程 / 多线程 / Cython / Rust 都是可行的加速手段</li>
</ul>
</li>
<li><strong>代码维护</strong>
<ul>
<li>把阈值、权重写进配置文件，后面调参方便</li>
<li>结合 CI，新增模板自动归类并输出差异报告</li>
</ul>
</li>
</ol>
<p>总的来说，这次折腾还是挺有收获的。从最开始的 2 小时优化到 5 分钟，性能提升了 24 倍。虽然踩了不少坑，但最终的效果还是很满意的。</p>
<p>如果你也要搞类似的文本匹配任务，建议：</p>
<ul>
<li>别一上来就自己造轮子，先试试现成的库</li>
<li>性能瓶颈出现了再考虑 C 扩展和多进程</li>
<li>算法选择要结合具体场景，没有银弹</li>
</ul> </div> </div> <!-- 文章底部导航 --> <div class="mt-8 flex justify-between items-center" data-astro-cid-gjtny2mx> <a href="/my-blog/" class="dark-btn-outline px-6 py-3 rounded-lg text-sm" data-astro-cid-gjtny2mx>
← 返回首页
</a> <div class="flex space-x-4" data-astro-cid-gjtny2mx> <button class="dark-btn px-6 py-3 rounded-lg text-sm" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" data-astro-cid-gjtny2mx>
↑ 回到顶部
</button> </div> </div> </article> <!-- 侧边栏 --> <aside class="lg:col-span-1" data-astro-cid-gjtny2mx> <div class="sticky top-24 space-y-6" data-astro-cid-gjtny2mx> <!-- 文章信息卡片 --> <div class="dark-card p-6 rounded-xl" data-astro-cid-gjtny2mx> <h3 class="font-bold text-white mb-4 neon-text" data-astro-cid-gjtny2mx>文章信息</h3> <div class="space-y-4 text-sm" data-astro-cid-gjtny2mx> <div class="flex justify-between items-center" data-astro-cid-gjtny2mx> <span class="text-gray-400" data-astro-cid-gjtny2mx>发布时间</span> <span class="text-white font-mono" data-astro-cid-gjtny2mx>2024/1/16</span> </div> <div class="flex justify-between items-center" data-astro-cid-gjtny2mx> <span class="text-gray-400" data-astro-cid-gjtny2mx>分类</span> <span class="neon-text font-bold" data-astro-cid-gjtny2mx>网络安全</span> </div> <div data-astro-cid-gjtny2mx> <span class="text-gray-400 block mb-3" data-astro-cid-gjtny2mx>标签</span> <div class="flex flex-wrap gap-2" data-astro-cid-gjtny2mx> <span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> Nuclei </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> FingerprintHub </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> 编辑距离 </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> 自动化工具 </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> 算法优化 </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> 漏洞扫描 </span> </div> </div> </div> </div> <!-- 目录 --> <div class="dark-card p-6 rounded-xl" data-astro-cid-gjtny2mx> <h3 class="font-bold text-white mb-4 neon-text" data-astro-cid-gjtny2mx>目录</h3> <div class="text-sm space-y-3" data-astro-cid-gjtny2mx> <a href="#" class="block text-gray-300 hover:neon-text transition-all duration-300 border-l-2 border-transparent hover:border-neon-green pl-3" data-astro-cid-gjtny2mx>
• 文章开始
</a> <a href="#" class="block text-gray-300 hover:neon-text transition-all duration-300 border-l-2 border-transparent hover:border-neon-green pl-3" data-astro-cid-gjtny2mx>
• 主要内容
</a> <a href="#" class="block text-gray-300 hover:neon-text transition-all duration-300 border-l-2 border-transparent hover:border-neon-green pl-3" data-astro-cid-gjtny2mx>
• 总结
</a> </div> </div> <!-- 相关文章 --> <div class="dark-card p-6 rounded-xl" data-astro-cid-gjtny2mx> <h3 class="font-bold text-white mb-4 neon-text" data-astro-cid-gjtny2mx>相关文章</h3> <div class="space-y-4 text-sm" data-astro-cid-gjtny2mx> <a href="/my-blog/posts/typescript-tips" class="block group border border-gray-700/50 rounded-lg p-3 hover:border-neon-green/40 transition-all duration-300" data-astro-cid-gjtny2mx> <span class="text-gray-300 group-hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>
TypeScript 小技巧
</span> <div class="text-xs text-gray-500 mt-1" data-astro-cid-gjtny2mx>编程语言</div> </a> <a href="/my-blog/posts/hello-astro" class="block group border border-gray-700/50 rounded-lg p-3 hover:border-neon-green/40 transition-all duration-300" data-astro-cid-gjtny2mx> <span class="text-gray-300 group-hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>
Hello Astro
</span> <div class="text-xs text-gray-500 mt-1" data-astro-cid-gjtny2mx>框架</div> </a> </div> </div> </div> </aside> </div>  </main> <footer class="mt-20 border-t border-neon-green/30 bg-black/60 backdrop-blur-sm"> <div class="max-w-6xl mx-auto px-4 py-12"> <!-- 居中的品牌信息 --> <div class="text-center mb-8"> <div class="flex items-center justify-center space-x-4 mb-6"> <div class="w-16 h-16 group"> <!-- 代码风格Logo图标 - 基于第一个设计方案 --><svg viewBox="0 0 48 48" class="w-full h-full" data-astro-cid-hit3dubr> <defs data-astro-cid-hit3dubr> <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%" data-astro-cid-hit3dubr> <stop offset="0%" style="stop-color:#00ff88;stop-opacity:1" data-astro-cid-hit3dubr></stop> <stop offset="100%" style="stop-color:#3742fa;stop-opacity:1" data-astro-cid-hit3dubr></stop> </linearGradient> <filter id="logoGlow" data-astro-cid-hit3dubr> <feGaussianBlur stdDeviation="2" result="coloredBlur" data-astro-cid-hit3dubr></feGaussianBlur> <feMerge data-astro-cid-hit3dubr> <feMergeNode in="coloredBlur" data-astro-cid-hit3dubr></feMergeNode> <feMergeNode in="SourceGraphic" data-astro-cid-hit3dubr></feMergeNode> </feMerge> </filter> </defs> <!-- 外框 --> <rect x="2" y="2" width="44" height="44" fill="none" stroke="url(#logoGrad)" stroke-width="2" rx="8" filter="url(#logoGlow)" class="group-hover:stroke-width-3 transition-all duration-300" data-astro-cid-hit3dubr></rect> <!-- 字母F的代码风格设计 --> <path d="M12 12 L32 12 M12 12 L12 36 M12 24 L28 24" stroke="#00ff88" stroke-width="3" stroke-linecap="round" fill="none" filter="url(#logoGlow)" class="group-hover:stroke-white transition-all duration-300" data-astro-cid-hit3dubr></path> <!-- 装饰点 --> <circle cx="36" cy="16" r="2" fill="#00ff88" class="animate-pulse group-hover:fill-white transition-all duration-300" data-astro-cid-hit3dubr></circle> <circle cx="36" cy="28" r="1.5" fill="#3742fa" class="animate-pulse group-hover:fill-white transition-all duration-300" style="animation-delay: 0.5s" data-astro-cid-hit3dubr></circle> </svg>  </div> <span class="font-black text-3xl neon-text tracking-wider">MR.FENG</span> </div> <p class="description-text text-xl leading-relaxed max-w-2xl mx-auto">
编程不仅是科学，也是艺术<br>
在代码中探索创新，在技术中发现美学
</p> <!-- 装饰性元素 --> <div class="flex justify-center items-center space-x-8 mt-8"> <div class="w-16 h-px bg-gradient-to-r from-transparent to-neon-green"></div> <div class="w-3 h-3 border-2 border-neon-green bg-neon-green/20 rounded-full animate-pulse"></div> <div class="w-16 h-px bg-gradient-to-l from-transparent to-neon-green"></div> </div> </div> <!-- 分割线 --> <div class="h-px bg-gradient-to-r from-transparent via-neon-green/50 to-transparent mb-6"></div> <!-- 底部信息 --> <div class="flex flex-col md:flex-row justify-between items-center text-sm text-gray-400"> <p>
© 2025 Mr. Feng •
<span class="neon-text">Powered by Astro</span> </p> <!-- 状态指示器 --> <div class="flex items-center space-x-2 mt-4 md:mt-0"> <div class="w-3 h-3 bg-neon-green rounded-full animate-pulse"></div> <span class="text-xs text-gray-500">SYSTEM ONLINE</span> </div> </div> </div> <!-- 底部发光效果 --> <div class="h-px bg-gradient-to-r from-transparent via-neon-green to-transparent opacity-60"></div> </footer> <!-- 增强的粒子生成脚本 --> <script type="module">function o(){const e=document.getElementById("particles");if(!e)return;const n=40;for(let a=0;a<n;a++){const t=document.createElement("div");t.className="particle",t.style.left=Math.random()*100+"%",t.style.top=Math.random()*100+"%",t.style.animationDelay=Math.random()*8+"s",t.style.animationDuration=Math.random()*4+6+"s",e.appendChild(t)}}document.addEventListener("DOMContentLoaded",o);</script> </body> </html> 