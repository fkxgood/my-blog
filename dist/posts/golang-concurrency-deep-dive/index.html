<!DOCTYPE html><html lang="zh-CN" class="scroll-smooth"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Mr. Feng — 暗黑科技博客</title><meta name="description" content="编程不仅是科学，也是艺术。在代码中，我们找到了表达自我和解决问题的新途径。"><link rel="stylesheet" href="/my-blog/_astro/about.BfSHQvgF.css">
<style>.prose[data-astro-cid-gjtny2mx]{color:#fff}.prose[data-astro-cid-gjtny2mx] h1[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h2[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h3[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h4[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h5[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h6[data-astro-cid-gjtny2mx]{color:#fff;font-weight:700}.prose[data-astro-cid-gjtny2mx] h2[data-astro-cid-gjtny2mx]{border-bottom:2px solid rgba(0,255,136,.3);padding-bottom:.75rem;margin-top:2.5rem;margin-bottom:1.5rem;color:#0f8;text-shadow:0 0 10px rgba(0,255,136,.3)}.prose[data-astro-cid-gjtny2mx] h3[data-astro-cid-gjtny2mx]{color:#0f8;margin-top:2rem;margin-bottom:1rem}.prose[data-astro-cid-gjtny2mx] a[data-astro-cid-gjtny2mx]{color:#0f8;text-decoration:none;text-shadow:0 0 5px rgba(0,255,136,.3)}.prose[data-astro-cid-gjtny2mx] a[data-astro-cid-gjtny2mx]:hover{color:#fff;text-shadow:0 0 10px #00ff88;text-decoration:underline}.prose[data-astro-cid-gjtny2mx] code[data-astro-cid-gjtny2mx]{background:#00ff8826;border:1px solid rgba(0,255,136,.3);border-radius:.375rem;padding:.25rem .5rem;color:#0f8;font-size:.9em;font-weight:600}.prose[data-astro-cid-gjtny2mx] pre[data-astro-cid-gjtny2mx]{background:#0a0a0a;border:1px solid rgba(0,255,136,.3);border-radius:.75rem;padding:1.5rem;overflow-x:auto;box-shadow:0 0 20px #00ff881a}.prose[data-astro-cid-gjtny2mx] pre[data-astro-cid-gjtny2mx] code[data-astro-cid-gjtny2mx]{background:transparent;border:none;padding:0;color:#fff;text-shadow:none;font-weight:400}.prose[data-astro-cid-gjtny2mx] blockquote[data-astro-cid-gjtny2mx]{border-left:4px solid #00ff88;background:#00ff880d;margin:1.5rem 0;padding:1rem 1.5rem;font-style:italic;border-radius:0 .5rem .5rem 0}.prose[data-astro-cid-gjtny2mx] ul[data-astro-cid-gjtny2mx] li[data-astro-cid-gjtny2mx]::marker,.prose[data-astro-cid-gjtny2mx] ol[data-astro-cid-gjtny2mx] li[data-astro-cid-gjtny2mx]::marker{color:#0f8}.prose[data-astro-cid-gjtny2mx] strong[data-astro-cid-gjtny2mx]{color:#fff;font-weight:700}.prose[data-astro-cid-gjtny2mx] p[data-astro-cid-gjtny2mx]{line-height:1.8;margin-bottom:1.25rem}
</style>
<link rel="stylesheet" href="/my-blog/_astro/fingerprinthub_classify_blog.CxlJjaYK.css"></head> <body class="dark-bg grid-bg min-h-screen text-white font-sans relative overflow-x-hidden"> <!-- 增强的粒子背景 --> <div class="particles" id="particles"></div> <header class="bg-black/80 backdrop-blur-md border-b border-neon-green/30 sticky top-0 z-50"> <div class="max-w-6xl mx-auto px-4 flex items-center justify-between h-16"> <!-- Logo --> <a href="/my-blog/" class="flex items-center space-x-3 group"> <div class="w-12 h-12"> <!-- 代码风格Logo图标 - 基于第一个设计方案 --><svg viewBox="0 0 48 48" class="w-full h-full" data-astro-cid-hit3dubr> <defs data-astro-cid-hit3dubr> <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%" data-astro-cid-hit3dubr> <stop offset="0%" style="stop-color:#00ff88;stop-opacity:1" data-astro-cid-hit3dubr></stop> <stop offset="100%" style="stop-color:#3742fa;stop-opacity:1" data-astro-cid-hit3dubr></stop> </linearGradient> <filter id="logoGlow" data-astro-cid-hit3dubr> <feGaussianBlur stdDeviation="2" result="coloredBlur" data-astro-cid-hit3dubr></feGaussianBlur> <feMerge data-astro-cid-hit3dubr> <feMergeNode in="coloredBlur" data-astro-cid-hit3dubr></feMergeNode> <feMergeNode in="SourceGraphic" data-astro-cid-hit3dubr></feMergeNode> </feMerge> </filter> </defs> <!-- 外框 --> <rect x="2" y="2" width="44" height="44" fill="none" stroke="url(#logoGrad)" stroke-width="2" rx="8" filter="url(#logoGlow)" class="group-hover:stroke-width-3 transition-all duration-300" data-astro-cid-hit3dubr></rect> <!-- 字母F的代码风格设计 --> <path d="M12 12 L32 12 M12 12 L12 36 M12 24 L28 24" stroke="#00ff88" stroke-width="3" stroke-linecap="round" fill="none" filter="url(#logoGlow)" class="group-hover:stroke-white transition-all duration-300" data-astro-cid-hit3dubr></path> <!-- 装饰点 --> <circle cx="36" cy="16" r="2" fill="#00ff88" class="animate-pulse group-hover:fill-white transition-all duration-300" data-astro-cid-hit3dubr></circle> <circle cx="36" cy="28" r="1.5" fill="#3742fa" class="animate-pulse group-hover:fill-white transition-all duration-300" style="animation-delay: 0.5s" data-astro-cid-hit3dubr></circle> </svg>  </div> <span class="font-bold text-2xl neon-logo group-hover:neon-logo transition-all duration-300">
MR.FENG
</span> </a> <!-- 导航菜单 --> <nav class="hidden md:flex items-center space-x-8"> <a href="/my-blog/" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
首页
</a> <a href="/my-blog/categories" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
分类
</a> <a href="/my-blog/tags" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
标签
</a> <a href="/my-blog/about" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
关于
</a> </nav> <!-- 右侧工具栏 --> <div class="flex items-center space-x-4"> <div class="relative"> <input id="search-input" type="search" placeholder="搜索文章…" class="dark-input w-full sm:w-64 px-4 py-2 text-sm placeholder-gray-400"> <ul id="search-results" class="absolute top-full mt-2 w-full sm:w-96 bg-black/90 backdrop-blur-md border border-neon-green/30 rounded-lg shadow-2xl max-h-60 overflow-y-auto hidden z-50"></ul> </div> <script type="module">
  import Fuse from 'https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.esm.min.js';

  const input = document.getElementById('search-input');
  const resultsEl = document.getElementById('search-results');
  let fuse;

  async function initSearch() {
    const res = await fetch('/my-blog/search.json');
    const data = await res.json();
    fuse = new Fuse(data, {
      keys: ['title', 'content', 'category', 'tags'],
      threshold: 0.3,
      ignoreLocation: true,
    });
  }

  function render(results) {
    if (!results.length) {
      resultsEl.innerHTML = '<li class="p-4 text-center text-gray-400">无匹配结果</li>';
      return;
    }
    resultsEl.innerHTML = results
      .slice(0, 8)
      .map(r => `
        <li>
          <a href="${r.item.url}" class="block px-4 py-3 text-white hover:bg-neon-green/10 hover:border-l-2 hover:border-neon-green transition-all duration-300 border-l-2 border-transparent">
            <div class="font-medium">${r.item.title}</div>
            <div class="text-xs text-gray-400 mt-1">${r.item.category || '未分类'}</div>
          </a>
        </li>
      `) 
      .join('');
  }

  input.addEventListener('focus', () => {
    resultsEl.classList.remove('hidden');
    if (!fuse) initSearch();
  });

  document.addEventListener('click', (e) => {
    if (!input.contains(e.target) && !resultsEl.contains(e.target)) {
      resultsEl.classList.add('hidden');
    }
  });

  input.addEventListener('input', () => {
    if (!fuse) return;
    const q = input.value.trim();
    if (!q) {
      resultsEl.innerHTML = '';
      return;
    }
    const results = fuse.search(q);
    render(results);
  });
</script> <button id="theme-toggle" aria-label="切换暗色模式" class="w-9 h-9 rounded-full flex items-center justify-center hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"> <svg id="icon-sun" class="w-5 h-5 hidden" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"> <path d="M12 4.5V2m0 20v-2.5m7.778-12.728l1.768-1.768M2.454 21.546l1.768-1.768m0-14.556L2.454 4.454m18.092 16.092l-1.768-1.768M4.5 12H2m20 0h-2.5M6.222 17.778l-1.768 1.768m16.092-18.092l-1.768 1.768" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg id="icon-moon" class="w-5 h-5 hidden" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"> <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z"></path> </svg> </button> <script type="module">const l=document.getElementById("theme-toggle"),t=document.getElementById("icon-sun"),o=document.getElementById("icon-moon");if(l&&t&&o){const n=d=>{d?(o.style.display="none",t.style.display="block"):(t.style.display="none",o.style.display="block")},c=window.matchMedia("(prefers-color-scheme: dark)").matches,s=localStorage.getItem("theme");let e=s?s==="dark":c;document.documentElement.classList.toggle("dark",e),n(e),l.addEventListener("click",()=>{e=!e,document.documentElement.classList.toggle("dark",e),localStorage.setItem("theme",e?"dark":"light"),n(e)})}</script> <!-- 移动端菜单按钮 --> <button class="md:hidden p-2 text-white hover:neon-text transition-all duration-300" id="mobile-menu-btn"> <div class="w-6 h-0.5 bg-current mb-1 transition-all duration-300"></div> <div class="w-6 h-0.5 bg-current mb-1 transition-all duration-300"></div> <div class="w-6 h-0.5 bg-current transition-all duration-300"></div> </button> </div> </div> <!-- 移动端菜单 --> <div class="md:hidden bg-black/90 backdrop-blur-md border-t border-neon-green/30 hidden" id="mobile-menu"> <div class="px-4 py-6 space-y-4"> <a href="/my-blog/" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">首页</a> <a href="/my-blog/categories" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">分类</a> <a href="/my-blog/tags" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">标签</a> <a href="/my-blog/about" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">关于</a> </div> </div> </header> <script type="module">document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("mobile-menu-btn"),n=document.getElementById("mobile-menu");t?.addEventListener("click",()=>{n?.classList.toggle("hidden");const e=t.querySelectorAll("div");n?.classList.contains("hidden")?(e[0].style.transform="rotate(0deg)",e[1].style.opacity="1",e[2].style.transform="rotate(0deg)"):(e[0].style.transform="rotate(45deg) translate(5px, 5px)",e[1].style.opacity="0",e[2].style.transform="rotate(-45deg) translate(7px, -6px)")})});</script> <main class="max-w-6xl mx-auto px-4 py-8 relative z-10">   <nav class="mb-8 text-sm" data-astro-cid-gjtny2mx> <div class="flex items-center space-x-3 text-gray-400" data-astro-cid-gjtny2mx> <a href="/my-blog/" class="hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>首页</a> <span class="neon-text" data-astro-cid-gjtny2mx>•</span> <a href="/my-blog/categories" class="hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>分类</a> <span class="neon-text" data-astro-cid-gjtny2mx>•</span> <span class="neon-text font-bold" data-astro-cid-gjtny2mx>后端开发</span> </div> </nav>  <header class="mb-12" data-astro-cid-gjtny2mx> <div class="dark-card p-10 rounded-xl" data-astro-cid-gjtny2mx> <!-- 分类标签 --> <div class="mb-6" data-astro-cid-gjtny2mx> <span class="px-4 py-2 text-sm font-bold bg-neon-green/20 text-neon-green rounded-full border border-neon-green/40 uppercase tracking-wider" data-astro-cid-gjtny2mx> 后端开发 </span> </div> <!-- 文章标题 --> <h1 class="text-4xl md:text-5xl font-black text-white mb-6 leading-tight" data-astro-cid-gjtny2mx> Go 并发编程深度解析 —— goroutine 和 channel 的实战技巧 </h1> <!-- 文章描述 --> <p class="text-xl text-gray-300 mb-8 leading-relaxed" data-astro-cid-gjtny2mx> 深入理解 Go 的并发模型，掌握 goroutine、channel、select 等核心概念，学会处理并发编程中的常见问题和最佳实践 </p> <!-- 文章元信息 --> <div class="flex flex-wrap items-center gap-6 text-sm" data-astro-cid-gjtny2mx> <div class="flex items-center space-x-3" data-astro-cid-gjtny2mx> <div class="w-3 h-3 bg-neon-green rounded-full animate-pulse" data-astro-cid-gjtny2mx></div> <time class="font-mono text-gray-300 bg-dark-600/50 px-3 py-1 rounded" data-astro-cid-gjtny2mx> 2024年12月28日 </time> </div> <div class="flex items-center space-x-3" data-astro-cid-gjtny2mx> <div class="w-3 h-3 bg-neon-blue rounded-full animate-pulse" data-astro-cid-gjtny2mx></div> <div class="flex gap-2 flex-wrap" data-astro-cid-gjtny2mx> <span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#Go </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#Golang </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#并发编程 </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#goroutine </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#channel </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#后端开发 </span> </div> </div> </div> </div> </header>  <div class="grid lg:grid-cols-4 gap-8" data-astro-cid-gjtny2mx> <!-- 主要内容 --> <article class="lg:col-span-3" data-astro-cid-gjtny2mx> <div class="dark-card p-10 rounded-xl" data-astro-cid-gjtny2mx> <div class="prose prose-invert prose-lg max-w-none" data-astro-cid-gjtny2mx> <h1 id="go-并发编程深度解析--goroutine-和-channel-的实战技巧">Go 并发编程深度解析 —— goroutine 和 channel 的实战技巧</h1>
<blockquote>
<p>并发编程是 Go 语言最吸引人的特性之一。goroutine 和 channel 的设计让并发编程变得简单而优雅，但真正用好它们需要深入理解其工作原理和最佳实践。</p>
</blockquote>
<h2 id="-为什么-go-的并发这么特别">🤔 为什么 Go 的并发这么特别？</h2>
<p>在学 Go 之前，我对并发的理解还停留在传统的多线程模型上。Go 的并发模型确实让人眼前一亮：</p>



































<table><thead><tr><th>特性</th><th>传统线程</th><th>goroutine</th><th>优势</th></tr></thead><tbody><tr><td><strong>内存占用</strong></td><td>1-2MB 栈空间</td><td>2KB 初始栈</td><td>可以轻松创建百万级 goroutine</td></tr><tr><td><strong>创建成本</strong></td><td>系统调用，开销大</td><td>用户态调度，开销小</td><td>创建和销毁都很轻量</td></tr><tr><td><strong>调度方式</strong></td><td>操作系统调度</td><td>Go runtime 调度</td><td>更智能的调度策略</td></tr><tr><td><strong>通信方式</strong></td><td>共享内存 + 锁</td><td>channel 通信</td><td>避免竞态条件</td></tr></tbody></table>
<h3 id="go-并发的核心哲学">Go 并发的核心哲学</h3>
<p><strong>“Don’t communicate by sharing memory; share memory by communicating”</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// 错误的做法 - 共享内存</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> counter </span><span style="color:#F97583">int</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> mu </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Mutex</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> increment</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    mu.</span><span style="color:#B392F0">Lock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    counter</span><span style="color:#F97583">++</span></span>
<span class="line"><span style="color:#E1E4E8">    mu.</span><span style="color:#B392F0">Unlock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 正确的做法 - 通过通信共享内存</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> increment</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ch</span><span style="color:#F97583"> chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#B392F0"> increment</span><span style="color:#E1E4E8">(ch)</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#B392F0"> increment</span><span style="color:#E1E4E8">(ch)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 从 channel 接收结果</span></span>
<span class="line"><span style="color:#E1E4E8">    result1 </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch</span></span>
<span class="line"><span style="color:#E1E4E8">    result2 </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="-goroutine-深入理解">🚀 goroutine 深入理解</h2>
<h3 id="goroutine-的生命周期">goroutine 的生命周期</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">package</span><span style="color:#B392F0"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;</span><span style="color:#B392F0">fmt</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;</span><span style="color:#B392F0">runtime</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;</span><span style="color:#B392F0">time</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> worker</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">done</span><span style="color:#F97583"> chan</span><span style="color:#F97583"> bool</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Worker </span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF"> starting</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, id)</span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Worker </span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF"> done</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, id)</span></span>
<span class="line"><span style="color:#E1E4E8">    done </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> true</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // 查看当前 goroutine 数量</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Goroutines: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, runtime.</span><span style="color:#B392F0">NumGoroutine</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    done </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> bool</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 启动 3 个 goroutine</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;=</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#B392F0"> worker</span><span style="color:#E1E4E8">(i, done)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Goroutines after starting: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, runtime.</span><span style="color:#B392F0">NumGoroutine</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 等待所有 goroutine 完成</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        &lt;-</span><span style="color:#E1E4E8">done</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Goroutines after completion: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, runtime.</span><span style="color:#B392F0">NumGoroutine</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="goroutine-的调度机制">goroutine 的调度机制</h3>
<p>Go 使用 GMP 模型进行调度：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// G: goroutine</span></span>
<span class="line"><span style="color:#6A737D">// M: machine (系统线程)</span></span>
<span class="line"><span style="color:#6A737D">// P: processor (处理器)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> demonstrateScheduling</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // 设置最大 CPU 核心数</span></span>
<span class="line"><span style="color:#E1E4E8">    runtime.</span><span style="color:#B392F0">GOMAXPROCS</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 启动大量 goroutine 观察调度</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 1000</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">            // 模拟 CPU 密集型任务</span></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; j </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 1000000</span><span style="color:#E1E4E8">; j</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">                _ </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> j</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }(i)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 等待一段时间观察调度</span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Active goroutines: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, runtime.</span><span style="color:#B392F0">NumGoroutine</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="-channel-的深度使用">🔄 channel 的深度使用</h2>
<h3 id="channel-的类型和特性">channel 的类型和特性</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// 1. 无缓冲 channel - 同步通信</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> unbufferedChannel</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// 无缓冲</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Sending...&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        ch </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> 42</span><span style="color:#6A737D"> // 阻塞直到有人接收</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Sent!&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Receiving...&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    value </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch </span><span style="color:#6A737D">// 阻塞直到有人发送</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Received: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, value)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 2. 有缓冲 channel - 异步通信</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> bufferedChannel</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// 缓冲大小为 3</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 可以发送 3 个值而不阻塞</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> 3</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 第 4 个会阻塞</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        ch </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> 4</span><span style="color:#6A737D"> // 这里会阻塞</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;4 sent&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 接收一个值，让第 4 个可以发送</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Received: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8">ch)</span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Millisecond </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="channel-的高级模式">channel 的高级模式</h3>
<p><strong>1. 工作池模式</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> workerPool</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> numWorkers</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 3</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> numJobs</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 10</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    jobs </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">, numJobs)</span></span>
<span class="line"><span style="color:#E1E4E8">    results </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">, numJobs)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 启动工作协程</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#E1E4E8"> numWorkers; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#B392F0"> worker</span><span style="color:#E1E4E8">(i, jobs, results)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 发送任务</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#E1E4E8"> numJobs; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        jobs </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> i</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#B392F0">    close</span><span style="color:#E1E4E8">(jobs)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 收集结果</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#E1E4E8"> numJobs; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Result: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8">results)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> worker</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">jobs</span><span style="color:#F97583"> &lt;-chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">results</span><span style="color:#F97583"> chan&lt;-</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> job </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> jobs {</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Worker </span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF"> processing job </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, id, job)</span></span>
<span class="line"><span style="color:#E1E4E8">        time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Millisecond </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// 模拟工作</span></span>
<span class="line"><span style="color:#E1E4E8">        results </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> job </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>2. 扇入扇出模式</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// 扇出：一个 channel 分发给多个 goroutine</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> fanOut</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">input</span><span style="color:#F97583"> &lt;-chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">outputs</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">chan&lt;-</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> _, ch </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> outputs {</span></span>
<span class="line"><span style="color:#B392F0">            close</span><span style="color:#E1E4E8">(ch)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> value </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> input {</span></span>
<span class="line"><span style="color:#6A737D">        // 轮询分发</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> _, ch </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> outputs {</span></span>
<span class="line"><span style="color:#E1E4E8">            ch </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> value</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 扇入：多个 channel 合并成一个</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> fanIn</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">inputs</span><span style="color:#F97583"> ...&lt;-chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">&lt;-chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    output </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> wg </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">WaitGroup</span></span>
<span class="line"><span style="color:#E1E4E8">    wg.</span><span style="color:#B392F0">Add</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">len</span><span style="color:#E1E4E8">(inputs))</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> _, input </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> inputs {</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ch</span><span style="color:#F97583"> &lt;-chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">            defer</span><span style="color:#E1E4E8"> wg.</span><span style="color:#B392F0">Done</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> value </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> ch {</span></span>
<span class="line"><span style="color:#E1E4E8">                output </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> value</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }(input)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        wg.</span><span style="color:#B392F0">Wait</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#B392F0">        close</span><span style="color:#E1E4E8">(output)</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> output</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>3. 超时和取消模式</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> timeoutExample</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        ch </span><span style="color:#F97583">&lt;-</span><span style="color:#9ECBFF"> &quot;result&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    select</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    case</span><span style="color:#E1E4E8"> result </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch:</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Got result: </span><span style="color:#79B8FF">%s\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, result)</span></span>
<span class="line"><span style="color:#F97583">    case</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">time.</span><span style="color:#B392F0">After</span><span style="color:#E1E4E8">(time.Second):</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Timeout!&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> cancellationExample</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    done </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> bool</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            select</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">done:</span></span>
<span class="line"><span style="color:#E1E4E8">                fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Cancelled!&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">                return</span></span>
<span class="line"><span style="color:#F97583">            default</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">                fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Working...&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Millisecond </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#B392F0">    close</span><span style="color:#E1E4E8">(done) </span><span style="color:#6A737D">// 发送取消信号</span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Millisecond </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="-select-语句的妙用">🎯 select 语句的妙用</h2>
<h3 id="select-的基本用法">select 的基本用法</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> selectBasics</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch1 </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    ch2 </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#E1E4E8">        ch1 </span><span style="color:#F97583">&lt;-</span><span style="color:#9ECBFF"> &quot;from ch1&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        ch2 </span><span style="color:#F97583">&lt;-</span><span style="color:#9ECBFF"> &quot;from ch2&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        select</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        case</span><span style="color:#E1E4E8"> msg1 </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch1:</span></span>
<span class="line"><span style="color:#E1E4E8">            fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Received: </span><span style="color:#79B8FF">%s\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, msg1)</span></span>
<span class="line"><span style="color:#F97583">        case</span><span style="color:#E1E4E8"> msg2 </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch2:</span></span>
<span class="line"><span style="color:#E1E4E8">            fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Received: </span><span style="color:#79B8FF">%s\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, msg2)</span></span>
<span class="line"><span style="color:#F97583">        case</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">time.</span><span style="color:#B392F0">After</span><span style="color:#E1E4E8">(time.Second </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#E1E4E8">            fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Timeout!&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="select-的高级技巧">select 的高级技巧</h3>
<p><strong>1. 非阻塞操作</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> nonBlockingSelect</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    select</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    case</span><span style="color:#E1E4E8"> value </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch:</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Got value: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, value)</span></span>
<span class="line"><span style="color:#F97583">    default</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;No value available&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 非阻塞发送</span></span>
<span class="line"><span style="color:#F97583">    select</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    case</span><span style="color:#E1E4E8"> ch </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> 42</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Sent value&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    default</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Channel is full&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>2. 动态 select</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> dynamicSelect</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">channels</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">&lt;-chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">&lt;-chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    output </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        defer</span><span style="color:#B392F0"> close</span><span style="color:#E1E4E8">(output)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // 动态构建 select cases</span></span>
<span class="line"><span style="color:#E1E4E8">        cases </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">([]</span><span style="color:#B392F0">reflect</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">SelectCase</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">len</span><span style="color:#E1E4E8">(channels))</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> i, ch </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> channels {</span></span>
<span class="line"><span style="color:#E1E4E8">            cases[i] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> reflect</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">SelectCase</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">                Dir:  reflect.SelectRecv,</span></span>
<span class="line"><span style="color:#E1E4E8">                Chan: reflect.</span><span style="color:#B392F0">ValueOf</span><span style="color:#E1E4E8">(ch),</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // 使用反射进行动态 select</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#B392F0"> len</span><span style="color:#E1E4E8">(cases) </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            chosen, value, ok </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> reflect.</span><span style="color:#B392F0">Select</span><span style="color:#E1E4E8">(cases)</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#F97583"> !</span><span style="color:#E1E4E8">ok {</span></span>
<span class="line"><span style="color:#6A737D">                // channel 已关闭，移除这个 case</span></span>
<span class="line"><span style="color:#E1E4E8">                cases </span><span style="color:#F97583">=</span><span style="color:#B392F0"> append</span><span style="color:#E1E4E8">(cases[:chosen], cases[chosen</span><span style="color:#F97583">+</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:]</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">                continue</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">            output </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> value.</span><span style="color:#B392F0">Interface</span><span style="color:#E1E4E8">().(</span><span style="color:#F97583">int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> output</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="️-并发安全的最佳实践">🛡️ 并发安全的最佳实践</h2>
<h3 id="1-避免竞态条件">1. 避免竞态条件</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// 错误的做法</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> counter </span><span style="color:#F97583">int</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> increment</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    counter</span><span style="color:#F97583">++</span><span style="color:#6A737D"> // 竞态条件！</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 正确的做法 1: 使用 channel</span></span>
<span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> SafeCounter</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> NewSafeCounter</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">*</span><span style="color:#B392F0">SafeCounter</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    sc </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &amp;</span><span style="color:#B392F0">SafeCounter</span><span style="color:#E1E4E8">{ch: </span><span style="color:#B392F0">make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)}</span></span>
<span class="line"><span style="color:#E1E4E8">    sc.ch </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> 0</span><span style="color:#6A737D"> // 初始化</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> sc</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">sc </span><span style="color:#F97583">*</span><span style="color:#B392F0">SafeCounter</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Increment</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    current </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">sc.ch</span></span>
<span class="line"><span style="color:#E1E4E8">    sc.ch </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> current </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">sc </span><span style="color:#F97583">*</span><span style="color:#B392F0">SafeCounter</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Get</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">sc.ch</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 正确的做法 2: 使用 sync.Mutex</span></span>
<span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> SafeCounter2</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    mu </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Mutex</span></span>
<span class="line"><span style="color:#E1E4E8">    value </span><span style="color:#F97583">int</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">sc </span><span style="color:#F97583">*</span><span style="color:#B392F0">SafeCounter2</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Increment</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    sc.mu.</span><span style="color:#B392F0">Lock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> sc.mu.</span><span style="color:#B392F0">Unlock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    sc.value</span><span style="color:#F97583">++</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">sc </span><span style="color:#F97583">*</span><span style="color:#B392F0">SafeCounter2</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Get</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    sc.mu.</span><span style="color:#B392F0">Lock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> sc.mu.</span><span style="color:#B392F0">Unlock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> sc.value</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="2-避免-goroutine-泄漏">2. 避免 goroutine 泄漏</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// 错误的做法 - 可能泄漏</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> leakyFunction</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">        // 这个 goroutine 永远不会结束</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            select</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch:</span></span>
<span class="line"><span style="color:#F97583">                return</span></span>
<span class="line"><span style="color:#F97583">            default</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#6A737D">                // 做一些工作</span></span>
<span class="line"><span style="color:#E1E4E8">                time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Millisecond)</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#6A737D">    // 忘记关闭 channel</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 正确的做法 - 使用 context</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> properFunction</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ctx</span><span style="color:#B392F0"> context</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Context</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        defer</span><span style="color:#B392F0"> close</span><span style="color:#E1E4E8">(ch)</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            select</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ctx.</span><span style="color:#B392F0">Done</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">                return</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch:</span></span>
<span class="line"><span style="color:#F97583">                return</span></span>
<span class="line"><span style="color:#F97583">            default</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#6A737D">                // 做一些工作</span></span>
<span class="line"><span style="color:#E1E4E8">                time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Millisecond)</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 使用 context 控制生命周期</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">Done</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="3-资源管理">3. 资源管理</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// 使用 sync.WaitGroup 等待 goroutine 完成</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> waitGroupExample</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> wg </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">WaitGroup</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 5</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        wg.</span><span style="color:#B392F0">Add</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">            defer</span><span style="color:#E1E4E8"> wg.</span><span style="color:#B392F0">Done</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">            fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Worker </span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF"> starting</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, id)</span></span>
<span class="line"><span style="color:#E1E4E8">            time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#E1E4E8">            fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Worker </span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF"> done</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, id)</span></span>
<span class="line"><span style="color:#E1E4E8">        }(i)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    wg.</span><span style="color:#B392F0">Wait</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;All workers completed&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 使用 sync.Once 确保只执行一次</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> once </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Once</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> initialize</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    once.</span><span style="color:#B392F0">Do</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Initializing...&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6A737D">        // 初始化代码</span></span>
<span class="line"><span style="color:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="-性能优化技巧">🚀 性能优化技巧</h2>
<h3 id="1-使用对象池">1. 使用对象池</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#9ECBFF"> &quot;</span><span style="color:#B392F0">sync</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> ObjectPool</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    pool </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Pool</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> NewObjectPool</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">*</span><span style="color:#B392F0">ObjectPool</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> &amp;</span><span style="color:#B392F0">ObjectPool</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">        pool: </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Pool</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">            New: </span><span style="color:#F97583">func</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">interface</span><span style="color:#E1E4E8">{} {</span></span>
<span class="line"><span style="color:#F97583">                return</span><span style="color:#F97583"> &amp;</span><span style="color:#B392F0">ExpensiveObject</span><span style="color:#E1E4E8">{}</span></span>
<span class="line"><span style="color:#E1E4E8">            },</span></span>
<span class="line"><span style="color:#E1E4E8">        },</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">op </span><span style="color:#F97583">*</span><span style="color:#B392F0">ObjectPool</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Get</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">*</span><span style="color:#B392F0">ExpensiveObject</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> op.pool.</span><span style="color:#B392F0">Get</span><span style="color:#E1E4E8">().(</span><span style="color:#F97583">*</span><span style="color:#B392F0">ExpensiveObject</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">op </span><span style="color:#F97583">*</span><span style="color:#B392F0">ObjectPool</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Put</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">obj</span><span style="color:#F97583"> *</span><span style="color:#B392F0">ExpensiveObject</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // 重置对象状态</span></span>
<span class="line"><span style="color:#E1E4E8">    obj.</span><span style="color:#B392F0">Reset</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    op.pool.</span><span style="color:#B392F0">Put</span><span style="color:#E1E4E8">(obj)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> ExpensiveObject</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    data []</span><span style="color:#F97583">byte</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">eo </span><span style="color:#F97583">*</span><span style="color:#B392F0">ExpensiveObject</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Reset</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    eo.data </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> eo.data[:</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="2-批量处理">2. 批量处理</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> batchProcessor</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">items</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">int</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">batchSize</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    batches </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 分批发送</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        defer</span><span style="color:#B392F0"> close</span><span style="color:#E1E4E8">(batches)</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#B392F0"> len</span><span style="color:#E1E4E8">(items); i </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> batchSize {</span></span>
<span class="line"><span style="color:#E1E4E8">            end </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> batchSize</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> end </span><span style="color:#F97583">&gt;</span><span style="color:#B392F0"> len</span><span style="color:#E1E4E8">(items) {</span></span>
<span class="line"><span style="color:#E1E4E8">                end </span><span style="color:#F97583">=</span><span style="color:#B392F0"> len</span><span style="color:#E1E4E8">(items)</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">            batches </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> items[i:end]</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 并发处理批次</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> wg </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">WaitGroup</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        wg.</span><span style="color:#B392F0">Add</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">            defer</span><span style="color:#E1E4E8"> wg.</span><span style="color:#B392F0">Done</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> batch </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> batches {</span></span>
<span class="line"><span style="color:#B392F0">                processBatch</span><span style="color:#E1E4E8">(batch)</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }()</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    wg.</span><span style="color:#B392F0">Wait</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> processBatch</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">batch</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // 处理一批数据</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> _, item </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> batch {</span></span>
<span class="line"><span style="color:#6A737D">        // 处理单个项目</span></span>
<span class="line"><span style="color:#E1E4E8">        _ </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> item </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="-调试和监控">🧪 调试和监控</h2>
<h3 id="1-使用-pprof-分析">1. 使用 pprof 分析</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;</span><span style="color:#B392F0">net/http</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">    _ </span><span style="color:#9ECBFF">&quot;</span><span style="color:#B392F0">net/http/pprof</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;</span><span style="color:#B392F0">runtime/pprof</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> startProfiling</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // 启动 pprof 服务器</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        http.</span><span style="color:#B392F0">ListenAndServe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;localhost:6060&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">nil</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 手动生成 profile</span></span>
<span class="line"><span style="color:#E1E4E8">    f, _ </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> os.</span><span style="color:#B392F0">Create</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;cpu.prof&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> f.</span><span style="color:#B392F0">Close</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    pprof.</span><span style="color:#B392F0">StartCPUProfile</span><span style="color:#E1E4E8">(f)</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> pprof.</span><span style="color:#B392F0">StopCPUProfile</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 你的程序逻辑</span></span>
<span class="line"><span style="color:#B392F0">    runYourProgram</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> runYourProgram</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // 模拟程序运行</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 1000</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">            time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#E1E4E8">        }()</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="2-监控-goroutine-数量">2. 监控 goroutine 数量</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> monitorGoroutines</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    ticker </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> time.</span><span style="color:#B392F0">NewTicker</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> ticker.</span><span style="color:#B392F0">Stop</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> ticker.C {</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Active goroutines: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, runtime.</span><span style="color:#B392F0">NumGoroutine</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 在程序启动时开始监控</span></span>
<span class="line"><span style="color:#F97583">go</span><span style="color:#B392F0"> monitorGoroutines</span><span style="color:#E1E4E8">()</span></span></code></pre>
<h2 id="-实战案例并发爬虫">🎯 实战案例：并发爬虫</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> Crawler</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    visited </span><span style="color:#F97583">map</span><span style="color:#E1E4E8">[</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">]</span><span style="color:#F97583">bool</span></span>
<span class="line"><span style="color:#E1E4E8">    mu      </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">RWMutex</span></span>
<span class="line"><span style="color:#E1E4E8">    queue   </span><span style="color:#F97583">chan</span><span style="color:#F97583"> string</span></span>
<span class="line"><span style="color:#E1E4E8">    results </span><span style="color:#F97583">chan</span><span style="color:#F97583"> string</span></span>
<span class="line"><span style="color:#E1E4E8">    workers </span><span style="color:#F97583">int</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> NewCrawler</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">workers</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#B392F0">Crawler</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> &amp;</span><span style="color:#B392F0">Crawler</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">        visited: </span><span style="color:#B392F0">make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">map</span><span style="color:#E1E4E8">[</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">]</span><span style="color:#F97583">bool</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">        queue:   </span><span style="color:#B392F0">make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1000</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">        results: </span><span style="color:#B392F0">make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1000</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">        workers: workers,</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">Crawler</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Start</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">urls</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // 启动工作协程</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#E1E4E8"> c.workers; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#E1E4E8"> c.</span><span style="color:#B392F0">worker</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 发送初始 URL</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> _, url </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> urls {</span></span>
<span class="line"><span style="color:#E1E4E8">            c.queue </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> url</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#B392F0">        close</span><span style="color:#E1E4E8">(c.queue)</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 收集结果</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> result </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> c.results {</span></span>
<span class="line"><span style="color:#E1E4E8">            fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Crawled: </span><span style="color:#79B8FF">%s\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, result)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">Crawler</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">worker</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> url </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> c.queue {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> c.</span><span style="color:#B392F0">isVisited</span><span style="color:#E1E4E8">(url) {</span></span>
<span class="line"><span style="color:#F97583">            continue</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        c.</span><span style="color:#B392F0">markVisited</span><span style="color:#E1E4E8">(url)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // 模拟爬取</span></span>
<span class="line"><span style="color:#E1E4E8">        time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Millisecond </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        c.results </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> url</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // 发现新链接（简化版）</span></span>
<span class="line"><span style="color:#E1E4E8">        newURLs </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> c.</span><span style="color:#B392F0">extractLinks</span><span style="color:#E1E4E8">(url)</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> _, newURL </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> newURLs {</span></span>
<span class="line"><span style="color:#E1E4E8">            c.queue </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> newURL</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">Crawler</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">isVisited</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">url</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">bool</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    c.mu.</span><span style="color:#B392F0">RLock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> c.mu.</span><span style="color:#B392F0">RUnlock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> c.visited[url]</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">Crawler</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">markVisited</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">url</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    c.mu.</span><span style="color:#B392F0">Lock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> c.mu.</span><span style="color:#B392F0">Unlock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    c.visited[url] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">Crawler</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">extractLinks</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">url</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">) []</span><span style="color:#F97583">string</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // 模拟提取链接</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">{url </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> &quot;/link1&quot;</span><span style="color:#E1E4E8">, url </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> &quot;/link2&quot;</span><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="-总结一下">🤔 总结一下</h2>
<p>Go 的并发编程确实很优雅，但真正用好需要深入理解其工作原理。</p>
<p><strong>关键要点</strong>：</p>
<ol>
<li><strong>goroutine 很轻量</strong>：可以轻松创建大量并发任务</li>
<li><strong>channel 是通信的核心</strong>：避免共享内存，通过通信共享内存</li>
<li><strong>select 很灵活</strong>：处理多个 channel 的并发操作</li>
<li><strong>context 管理生命周期</strong>：优雅地处理取消和超时</li>
<li><strong>注意资源管理</strong>：避免 goroutine 泄漏和竞态条件</li>
</ol>
<p><strong>最佳实践</strong>：</p>
<ul>
<li>🚀 优先使用 channel 而不是共享内存</li>
<li>🛡️ 使用 context 管理 goroutine 生命周期</li>
<li>📊 监控 goroutine 数量和性能</li>
<li>🔧 合理使用缓冲 channel 和 select</li>
<li>🧪 充分测试并发代码</li>
</ul>
<p><strong>进阶方向</strong>：</p>
<ul>
<li><strong>内存模型</strong>：理解 Go 的内存一致性保证</li>
<li><strong>调度器调优</strong>：GOMAXPROCS 和调度策略</li>
<li><strong>性能分析</strong>：使用 pprof 和 trace 工具</li>
<li><strong>分布式系统</strong>：结合 etcd、consul 等</li>
</ul>
<p>希望这篇深度解析对理解 Go 并发编程有帮助！</p>
<blockquote>
<p>💡 <strong>小贴士</strong>：并发编程的核心是理解数据流，而不是控制流。Go 的 channel 让数据流变得清晰可见。</p>
</blockquote> </div> </div> <!-- 文章底部导航 --> <div class="mt-8 flex justify-between items-center" data-astro-cid-gjtny2mx> <a href="/my-blog/" class="dark-btn-outline px-6 py-3 rounded-lg text-sm" data-astro-cid-gjtny2mx>
← 返回首页
</a> <div class="flex space-x-4" data-astro-cid-gjtny2mx> <button class="dark-btn px-6 py-3 rounded-lg text-sm" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" data-astro-cid-gjtny2mx>
↑ 回到顶部
</button> </div> </div> </article> <!-- 侧边栏 --> <aside class="lg:col-span-1" data-astro-cid-gjtny2mx> <div class="sticky top-24 space-y-6" data-astro-cid-gjtny2mx> <!-- 文章信息卡片 --> <div class="dark-card p-6 rounded-xl" data-astro-cid-gjtny2mx> <h3 class="font-bold text-white mb-4 neon-text" data-astro-cid-gjtny2mx>文章信息</h3> <div class="space-y-4 text-sm" data-astro-cid-gjtny2mx> <div class="flex justify-between items-center" data-astro-cid-gjtny2mx> <span class="text-gray-400" data-astro-cid-gjtny2mx>发布时间</span> <span class="text-white font-mono" data-astro-cid-gjtny2mx>2024/12/28</span> </div> <div class="flex justify-between items-center" data-astro-cid-gjtny2mx> <span class="text-gray-400" data-astro-cid-gjtny2mx>分类</span> <span class="neon-text font-bold" data-astro-cid-gjtny2mx>后端开发</span> </div> <div data-astro-cid-gjtny2mx> <span class="text-gray-400 block mb-3" data-astro-cid-gjtny2mx>标签</span> <div class="flex flex-wrap gap-2" data-astro-cid-gjtny2mx> <span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> Go </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> Golang </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> 并发编程 </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> goroutine </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> channel </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> 后端开发 </span> </div> </div> </div> </div> <!-- 目录 --> <div class="dark-card p-6 rounded-xl" data-astro-cid-gjtny2mx> <h3 class="font-bold text-white mb-4 neon-text" data-astro-cid-gjtny2mx>目录</h3> <div class="text-sm space-y-3" data-astro-cid-gjtny2mx> <a href="#" class="block text-gray-300 hover:neon-text transition-all duration-300 border-l-2 border-transparent hover:border-neon-green pl-3" data-astro-cid-gjtny2mx>
• 文章开始
</a> <a href="#" class="block text-gray-300 hover:neon-text transition-all duration-300 border-l-2 border-transparent hover:border-neon-green pl-3" data-astro-cid-gjtny2mx>
• 主要内容
</a> <a href="#" class="block text-gray-300 hover:neon-text transition-all duration-300 border-l-2 border-transparent hover:border-neon-green pl-3" data-astro-cid-gjtny2mx>
• 总结
</a> </div> </div> <!-- 相关文章 --> <div class="dark-card p-6 rounded-xl" data-astro-cid-gjtny2mx> <h3 class="font-bold text-white mb-4 neon-text" data-astro-cid-gjtny2mx>相关文章</h3> <div class="space-y-4 text-sm" data-astro-cid-gjtny2mx> <a href="/my-blog/posts/typescript-tips" class="block group border border-gray-700/50 rounded-lg p-3 hover:border-neon-green/40 transition-all duration-300" data-astro-cid-gjtny2mx> <span class="text-gray-300 group-hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>
TypeScript 小技巧
</span> <div class="text-xs text-gray-500 mt-1" data-astro-cid-gjtny2mx>编程语言</div> </a> <a href="/my-blog/posts/hello-astro" class="block group border border-gray-700/50 rounded-lg p-3 hover:border-neon-green/40 transition-all duration-300" data-astro-cid-gjtny2mx> <span class="text-gray-300 group-hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>
Hello Astro
</span> <div class="text-xs text-gray-500 mt-1" data-astro-cid-gjtny2mx>框架</div> </a> </div> </div> </div> </aside> </div>  </main> <footer class="mt-20 border-t border-neon-green/30 bg-black/60 backdrop-blur-sm"> <div class="max-w-6xl mx-auto px-4 py-12"> <!-- 居中的品牌信息 --> <div class="text-center mb-8"> <div class="flex items-center justify-center space-x-4 mb-6"> <div class="w-16 h-16 group"> <!-- 代码风格Logo图标 - 基于第一个设计方案 --><svg viewBox="0 0 48 48" class="w-full h-full" data-astro-cid-hit3dubr> <defs data-astro-cid-hit3dubr> <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%" data-astro-cid-hit3dubr> <stop offset="0%" style="stop-color:#00ff88;stop-opacity:1" data-astro-cid-hit3dubr></stop> <stop offset="100%" style="stop-color:#3742fa;stop-opacity:1" data-astro-cid-hit3dubr></stop> </linearGradient> <filter id="logoGlow" data-astro-cid-hit3dubr> <feGaussianBlur stdDeviation="2" result="coloredBlur" data-astro-cid-hit3dubr></feGaussianBlur> <feMerge data-astro-cid-hit3dubr> <feMergeNode in="coloredBlur" data-astro-cid-hit3dubr></feMergeNode> <feMergeNode in="SourceGraphic" data-astro-cid-hit3dubr></feMergeNode> </feMerge> </filter> </defs> <!-- 外框 --> <rect x="2" y="2" width="44" height="44" fill="none" stroke="url(#logoGrad)" stroke-width="2" rx="8" filter="url(#logoGlow)" class="group-hover:stroke-width-3 transition-all duration-300" data-astro-cid-hit3dubr></rect> <!-- 字母F的代码风格设计 --> <path d="M12 12 L32 12 M12 12 L12 36 M12 24 L28 24" stroke="#00ff88" stroke-width="3" stroke-linecap="round" fill="none" filter="url(#logoGlow)" class="group-hover:stroke-white transition-all duration-300" data-astro-cid-hit3dubr></path> <!-- 装饰点 --> <circle cx="36" cy="16" r="2" fill="#00ff88" class="animate-pulse group-hover:fill-white transition-all duration-300" data-astro-cid-hit3dubr></circle> <circle cx="36" cy="28" r="1.5" fill="#3742fa" class="animate-pulse group-hover:fill-white transition-all duration-300" style="animation-delay: 0.5s" data-astro-cid-hit3dubr></circle> </svg>  </div> <span class="font-black text-3xl neon-text tracking-wider">MR.FENG</span> </div> <p class="description-text text-xl leading-relaxed max-w-2xl mx-auto">
编程不仅是科学，也是艺术<br>
在代码中探索创新，在技术中发现美学
</p> <!-- 装饰性元素 --> <div class="flex justify-center items-center space-x-8 mt-8"> <div class="w-16 h-px bg-gradient-to-r from-transparent to-neon-green"></div> <div class="w-3 h-3 border-2 border-neon-green bg-neon-green/20 rounded-full animate-pulse"></div> <div class="w-16 h-px bg-gradient-to-l from-transparent to-neon-green"></div> </div> </div> <!-- 分割线 --> <div class="h-px bg-gradient-to-r from-transparent via-neon-green/50 to-transparent mb-6"></div> <!-- 底部信息 --> <div class="flex flex-col md:flex-row justify-between items-center text-sm text-gray-400"> <p>
© 2025 Mr. Feng •
<span class="neon-text">Powered by Astro</span> </p> <!-- 状态指示器 --> <div class="flex items-center space-x-2 mt-4 md:mt-0"> <div class="w-3 h-3 bg-neon-green rounded-full animate-pulse"></div> <span class="text-xs text-gray-500">SYSTEM ONLINE</span> </div> </div> </div> <!-- 底部发光效果 --> <div class="h-px bg-gradient-to-r from-transparent via-neon-green to-transparent opacity-60"></div> </footer> <!-- 增强的粒子生成脚本 --> <script type="module">function o(){const e=document.getElementById("particles");if(!e)return;const n=40;for(let a=0;a<n;a++){const t=document.createElement("div");t.className="particle",t.style.left=Math.random()*100+"%",t.style.top=Math.random()*100+"%",t.style.animationDelay=Math.random()*8+"s",t.style.animationDuration=Math.random()*4+6+"s",e.appendChild(t)}}document.addEventListener("DOMContentLoaded",o);</script> </body> </html> 