<!DOCTYPE html><html lang="zh-CN" class="scroll-smooth"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Mr. Feng â€” æš—é»‘ç§‘æŠ€åšå®¢</title><meta name="description" content="ç¼–ç¨‹ä¸ä»…æ˜¯ç§‘å­¦ï¼Œä¹Ÿæ˜¯è‰ºæœ¯ã€‚åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†è¡¨è¾¾è‡ªæˆ‘å’Œè§£å†³é—®é¢˜çš„æ–°é€”å¾„ã€‚"><link rel="stylesheet" href="/my-blog/_astro/about.BfSHQvgF.css">
<style>.prose[data-astro-cid-gjtny2mx]{color:#fff}.prose[data-astro-cid-gjtny2mx] h1[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h2[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h3[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h4[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h5[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h6[data-astro-cid-gjtny2mx]{color:#fff;font-weight:700}.prose[data-astro-cid-gjtny2mx] h2[data-astro-cid-gjtny2mx]{border-bottom:2px solid rgba(0,255,136,.3);padding-bottom:.75rem;margin-top:2.5rem;margin-bottom:1.5rem;color:#0f8;text-shadow:0 0 10px rgba(0,255,136,.3)}.prose[data-astro-cid-gjtny2mx] h3[data-astro-cid-gjtny2mx]{color:#0f8;margin-top:2rem;margin-bottom:1rem}.prose[data-astro-cid-gjtny2mx] a[data-astro-cid-gjtny2mx]{color:#0f8;text-decoration:none;text-shadow:0 0 5px rgba(0,255,136,.3)}.prose[data-astro-cid-gjtny2mx] a[data-astro-cid-gjtny2mx]:hover{color:#fff;text-shadow:0 0 10px #00ff88;text-decoration:underline}.prose[data-astro-cid-gjtny2mx] code[data-astro-cid-gjtny2mx]{background:#00ff8826;border:1px solid rgba(0,255,136,.3);border-radius:.375rem;padding:.25rem .5rem;color:#0f8;font-size:.9em;font-weight:600}.prose[data-astro-cid-gjtny2mx] pre[data-astro-cid-gjtny2mx]{background:#0a0a0a;border:1px solid rgba(0,255,136,.3);border-radius:.75rem;padding:1.5rem;overflow-x:auto;box-shadow:0 0 20px #00ff881a}.prose[data-astro-cid-gjtny2mx] pre[data-astro-cid-gjtny2mx] code[data-astro-cid-gjtny2mx]{background:transparent;border:none;padding:0;color:#fff;text-shadow:none;font-weight:400}.prose[data-astro-cid-gjtny2mx] blockquote[data-astro-cid-gjtny2mx]{border-left:4px solid #00ff88;background:#00ff880d;margin:1.5rem 0;padding:1rem 1.5rem;font-style:italic;border-radius:0 .5rem .5rem 0}.prose[data-astro-cid-gjtny2mx] ul[data-astro-cid-gjtny2mx] li[data-astro-cid-gjtny2mx]::marker,.prose[data-astro-cid-gjtny2mx] ol[data-astro-cid-gjtny2mx] li[data-astro-cid-gjtny2mx]::marker{color:#0f8}.prose[data-astro-cid-gjtny2mx] strong[data-astro-cid-gjtny2mx]{color:#fff;font-weight:700}.prose[data-astro-cid-gjtny2mx] p[data-astro-cid-gjtny2mx]{line-height:1.8;margin-bottom:1.25rem}
</style>
<link rel="stylesheet" href="/my-blog/_astro/fingerprinthub_classify_blog.CxlJjaYK.css"></head> <body class="dark-bg grid-bg min-h-screen text-white font-sans relative overflow-x-hidden"> <!-- å¢å¼ºçš„ç²’å­èƒŒæ™¯ --> <div class="particles" id="particles"></div> <header class="bg-black/80 backdrop-blur-md border-b border-neon-green/30 sticky top-0 z-50"> <div class="max-w-6xl mx-auto px-4 flex items-center justify-between h-16"> <!-- Logo --> <a href="/my-blog/" class="flex items-center space-x-3 group"> <div class="w-12 h-12"> <!-- ä»£ç é£æ ¼Logoå›¾æ ‡ - åŸºäºç¬¬ä¸€ä¸ªè®¾è®¡æ–¹æ¡ˆ --><svg viewBox="0 0 48 48" class="w-full h-full" data-astro-cid-hit3dubr> <defs data-astro-cid-hit3dubr> <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%" data-astro-cid-hit3dubr> <stop offset="0%" style="stop-color:#00ff88;stop-opacity:1" data-astro-cid-hit3dubr></stop> <stop offset="100%" style="stop-color:#3742fa;stop-opacity:1" data-astro-cid-hit3dubr></stop> </linearGradient> <filter id="logoGlow" data-astro-cid-hit3dubr> <feGaussianBlur stdDeviation="2" result="coloredBlur" data-astro-cid-hit3dubr></feGaussianBlur> <feMerge data-astro-cid-hit3dubr> <feMergeNode in="coloredBlur" data-astro-cid-hit3dubr></feMergeNode> <feMergeNode in="SourceGraphic" data-astro-cid-hit3dubr></feMergeNode> </feMerge> </filter> </defs> <!-- å¤–æ¡† --> <rect x="2" y="2" width="44" height="44" fill="none" stroke="url(#logoGrad)" stroke-width="2" rx="8" filter="url(#logoGlow)" class="group-hover:stroke-width-3 transition-all duration-300" data-astro-cid-hit3dubr></rect> <!-- å­—æ¯Fçš„ä»£ç é£æ ¼è®¾è®¡ --> <path d="M12 12 L32 12 M12 12 L12 36 M12 24 L28 24" stroke="#00ff88" stroke-width="3" stroke-linecap="round" fill="none" filter="url(#logoGlow)" class="group-hover:stroke-white transition-all duration-300" data-astro-cid-hit3dubr></path> <!-- è£…é¥°ç‚¹ --> <circle cx="36" cy="16" r="2" fill="#00ff88" class="animate-pulse group-hover:fill-white transition-all duration-300" data-astro-cid-hit3dubr></circle> <circle cx="36" cy="28" r="1.5" fill="#3742fa" class="animate-pulse group-hover:fill-white transition-all duration-300" style="animation-delay: 0.5s" data-astro-cid-hit3dubr></circle> </svg>  </div> <span class="font-bold text-2xl neon-logo group-hover:neon-logo transition-all duration-300">
MR.FENG
</span> </a> <!-- å¯¼èˆªèœå• --> <nav class="hidden md:flex items-center space-x-8"> <a href="/my-blog/" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
é¦–é¡µ
</a> <a href="/my-blog/categories" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
åˆ†ç±»
</a> <a href="/my-blog/tags" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
æ ‡ç­¾
</a> <a href="/my-blog/about" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
å…³äº
</a> </nav> <!-- å³ä¾§å·¥å…·æ  --> <div class="flex items-center space-x-4"> <div class="relative"> <input id="search-input" type="search" placeholder="æœç´¢æ–‡ç« â€¦" class="dark-input w-full sm:w-64 px-4 py-2 text-sm placeholder-gray-400"> <ul id="search-results" class="absolute top-full mt-2 w-full sm:w-96 bg-black/90 backdrop-blur-md border border-neon-green/30 rounded-lg shadow-2xl max-h-60 overflow-y-auto hidden z-50"></ul> </div> <script type="module">
  import Fuse from 'https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.esm.min.js';

  const input = document.getElementById('search-input');
  const resultsEl = document.getElementById('search-results');
  let fuse;

  async function initSearch() {
    const res = await fetch('/my-blog/search.json');
    const data = await res.json();
    fuse = new Fuse(data, {
      keys: ['title', 'content', 'category', 'tags'],
      threshold: 0.3,
      ignoreLocation: true,
    });
  }

  function render(results) {
    if (!results.length) {
      resultsEl.innerHTML = '<li class="p-4 text-center text-gray-400">æ— åŒ¹é…ç»“æœ</li>';
      return;
    }
    resultsEl.innerHTML = results
      .slice(0, 8)
      .map(r => `
        <li>
          <a href="${r.item.url}" class="block px-4 py-3 text-white hover:bg-neon-green/10 hover:border-l-2 hover:border-neon-green transition-all duration-300 border-l-2 border-transparent">
            <div class="font-medium">${r.item.title}</div>
            <div class="text-xs text-gray-400 mt-1">${r.item.category || 'æœªåˆ†ç±»'}</div>
          </a>
        </li>
      `) 
      .join('');
  }

  input.addEventListener('focus', () => {
    resultsEl.classList.remove('hidden');
    if (!fuse) initSearch();
  });

  document.addEventListener('click', (e) => {
    if (!input.contains(e.target) && !resultsEl.contains(e.target)) {
      resultsEl.classList.add('hidden');
    }
  });

  input.addEventListener('input', () => {
    if (!fuse) return;
    const q = input.value.trim();
    if (!q) {
      resultsEl.innerHTML = '';
      return;
    }
    const results = fuse.search(q);
    render(results);
  });
</script> <button id="theme-toggle" aria-label="åˆ‡æ¢æš—è‰²æ¨¡å¼" class="w-9 h-9 rounded-full flex items-center justify-center hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"> <svg id="icon-sun" class="w-5 h-5 hidden" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"> <path d="M12 4.5V2m0 20v-2.5m7.778-12.728l1.768-1.768M2.454 21.546l1.768-1.768m0-14.556L2.454 4.454m18.092 16.092l-1.768-1.768M4.5 12H2m20 0h-2.5M6.222 17.778l-1.768 1.768m16.092-18.092l-1.768 1.768" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg id="icon-moon" class="w-5 h-5 hidden" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"> <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z"></path> </svg> </button> <script type="module">const l=document.getElementById("theme-toggle"),t=document.getElementById("icon-sun"),o=document.getElementById("icon-moon");if(l&&t&&o){const n=d=>{d?(o.style.display="none",t.style.display="block"):(t.style.display="none",o.style.display="block")},c=window.matchMedia("(prefers-color-scheme: dark)").matches,s=localStorage.getItem("theme");let e=s?s==="dark":c;document.documentElement.classList.toggle("dark",e),n(e),l.addEventListener("click",()=>{e=!e,document.documentElement.classList.toggle("dark",e),localStorage.setItem("theme",e?"dark":"light"),n(e)})}</script> <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® --> <button class="md:hidden p-2 text-white hover:neon-text transition-all duration-300" id="mobile-menu-btn"> <div class="w-6 h-0.5 bg-current mb-1 transition-all duration-300"></div> <div class="w-6 h-0.5 bg-current mb-1 transition-all duration-300"></div> <div class="w-6 h-0.5 bg-current transition-all duration-300"></div> </button> </div> </div> <!-- ç§»åŠ¨ç«¯èœå• --> <div class="md:hidden bg-black/90 backdrop-blur-md border-t border-neon-green/30 hidden" id="mobile-menu"> <div class="px-4 py-6 space-y-4"> <a href="/my-blog/" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">é¦–é¡µ</a> <a href="/my-blog/categories" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">åˆ†ç±»</a> <a href="/my-blog/tags" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">æ ‡ç­¾</a> <a href="/my-blog/about" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">å…³äº</a> </div> </div> </header> <script type="module">document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("mobile-menu-btn"),n=document.getElementById("mobile-menu");t?.addEventListener("click",()=>{n?.classList.toggle("hidden");const e=t.querySelectorAll("div");n?.classList.contains("hidden")?(e[0].style.transform="rotate(0deg)",e[1].style.opacity="1",e[2].style.transform="rotate(0deg)"):(e[0].style.transform="rotate(45deg) translate(5px, 5px)",e[1].style.opacity="0",e[2].style.transform="rotate(-45deg) translate(7px, -6px)")})});</script> <main class="max-w-6xl mx-auto px-4 py-8 relative z-10">   <nav class="mb-8 text-sm" data-astro-cid-gjtny2mx> <div class="flex items-center space-x-3 text-gray-400" data-astro-cid-gjtny2mx> <a href="/my-blog/" class="hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>é¦–é¡µ</a> <span class="neon-text" data-astro-cid-gjtny2mx>â€¢</span> <a href="/my-blog/categories" class="hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>åˆ†ç±»</a> <span class="neon-text" data-astro-cid-gjtny2mx>â€¢</span> <span class="neon-text font-bold" data-astro-cid-gjtny2mx>åç«¯å¼€å‘</span> </div> </nav>  <header class="mb-12" data-astro-cid-gjtny2mx> <div class="dark-card p-10 rounded-xl" data-astro-cid-gjtny2mx> <!-- åˆ†ç±»æ ‡ç­¾ --> <div class="mb-6" data-astro-cid-gjtny2mx> <span class="px-4 py-2 text-sm font-bold bg-neon-green/20 text-neon-green rounded-full border border-neon-green/40 uppercase tracking-wider" data-astro-cid-gjtny2mx> åç«¯å¼€å‘ </span> </div> <!-- æ–‡ç« æ ‡é¢˜ --> <h1 class="text-4xl md:text-5xl font-black text-white mb-6 leading-tight" data-astro-cid-gjtny2mx> Go å¹¶å‘ç¼–ç¨‹æ·±åº¦è§£æ â€”â€” goroutine å’Œ channel çš„å®æˆ˜æŠ€å·§ </h1> <!-- æ–‡ç« æè¿° --> <p class="text-xl text-gray-300 mb-8 leading-relaxed" data-astro-cid-gjtny2mx> æ·±å…¥ç†è§£ Go çš„å¹¶å‘æ¨¡å‹ï¼ŒæŒæ¡ goroutineã€channelã€select ç­‰æ ¸å¿ƒæ¦‚å¿µï¼Œå­¦ä¼šå¤„ç†å¹¶å‘ç¼–ç¨‹ä¸­çš„å¸¸è§é—®é¢˜å’Œæœ€ä½³å®è·µ </p> <!-- æ–‡ç« å…ƒä¿¡æ¯ --> <div class="flex flex-wrap items-center gap-6 text-sm" data-astro-cid-gjtny2mx> <div class="flex items-center space-x-3" data-astro-cid-gjtny2mx> <div class="w-3 h-3 bg-neon-green rounded-full animate-pulse" data-astro-cid-gjtny2mx></div> <time class="font-mono text-gray-300 bg-dark-600/50 px-3 py-1 rounded" data-astro-cid-gjtny2mx> 2024å¹´12æœˆ28æ—¥ </time> </div> <div class="flex items-center space-x-3" data-astro-cid-gjtny2mx> <div class="w-3 h-3 bg-neon-blue rounded-full animate-pulse" data-astro-cid-gjtny2mx></div> <div class="flex gap-2 flex-wrap" data-astro-cid-gjtny2mx> <span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#Go </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#Golang </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#å¹¶å‘ç¼–ç¨‹ </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#goroutine </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#channel </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#åç«¯å¼€å‘ </span> </div> </div> </div> </div> </header>  <div class="grid lg:grid-cols-4 gap-8" data-astro-cid-gjtny2mx> <!-- ä¸»è¦å†…å®¹ --> <article class="lg:col-span-3" data-astro-cid-gjtny2mx> <div class="dark-card p-10 rounded-xl" data-astro-cid-gjtny2mx> <div class="prose prose-invert prose-lg max-w-none" data-astro-cid-gjtny2mx> <h1 id="go-å¹¶å‘ç¼–ç¨‹æ·±åº¦è§£æ--goroutine-å’Œ-channel-çš„å®æˆ˜æŠ€å·§">Go å¹¶å‘ç¼–ç¨‹æ·±åº¦è§£æ â€”â€” goroutine å’Œ channel çš„å®æˆ˜æŠ€å·§</h1>
<blockquote>
<p>å¹¶å‘ç¼–ç¨‹æ˜¯ Go è¯­è¨€æœ€å¸å¼•äººçš„ç‰¹æ€§ä¹‹ä¸€ã€‚goroutine å’Œ channel çš„è®¾è®¡è®©å¹¶å‘ç¼–ç¨‹å˜å¾—ç®€å•è€Œä¼˜é›…ï¼Œä½†çœŸæ­£ç”¨å¥½å®ƒä»¬éœ€è¦æ·±å…¥ç†è§£å…¶å·¥ä½œåŸç†å’Œæœ€ä½³å®è·µã€‚</p>
</blockquote>
<h2 id="-ä¸ºä»€ä¹ˆ-go-çš„å¹¶å‘è¿™ä¹ˆç‰¹åˆ«">ğŸ¤” ä¸ºä»€ä¹ˆ Go çš„å¹¶å‘è¿™ä¹ˆç‰¹åˆ«ï¼Ÿ</h2>
<p>åœ¨å­¦ Go ä¹‹å‰ï¼Œæˆ‘å¯¹å¹¶å‘çš„ç†è§£è¿˜åœç•™åœ¨ä¼ ç»Ÿçš„å¤šçº¿ç¨‹æ¨¡å‹ä¸Šã€‚Go çš„å¹¶å‘æ¨¡å‹ç¡®å®è®©äººçœ¼å‰ä¸€äº®ï¼š</p>



































<table><thead><tr><th>ç‰¹æ€§</th><th>ä¼ ç»Ÿçº¿ç¨‹</th><th>goroutine</th><th>ä¼˜åŠ¿</th></tr></thead><tbody><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>1-2MB æ ˆç©ºé—´</td><td>2KB åˆå§‹æ ˆ</td><td>å¯ä»¥è½»æ¾åˆ›å»ºç™¾ä¸‡çº§ goroutine</td></tr><tr><td><strong>åˆ›å»ºæˆæœ¬</strong></td><td>ç³»ç»Ÿè°ƒç”¨ï¼Œå¼€é”€å¤§</td><td>ç”¨æˆ·æ€è°ƒåº¦ï¼Œå¼€é”€å°</td><td>åˆ›å»ºå’Œé”€æ¯éƒ½å¾ˆè½»é‡</td></tr><tr><td><strong>è°ƒåº¦æ–¹å¼</strong></td><td>æ“ä½œç³»ç»Ÿè°ƒåº¦</td><td>Go runtime è°ƒåº¦</td><td>æ›´æ™ºèƒ½çš„è°ƒåº¦ç­–ç•¥</td></tr><tr><td><strong>é€šä¿¡æ–¹å¼</strong></td><td>å…±äº«å†…å­˜ + é”</td><td>channel é€šä¿¡</td><td>é¿å…ç«æ€æ¡ä»¶</td></tr></tbody></table>
<h3 id="go-å¹¶å‘çš„æ ¸å¿ƒå“²å­¦">Go å¹¶å‘çš„æ ¸å¿ƒå“²å­¦</h3>
<p><strong>â€œDonâ€™t communicate by sharing memory; share memory by communicatingâ€</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// é”™è¯¯çš„åšæ³• - å…±äº«å†…å­˜</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> counter </span><span style="color:#F97583">int</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> mu </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Mutex</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> increment</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    mu.</span><span style="color:#B392F0">Lock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    counter</span><span style="color:#F97583">++</span></span>
<span class="line"><span style="color:#E1E4E8">    mu.</span><span style="color:#B392F0">Unlock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// æ­£ç¡®çš„åšæ³• - é€šè¿‡é€šä¿¡å…±äº«å†…å­˜</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> increment</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ch</span><span style="color:#F97583"> chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#B392F0"> increment</span><span style="color:#E1E4E8">(ch)</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#B392F0"> increment</span><span style="color:#E1E4E8">(ch)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // ä» channel æ¥æ”¶ç»“æœ</span></span>
<span class="line"><span style="color:#E1E4E8">    result1 </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch</span></span>
<span class="line"><span style="color:#E1E4E8">    result2 </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="-goroutine-æ·±å…¥ç†è§£">ğŸš€ goroutine æ·±å…¥ç†è§£</h2>
<h3 id="goroutine-çš„ç”Ÿå‘½å‘¨æœŸ">goroutine çš„ç”Ÿå‘½å‘¨æœŸ</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">package</span><span style="color:#B392F0"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;</span><span style="color:#B392F0">fmt</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;</span><span style="color:#B392F0">runtime</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;</span><span style="color:#B392F0">time</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> worker</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">done</span><span style="color:#F97583"> chan</span><span style="color:#F97583"> bool</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Worker </span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF"> starting</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, id)</span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Worker </span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF"> done</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, id)</span></span>
<span class="line"><span style="color:#E1E4E8">    done </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> true</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // æŸ¥çœ‹å½“å‰ goroutine æ•°é‡</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Goroutines: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, runtime.</span><span style="color:#B392F0">NumGoroutine</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    done </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> bool</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // å¯åŠ¨ 3 ä¸ª goroutine</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;=</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#B392F0"> worker</span><span style="color:#E1E4E8">(i, done)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Goroutines after starting: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, runtime.</span><span style="color:#B392F0">NumGoroutine</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // ç­‰å¾…æ‰€æœ‰ goroutine å®Œæˆ</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        &lt;-</span><span style="color:#E1E4E8">done</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Goroutines after completion: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, runtime.</span><span style="color:#B392F0">NumGoroutine</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="goroutine-çš„è°ƒåº¦æœºåˆ¶">goroutine çš„è°ƒåº¦æœºåˆ¶</h3>
<p>Go ä½¿ç”¨ GMP æ¨¡å‹è¿›è¡Œè°ƒåº¦ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// G: goroutine</span></span>
<span class="line"><span style="color:#6A737D">// M: machine (ç³»ç»Ÿçº¿ç¨‹)</span></span>
<span class="line"><span style="color:#6A737D">// P: processor (å¤„ç†å™¨)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> demonstrateScheduling</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // è®¾ç½®æœ€å¤§ CPU æ ¸å¿ƒæ•°</span></span>
<span class="line"><span style="color:#E1E4E8">    runtime.</span><span style="color:#B392F0">GOMAXPROCS</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // å¯åŠ¨å¤§é‡ goroutine è§‚å¯Ÿè°ƒåº¦</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 1000</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">            // æ¨¡æ‹Ÿ CPU å¯†é›†å‹ä»»åŠ¡</span></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; j </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 1000000</span><span style="color:#E1E4E8">; j</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">                _ </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> j</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }(i)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // ç­‰å¾…ä¸€æ®µæ—¶é—´è§‚å¯Ÿè°ƒåº¦</span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Active goroutines: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, runtime.</span><span style="color:#B392F0">NumGoroutine</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="-channel-çš„æ·±åº¦ä½¿ç”¨">ğŸ”„ channel çš„æ·±åº¦ä½¿ç”¨</h2>
<h3 id="channel-çš„ç±»å‹å’Œç‰¹æ€§">channel çš„ç±»å‹å’Œç‰¹æ€§</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// 1. æ— ç¼“å†² channel - åŒæ­¥é€šä¿¡</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> unbufferedChannel</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// æ— ç¼“å†²</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Sending...&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        ch </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> 42</span><span style="color:#6A737D"> // é˜»å¡ç›´åˆ°æœ‰äººæ¥æ”¶</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Sent!&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Receiving...&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    value </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch </span><span style="color:#6A737D">// é˜»å¡ç›´åˆ°æœ‰äººå‘é€</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Received: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, value)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 2. æœ‰ç¼“å†² channel - å¼‚æ­¥é€šä¿¡</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> bufferedChannel</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// ç¼“å†²å¤§å°ä¸º 3</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // å¯ä»¥å‘é€ 3 ä¸ªå€¼è€Œä¸é˜»å¡</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> 3</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // ç¬¬ 4 ä¸ªä¼šé˜»å¡</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        ch </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> 4</span><span style="color:#6A737D"> // è¿™é‡Œä¼šé˜»å¡</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;4 sent&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // æ¥æ”¶ä¸€ä¸ªå€¼ï¼Œè®©ç¬¬ 4 ä¸ªå¯ä»¥å‘é€</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Received: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8">ch)</span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Millisecond </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="channel-çš„é«˜çº§æ¨¡å¼">channel çš„é«˜çº§æ¨¡å¼</h3>
<p><strong>1. å·¥ä½œæ± æ¨¡å¼</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> workerPool</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> numWorkers</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 3</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> numJobs</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 10</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    jobs </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">, numJobs)</span></span>
<span class="line"><span style="color:#E1E4E8">    results </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">, numJobs)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // å¯åŠ¨å·¥ä½œåç¨‹</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#E1E4E8"> numWorkers; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#B392F0"> worker</span><span style="color:#E1E4E8">(i, jobs, results)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // å‘é€ä»»åŠ¡</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#E1E4E8"> numJobs; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        jobs </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> i</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#B392F0">    close</span><span style="color:#E1E4E8">(jobs)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // æ”¶é›†ç»“æœ</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#E1E4E8"> numJobs; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Result: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8">results)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> worker</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">jobs</span><span style="color:#F97583"> &lt;-chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">results</span><span style="color:#F97583"> chan&lt;-</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> job </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> jobs {</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Worker </span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF"> processing job </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, id, job)</span></span>
<span class="line"><span style="color:#E1E4E8">        time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Millisecond </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// æ¨¡æ‹Ÿå·¥ä½œ</span></span>
<span class="line"><span style="color:#E1E4E8">        results </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> job </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>2. æ‰‡å…¥æ‰‡å‡ºæ¨¡å¼</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// æ‰‡å‡ºï¼šä¸€ä¸ª channel åˆ†å‘ç»™å¤šä¸ª goroutine</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> fanOut</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">input</span><span style="color:#F97583"> &lt;-chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">outputs</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">chan&lt;-</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> _, ch </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> outputs {</span></span>
<span class="line"><span style="color:#B392F0">            close</span><span style="color:#E1E4E8">(ch)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> value </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> input {</span></span>
<span class="line"><span style="color:#6A737D">        // è½®è¯¢åˆ†å‘</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> _, ch </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> outputs {</span></span>
<span class="line"><span style="color:#E1E4E8">            ch </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> value</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// æ‰‡å…¥ï¼šå¤šä¸ª channel åˆå¹¶æˆä¸€ä¸ª</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> fanIn</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">inputs</span><span style="color:#F97583"> ...&lt;-chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">&lt;-chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    output </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> wg </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">WaitGroup</span></span>
<span class="line"><span style="color:#E1E4E8">    wg.</span><span style="color:#B392F0">Add</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">len</span><span style="color:#E1E4E8">(inputs))</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> _, input </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> inputs {</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ch</span><span style="color:#F97583"> &lt;-chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">            defer</span><span style="color:#E1E4E8"> wg.</span><span style="color:#B392F0">Done</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> value </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> ch {</span></span>
<span class="line"><span style="color:#E1E4E8">                output </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> value</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }(input)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        wg.</span><span style="color:#B392F0">Wait</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#B392F0">        close</span><span style="color:#E1E4E8">(output)</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> output</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>3. è¶…æ—¶å’Œå–æ¶ˆæ¨¡å¼</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> timeoutExample</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        ch </span><span style="color:#F97583">&lt;-</span><span style="color:#9ECBFF"> &quot;result&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    select</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    case</span><span style="color:#E1E4E8"> result </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch:</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Got result: </span><span style="color:#79B8FF">%s\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, result)</span></span>
<span class="line"><span style="color:#F97583">    case</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">time.</span><span style="color:#B392F0">After</span><span style="color:#E1E4E8">(time.Second):</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Timeout!&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> cancellationExample</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    done </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> bool</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            select</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">done:</span></span>
<span class="line"><span style="color:#E1E4E8">                fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Cancelled!&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">                return</span></span>
<span class="line"><span style="color:#F97583">            default</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">                fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Working...&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Millisecond </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#B392F0">    close</span><span style="color:#E1E4E8">(done) </span><span style="color:#6A737D">// å‘é€å–æ¶ˆä¿¡å·</span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Millisecond </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="-select-è¯­å¥çš„å¦™ç”¨">ğŸ¯ select è¯­å¥çš„å¦™ç”¨</h2>
<h3 id="select-çš„åŸºæœ¬ç”¨æ³•">select çš„åŸºæœ¬ç”¨æ³•</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> selectBasics</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch1 </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    ch2 </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#E1E4E8">        ch1 </span><span style="color:#F97583">&lt;-</span><span style="color:#9ECBFF"> &quot;from ch1&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        ch2 </span><span style="color:#F97583">&lt;-</span><span style="color:#9ECBFF"> &quot;from ch2&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        select</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        case</span><span style="color:#E1E4E8"> msg1 </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch1:</span></span>
<span class="line"><span style="color:#E1E4E8">            fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Received: </span><span style="color:#79B8FF">%s\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, msg1)</span></span>
<span class="line"><span style="color:#F97583">        case</span><span style="color:#E1E4E8"> msg2 </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch2:</span></span>
<span class="line"><span style="color:#E1E4E8">            fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Received: </span><span style="color:#79B8FF">%s\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, msg2)</span></span>
<span class="line"><span style="color:#F97583">        case</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">time.</span><span style="color:#B392F0">After</span><span style="color:#E1E4E8">(time.Second </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#E1E4E8">            fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Timeout!&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="select-çš„é«˜çº§æŠ€å·§">select çš„é«˜çº§æŠ€å·§</h3>
<p><strong>1. éé˜»å¡æ“ä½œ</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> nonBlockingSelect</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    select</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    case</span><span style="color:#E1E4E8"> value </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch:</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Got value: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, value)</span></span>
<span class="line"><span style="color:#F97583">    default</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;No value available&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // éé˜»å¡å‘é€</span></span>
<span class="line"><span style="color:#F97583">    select</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    case</span><span style="color:#E1E4E8"> ch </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> 42</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Sent value&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    default</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Channel is full&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>2. åŠ¨æ€ select</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> dynamicSelect</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">channels</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">&lt;-chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">&lt;-chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    output </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        defer</span><span style="color:#B392F0"> close</span><span style="color:#E1E4E8">(output)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // åŠ¨æ€æ„å»º select cases</span></span>
<span class="line"><span style="color:#E1E4E8">        cases </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">([]</span><span style="color:#B392F0">reflect</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">SelectCase</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">len</span><span style="color:#E1E4E8">(channels))</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> i, ch </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> channels {</span></span>
<span class="line"><span style="color:#E1E4E8">            cases[i] </span><span style="color:#F97583">=</span><span style="color:#B392F0"> reflect</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">SelectCase</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">                Dir:  reflect.SelectRecv,</span></span>
<span class="line"><span style="color:#E1E4E8">                Chan: reflect.</span><span style="color:#B392F0">ValueOf</span><span style="color:#E1E4E8">(ch),</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // ä½¿ç”¨åå°„è¿›è¡ŒåŠ¨æ€ select</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#B392F0"> len</span><span style="color:#E1E4E8">(cases) </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            chosen, value, ok </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> reflect.</span><span style="color:#B392F0">Select</span><span style="color:#E1E4E8">(cases)</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#F97583"> !</span><span style="color:#E1E4E8">ok {</span></span>
<span class="line"><span style="color:#6A737D">                // channel å·²å…³é—­ï¼Œç§»é™¤è¿™ä¸ª case</span></span>
<span class="line"><span style="color:#E1E4E8">                cases </span><span style="color:#F97583">=</span><span style="color:#B392F0"> append</span><span style="color:#E1E4E8">(cases[:chosen], cases[chosen</span><span style="color:#F97583">+</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">:]</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">                continue</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">            output </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> value.</span><span style="color:#B392F0">Interface</span><span style="color:#E1E4E8">().(</span><span style="color:#F97583">int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> output</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="ï¸-å¹¶å‘å®‰å…¨çš„æœ€ä½³å®è·µ">ğŸ›¡ï¸ å¹¶å‘å®‰å…¨çš„æœ€ä½³å®è·µ</h2>
<h3 id="1-é¿å…ç«æ€æ¡ä»¶">1. é¿å…ç«æ€æ¡ä»¶</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// é”™è¯¯çš„åšæ³•</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> counter </span><span style="color:#F97583">int</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> increment</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    counter</span><span style="color:#F97583">++</span><span style="color:#6A737D"> // ç«æ€æ¡ä»¶ï¼</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// æ­£ç¡®çš„åšæ³• 1: ä½¿ç”¨ channel</span></span>
<span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> SafeCounter</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> NewSafeCounter</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">*</span><span style="color:#B392F0">SafeCounter</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    sc </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &amp;</span><span style="color:#B392F0">SafeCounter</span><span style="color:#E1E4E8">{ch: </span><span style="color:#B392F0">make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)}</span></span>
<span class="line"><span style="color:#E1E4E8">    sc.ch </span><span style="color:#F97583">&lt;-</span><span style="color:#79B8FF"> 0</span><span style="color:#6A737D"> // åˆå§‹åŒ–</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> sc</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">sc </span><span style="color:#F97583">*</span><span style="color:#B392F0">SafeCounter</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Increment</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    current </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">sc.ch</span></span>
<span class="line"><span style="color:#E1E4E8">    sc.ch </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> current </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">sc </span><span style="color:#F97583">*</span><span style="color:#B392F0">SafeCounter</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Get</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">sc.ch</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// æ­£ç¡®çš„åšæ³• 2: ä½¿ç”¨ sync.Mutex</span></span>
<span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> SafeCounter2</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    mu </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Mutex</span></span>
<span class="line"><span style="color:#E1E4E8">    value </span><span style="color:#F97583">int</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">sc </span><span style="color:#F97583">*</span><span style="color:#B392F0">SafeCounter2</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Increment</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    sc.mu.</span><span style="color:#B392F0">Lock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> sc.mu.</span><span style="color:#B392F0">Unlock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    sc.value</span><span style="color:#F97583">++</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">sc </span><span style="color:#F97583">*</span><span style="color:#B392F0">SafeCounter2</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Get</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    sc.mu.</span><span style="color:#B392F0">Lock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> sc.mu.</span><span style="color:#B392F0">Unlock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> sc.value</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="2-é¿å…-goroutine-æ³„æ¼">2. é¿å… goroutine æ³„æ¼</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// é”™è¯¯çš„åšæ³• - å¯èƒ½æ³„æ¼</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> leakyFunction</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">        // è¿™ä¸ª goroutine æ°¸è¿œä¸ä¼šç»“æŸ</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            select</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch:</span></span>
<span class="line"><span style="color:#F97583">                return</span></span>
<span class="line"><span style="color:#F97583">            default</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#6A737D">                // åšä¸€äº›å·¥ä½œ</span></span>
<span class="line"><span style="color:#E1E4E8">                time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Millisecond)</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#6A737D">    // å¿˜è®°å…³é—­ channel</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// æ­£ç¡®çš„åšæ³• - ä½¿ç”¨ context</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> properFunction</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ctx</span><span style="color:#B392F0"> context</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Context</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        defer</span><span style="color:#B392F0"> close</span><span style="color:#E1E4E8">(ch)</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            select</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ctx.</span><span style="color:#B392F0">Done</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#F97583">                return</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ch:</span></span>
<span class="line"><span style="color:#F97583">                return</span></span>
<span class="line"><span style="color:#F97583">            default</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#6A737D">                // åšä¸€äº›å·¥ä½œ</span></span>
<span class="line"><span style="color:#E1E4E8">                time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Millisecond)</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // ä½¿ç”¨ context æ§åˆ¶ç”Ÿå‘½å‘¨æœŸ</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#E1E4E8">        ctx.</span><span style="color:#B392F0">Done</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="3-èµ„æºç®¡ç†">3. èµ„æºç®¡ç†</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// ä½¿ç”¨ sync.WaitGroup ç­‰å¾… goroutine å®Œæˆ</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> waitGroupExample</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> wg </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">WaitGroup</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 5</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        wg.</span><span style="color:#B392F0">Add</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">            defer</span><span style="color:#E1E4E8"> wg.</span><span style="color:#B392F0">Done</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">            fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Worker </span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF"> starting</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, id)</span></span>
<span class="line"><span style="color:#E1E4E8">            time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#E1E4E8">            fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Worker </span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF"> done</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, id)</span></span>
<span class="line"><span style="color:#E1E4E8">        }(i)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    wg.</span><span style="color:#B392F0">Wait</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;All workers completed&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// ä½¿ç”¨ sync.Once ç¡®ä¿åªæ‰§è¡Œä¸€æ¬¡</span></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#E1E4E8"> once </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Once</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> initialize</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    once.</span><span style="color:#B392F0">Do</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Initializing...&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6A737D">        // åˆå§‹åŒ–ä»£ç </span></span>
<span class="line"><span style="color:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="-æ€§èƒ½ä¼˜åŒ–æŠ€å·§">ğŸš€ æ€§èƒ½ä¼˜åŒ–æŠ€å·§</h2>
<h3 id="1-ä½¿ç”¨å¯¹è±¡æ± ">1. ä½¿ç”¨å¯¹è±¡æ± </h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#9ECBFF"> &quot;</span><span style="color:#B392F0">sync</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> ObjectPool</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    pool </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Pool</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> NewObjectPool</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">*</span><span style="color:#B392F0">ObjectPool</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> &amp;</span><span style="color:#B392F0">ObjectPool</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">        pool: </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Pool</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">            New: </span><span style="color:#F97583">func</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">interface</span><span style="color:#E1E4E8">{} {</span></span>
<span class="line"><span style="color:#F97583">                return</span><span style="color:#F97583"> &amp;</span><span style="color:#B392F0">ExpensiveObject</span><span style="color:#E1E4E8">{}</span></span>
<span class="line"><span style="color:#E1E4E8">            },</span></span>
<span class="line"><span style="color:#E1E4E8">        },</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">op </span><span style="color:#F97583">*</span><span style="color:#B392F0">ObjectPool</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Get</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">*</span><span style="color:#B392F0">ExpensiveObject</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> op.pool.</span><span style="color:#B392F0">Get</span><span style="color:#E1E4E8">().(</span><span style="color:#F97583">*</span><span style="color:#B392F0">ExpensiveObject</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">op </span><span style="color:#F97583">*</span><span style="color:#B392F0">ObjectPool</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Put</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">obj</span><span style="color:#F97583"> *</span><span style="color:#B392F0">ExpensiveObject</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // é‡ç½®å¯¹è±¡çŠ¶æ€</span></span>
<span class="line"><span style="color:#E1E4E8">    obj.</span><span style="color:#B392F0">Reset</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    op.pool.</span><span style="color:#B392F0">Put</span><span style="color:#E1E4E8">(obj)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> ExpensiveObject</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    data []</span><span style="color:#F97583">byte</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">eo </span><span style="color:#F97583">*</span><span style="color:#B392F0">ExpensiveObject</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Reset</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    eo.data </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> eo.data[:</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="2-æ‰¹é‡å¤„ç†">2. æ‰¹é‡å¤„ç†</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> batchProcessor</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">items</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">int</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">batchSize</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    batches </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">int</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // åˆ†æ‰¹å‘é€</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        defer</span><span style="color:#B392F0"> close</span><span style="color:#E1E4E8">(batches)</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#B392F0"> len</span><span style="color:#E1E4E8">(items); i </span><span style="color:#F97583">+=</span><span style="color:#E1E4E8"> batchSize {</span></span>
<span class="line"><span style="color:#E1E4E8">            end </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> batchSize</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> end </span><span style="color:#F97583">&gt;</span><span style="color:#B392F0"> len</span><span style="color:#E1E4E8">(items) {</span></span>
<span class="line"><span style="color:#E1E4E8">                end </span><span style="color:#F97583">=</span><span style="color:#B392F0"> len</span><span style="color:#E1E4E8">(items)</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">            batches </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> items[i:end]</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // å¹¶å‘å¤„ç†æ‰¹æ¬¡</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> wg </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">WaitGroup</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        wg.</span><span style="color:#B392F0">Add</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">            defer</span><span style="color:#E1E4E8"> wg.</span><span style="color:#B392F0">Done</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> batch </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> batches {</span></span>
<span class="line"><span style="color:#B392F0">                processBatch</span><span style="color:#E1E4E8">(batch)</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }()</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    wg.</span><span style="color:#B392F0">Wait</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> processBatch</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">batch</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // å¤„ç†ä¸€æ‰¹æ•°æ®</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> _, item </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> batch {</span></span>
<span class="line"><span style="color:#6A737D">        // å¤„ç†å•ä¸ªé¡¹ç›®</span></span>
<span class="line"><span style="color:#E1E4E8">        _ </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> item </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="-è°ƒè¯•å’Œç›‘æ§">ğŸ§ª è°ƒè¯•å’Œç›‘æ§</h2>
<h3 id="1-ä½¿ç”¨-pprof-åˆ†æ">1. ä½¿ç”¨ pprof åˆ†æ</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;</span><span style="color:#B392F0">net/http</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">    _ </span><span style="color:#9ECBFF">&quot;</span><span style="color:#B392F0">net/http/pprof</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;</span><span style="color:#B392F0">runtime/pprof</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> startProfiling</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // å¯åŠ¨ pprof æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        http.</span><span style="color:#B392F0">ListenAndServe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;localhost:6060&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">nil</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // æ‰‹åŠ¨ç”Ÿæˆ profile</span></span>
<span class="line"><span style="color:#E1E4E8">    f, _ </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> os.</span><span style="color:#B392F0">Create</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;cpu.prof&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> f.</span><span style="color:#B392F0">Close</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    pprof.</span><span style="color:#B392F0">StartCPUProfile</span><span style="color:#E1E4E8">(f)</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> pprof.</span><span style="color:#B392F0">StopCPUProfile</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // ä½ çš„ç¨‹åºé€»è¾‘</span></span>
<span class="line"><span style="color:#B392F0">    runYourProgram</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> runYourProgram</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // æ¨¡æ‹Ÿç¨‹åºè¿è¡Œ</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 1000</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">            time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#E1E4E8">        }()</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="2-ç›‘æ§-goroutine-æ•°é‡">2. ç›‘æ§ goroutine æ•°é‡</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> monitorGoroutines</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    ticker </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> time.</span><span style="color:#B392F0">NewTicker</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> ticker.</span><span style="color:#B392F0">Stop</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> ticker.C {</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Active goroutines: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, runtime.</span><span style="color:#B392F0">NumGoroutine</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// åœ¨ç¨‹åºå¯åŠ¨æ—¶å¼€å§‹ç›‘æ§</span></span>
<span class="line"><span style="color:#F97583">go</span><span style="color:#B392F0"> monitorGoroutines</span><span style="color:#E1E4E8">()</span></span></code></pre>
<h2 id="-å®æˆ˜æ¡ˆä¾‹å¹¶å‘çˆ¬è™«">ğŸ¯ å®æˆ˜æ¡ˆä¾‹ï¼šå¹¶å‘çˆ¬è™«</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> Crawler</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    visited </span><span style="color:#F97583">map</span><span style="color:#E1E4E8">[</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">]</span><span style="color:#F97583">bool</span></span>
<span class="line"><span style="color:#E1E4E8">    mu      </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">RWMutex</span></span>
<span class="line"><span style="color:#E1E4E8">    queue   </span><span style="color:#F97583">chan</span><span style="color:#F97583"> string</span></span>
<span class="line"><span style="color:#E1E4E8">    results </span><span style="color:#F97583">chan</span><span style="color:#F97583"> string</span></span>
<span class="line"><span style="color:#E1E4E8">    workers </span><span style="color:#F97583">int</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> NewCrawler</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">workers</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#B392F0">Crawler</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> &amp;</span><span style="color:#B392F0">Crawler</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">        visited: </span><span style="color:#B392F0">make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">map</span><span style="color:#E1E4E8">[</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">]</span><span style="color:#F97583">bool</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">        queue:   </span><span style="color:#B392F0">make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1000</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">        results: </span><span style="color:#B392F0">make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">1000</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">        workers: workers,</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">Crawler</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Start</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">urls</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // å¯åŠ¨å·¥ä½œåç¨‹</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#E1E4E8"> c.workers; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#E1E4E8"> c.</span><span style="color:#B392F0">worker</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // å‘é€åˆå§‹ URL</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> _, url </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> urls {</span></span>
<span class="line"><span style="color:#E1E4E8">            c.queue </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> url</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#B392F0">        close</span><span style="color:#E1E4E8">(c.queue)</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // æ”¶é›†ç»“æœ</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> result </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> c.results {</span></span>
<span class="line"><span style="color:#E1E4E8">            fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Crawled: </span><span style="color:#79B8FF">%s\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, result)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">Crawler</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">worker</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> url </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> c.queue {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> c.</span><span style="color:#B392F0">isVisited</span><span style="color:#E1E4E8">(url) {</span></span>
<span class="line"><span style="color:#F97583">            continue</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        c.</span><span style="color:#B392F0">markVisited</span><span style="color:#E1E4E8">(url)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // æ¨¡æ‹Ÿçˆ¬å–</span></span>
<span class="line"><span style="color:#E1E4E8">        time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Millisecond </span><span style="color:#F97583">*</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        c.results </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> url</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // å‘ç°æ–°é“¾æ¥ï¼ˆç®€åŒ–ç‰ˆï¼‰</span></span>
<span class="line"><span style="color:#E1E4E8">        newURLs </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> c.</span><span style="color:#B392F0">extractLinks</span><span style="color:#E1E4E8">(url)</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> _, newURL </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> newURLs {</span></span>
<span class="line"><span style="color:#E1E4E8">            c.queue </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> newURL</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">Crawler</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">isVisited</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">url</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">bool</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    c.mu.</span><span style="color:#B392F0">RLock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> c.mu.</span><span style="color:#B392F0">RUnlock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> c.visited[url]</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">Crawler</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">markVisited</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">url</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    c.mu.</span><span style="color:#B392F0">Lock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> c.mu.</span><span style="color:#B392F0">Unlock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    c.visited[url] </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> true</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">Crawler</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">extractLinks</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">url</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">) []</span><span style="color:#F97583">string</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // æ¨¡æ‹Ÿæå–é“¾æ¥</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">{url </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> &quot;/link1&quot;</span><span style="color:#E1E4E8">, url </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> &quot;/link2&quot;</span><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="-æ€»ç»“ä¸€ä¸‹">ğŸ¤” æ€»ç»“ä¸€ä¸‹</h2>
<p>Go çš„å¹¶å‘ç¼–ç¨‹ç¡®å®å¾ˆä¼˜é›…ï¼Œä½†çœŸæ­£ç”¨å¥½éœ€è¦æ·±å…¥ç†è§£å…¶å·¥ä½œåŸç†ã€‚</p>
<p><strong>å…³é”®è¦ç‚¹</strong>ï¼š</p>
<ol>
<li><strong>goroutine å¾ˆè½»é‡</strong>ï¼šå¯ä»¥è½»æ¾åˆ›å»ºå¤§é‡å¹¶å‘ä»»åŠ¡</li>
<li><strong>channel æ˜¯é€šä¿¡çš„æ ¸å¿ƒ</strong>ï¼šé¿å…å…±äº«å†…å­˜ï¼Œé€šè¿‡é€šä¿¡å…±äº«å†…å­˜</li>
<li><strong>select å¾ˆçµæ´»</strong>ï¼šå¤„ç†å¤šä¸ª channel çš„å¹¶å‘æ“ä½œ</li>
<li><strong>context ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šä¼˜é›…åœ°å¤„ç†å–æ¶ˆå’Œè¶…æ—¶</li>
<li><strong>æ³¨æ„èµ„æºç®¡ç†</strong>ï¼šé¿å… goroutine æ³„æ¼å’Œç«æ€æ¡ä»¶</li>
</ol>
<p><strong>æœ€ä½³å®è·µ</strong>ï¼š</p>
<ul>
<li>ğŸš€ ä¼˜å…ˆä½¿ç”¨ channel è€Œä¸æ˜¯å…±äº«å†…å­˜</li>
<li>ğŸ›¡ï¸ ä½¿ç”¨ context ç®¡ç† goroutine ç”Ÿå‘½å‘¨æœŸ</li>
<li>ğŸ“Š ç›‘æ§ goroutine æ•°é‡å’Œæ€§èƒ½</li>
<li>ğŸ”§ åˆç†ä½¿ç”¨ç¼“å†² channel å’Œ select</li>
<li>ğŸ§ª å……åˆ†æµ‹è¯•å¹¶å‘ä»£ç </li>
</ul>
<p><strong>è¿›é˜¶æ–¹å‘</strong>ï¼š</p>
<ul>
<li><strong>å†…å­˜æ¨¡å‹</strong>ï¼šç†è§£ Go çš„å†…å­˜ä¸€è‡´æ€§ä¿è¯</li>
<li><strong>è°ƒåº¦å™¨è°ƒä¼˜</strong>ï¼šGOMAXPROCS å’Œè°ƒåº¦ç­–ç•¥</li>
<li><strong>æ€§èƒ½åˆ†æ</strong>ï¼šä½¿ç”¨ pprof å’Œ trace å·¥å…·</li>
<li><strong>åˆ†å¸ƒå¼ç³»ç»Ÿ</strong>ï¼šç»“åˆ etcdã€consul ç­‰</li>
</ul>
<p>å¸Œæœ›è¿™ç¯‡æ·±åº¦è§£æå¯¹ç†è§£ Go å¹¶å‘ç¼–ç¨‹æœ‰å¸®åŠ©ï¼</p>
<blockquote>
<p>ğŸ’¡ <strong>å°è´´å£«</strong>ï¼šå¹¶å‘ç¼–ç¨‹çš„æ ¸å¿ƒæ˜¯ç†è§£æ•°æ®æµï¼Œè€Œä¸æ˜¯æ§åˆ¶æµã€‚Go çš„ channel è®©æ•°æ®æµå˜å¾—æ¸…æ™°å¯è§ã€‚</p>
</blockquote> </div> </div> <!-- æ–‡ç« åº•éƒ¨å¯¼èˆª --> <div class="mt-8 flex justify-between items-center" data-astro-cid-gjtny2mx> <a href="/my-blog/" class="dark-btn-outline px-6 py-3 rounded-lg text-sm" data-astro-cid-gjtny2mx>
â† è¿”å›é¦–é¡µ
</a> <div class="flex space-x-4" data-astro-cid-gjtny2mx> <button class="dark-btn px-6 py-3 rounded-lg text-sm" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" data-astro-cid-gjtny2mx>
â†‘ å›åˆ°é¡¶éƒ¨
</button> </div> </div> </article> <!-- ä¾§è¾¹æ  --> <aside class="lg:col-span-1" data-astro-cid-gjtny2mx> <div class="sticky top-24 space-y-6" data-astro-cid-gjtny2mx> <!-- æ–‡ç« ä¿¡æ¯å¡ç‰‡ --> <div class="dark-card p-6 rounded-xl" data-astro-cid-gjtny2mx> <h3 class="font-bold text-white mb-4 neon-text" data-astro-cid-gjtny2mx>æ–‡ç« ä¿¡æ¯</h3> <div class="space-y-4 text-sm" data-astro-cid-gjtny2mx> <div class="flex justify-between items-center" data-astro-cid-gjtny2mx> <span class="text-gray-400" data-astro-cid-gjtny2mx>å‘å¸ƒæ—¶é—´</span> <span class="text-white font-mono" data-astro-cid-gjtny2mx>2024/12/28</span> </div> <div class="flex justify-between items-center" data-astro-cid-gjtny2mx> <span class="text-gray-400" data-astro-cid-gjtny2mx>åˆ†ç±»</span> <span class="neon-text font-bold" data-astro-cid-gjtny2mx>åç«¯å¼€å‘</span> </div> <div data-astro-cid-gjtny2mx> <span class="text-gray-400 block mb-3" data-astro-cid-gjtny2mx>æ ‡ç­¾</span> <div class="flex flex-wrap gap-2" data-astro-cid-gjtny2mx> <span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> Go </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> Golang </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> å¹¶å‘ç¼–ç¨‹ </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> goroutine </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> channel </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> åç«¯å¼€å‘ </span> </div> </div> </div> </div> <!-- ç›®å½• --> <div class="dark-card p-6 rounded-xl" data-astro-cid-gjtny2mx> <h3 class="font-bold text-white mb-4 neon-text" data-astro-cid-gjtny2mx>ç›®å½•</h3> <div class="text-sm space-y-3" data-astro-cid-gjtny2mx> <a href="#" class="block text-gray-300 hover:neon-text transition-all duration-300 border-l-2 border-transparent hover:border-neon-green pl-3" data-astro-cid-gjtny2mx>
â€¢ æ–‡ç« å¼€å§‹
</a> <a href="#" class="block text-gray-300 hover:neon-text transition-all duration-300 border-l-2 border-transparent hover:border-neon-green pl-3" data-astro-cid-gjtny2mx>
â€¢ ä¸»è¦å†…å®¹
</a> <a href="#" class="block text-gray-300 hover:neon-text transition-all duration-300 border-l-2 border-transparent hover:border-neon-green pl-3" data-astro-cid-gjtny2mx>
â€¢ æ€»ç»“
</a> </div> </div> <!-- ç›¸å…³æ–‡ç«  --> <div class="dark-card p-6 rounded-xl" data-astro-cid-gjtny2mx> <h3 class="font-bold text-white mb-4 neon-text" data-astro-cid-gjtny2mx>ç›¸å…³æ–‡ç« </h3> <div class="space-y-4 text-sm" data-astro-cid-gjtny2mx> <a href="/my-blog/posts/typescript-tips" class="block group border border-gray-700/50 rounded-lg p-3 hover:border-neon-green/40 transition-all duration-300" data-astro-cid-gjtny2mx> <span class="text-gray-300 group-hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>
TypeScript å°æŠ€å·§
</span> <div class="text-xs text-gray-500 mt-1" data-astro-cid-gjtny2mx>ç¼–ç¨‹è¯­è¨€</div> </a> <a href="/my-blog/posts/hello-astro" class="block group border border-gray-700/50 rounded-lg p-3 hover:border-neon-green/40 transition-all duration-300" data-astro-cid-gjtny2mx> <span class="text-gray-300 group-hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>
Hello Astro
</span> <div class="text-xs text-gray-500 mt-1" data-astro-cid-gjtny2mx>æ¡†æ¶</div> </a> </div> </div> </div> </aside> </div>  </main> <footer class="mt-20 border-t border-neon-green/30 bg-black/60 backdrop-blur-sm"> <div class="max-w-6xl mx-auto px-4 py-12"> <!-- å±…ä¸­çš„å“ç‰Œä¿¡æ¯ --> <div class="text-center mb-8"> <div class="flex items-center justify-center space-x-4 mb-6"> <div class="w-16 h-16 group"> <!-- ä»£ç é£æ ¼Logoå›¾æ ‡ - åŸºäºç¬¬ä¸€ä¸ªè®¾è®¡æ–¹æ¡ˆ --><svg viewBox="0 0 48 48" class="w-full h-full" data-astro-cid-hit3dubr> <defs data-astro-cid-hit3dubr> <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%" data-astro-cid-hit3dubr> <stop offset="0%" style="stop-color:#00ff88;stop-opacity:1" data-astro-cid-hit3dubr></stop> <stop offset="100%" style="stop-color:#3742fa;stop-opacity:1" data-astro-cid-hit3dubr></stop> </linearGradient> <filter id="logoGlow" data-astro-cid-hit3dubr> <feGaussianBlur stdDeviation="2" result="coloredBlur" data-astro-cid-hit3dubr></feGaussianBlur> <feMerge data-astro-cid-hit3dubr> <feMergeNode in="coloredBlur" data-astro-cid-hit3dubr></feMergeNode> <feMergeNode in="SourceGraphic" data-astro-cid-hit3dubr></feMergeNode> </feMerge> </filter> </defs> <!-- å¤–æ¡† --> <rect x="2" y="2" width="44" height="44" fill="none" stroke="url(#logoGrad)" stroke-width="2" rx="8" filter="url(#logoGlow)" class="group-hover:stroke-width-3 transition-all duration-300" data-astro-cid-hit3dubr></rect> <!-- å­—æ¯Fçš„ä»£ç é£æ ¼è®¾è®¡ --> <path d="M12 12 L32 12 M12 12 L12 36 M12 24 L28 24" stroke="#00ff88" stroke-width="3" stroke-linecap="round" fill="none" filter="url(#logoGlow)" class="group-hover:stroke-white transition-all duration-300" data-astro-cid-hit3dubr></path> <!-- è£…é¥°ç‚¹ --> <circle cx="36" cy="16" r="2" fill="#00ff88" class="animate-pulse group-hover:fill-white transition-all duration-300" data-astro-cid-hit3dubr></circle> <circle cx="36" cy="28" r="1.5" fill="#3742fa" class="animate-pulse group-hover:fill-white transition-all duration-300" style="animation-delay: 0.5s" data-astro-cid-hit3dubr></circle> </svg>  </div> <span class="font-black text-3xl neon-text tracking-wider">MR.FENG</span> </div> <p class="description-text text-xl leading-relaxed max-w-2xl mx-auto">
ç¼–ç¨‹ä¸ä»…æ˜¯ç§‘å­¦ï¼Œä¹Ÿæ˜¯è‰ºæœ¯<br>
åœ¨ä»£ç ä¸­æ¢ç´¢åˆ›æ–°ï¼Œåœ¨æŠ€æœ¯ä¸­å‘ç°ç¾å­¦
</p> <!-- è£…é¥°æ€§å…ƒç´  --> <div class="flex justify-center items-center space-x-8 mt-8"> <div class="w-16 h-px bg-gradient-to-r from-transparent to-neon-green"></div> <div class="w-3 h-3 border-2 border-neon-green bg-neon-green/20 rounded-full animate-pulse"></div> <div class="w-16 h-px bg-gradient-to-l from-transparent to-neon-green"></div> </div> </div> <!-- åˆ†å‰²çº¿ --> <div class="h-px bg-gradient-to-r from-transparent via-neon-green/50 to-transparent mb-6"></div> <!-- åº•éƒ¨ä¿¡æ¯ --> <div class="flex flex-col md:flex-row justify-between items-center text-sm text-gray-400"> <p>
Â© 2025 Mr. Feng â€¢
<span class="neon-text">Powered by Astro</span> </p> <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ --> <div class="flex items-center space-x-2 mt-4 md:mt-0"> <div class="w-3 h-3 bg-neon-green rounded-full animate-pulse"></div> <span class="text-xs text-gray-500">SYSTEM ONLINE</span> </div> </div> </div> <!-- åº•éƒ¨å‘å…‰æ•ˆæœ --> <div class="h-px bg-gradient-to-r from-transparent via-neon-green to-transparent opacity-60"></div> </footer> <!-- å¢å¼ºçš„ç²’å­ç”Ÿæˆè„šæœ¬ --> <script type="module">function o(){const e=document.getElementById("particles");if(!e)return;const n=40;for(let a=0;a<n;a++){const t=document.createElement("div");t.className="particle",t.style.left=Math.random()*100+"%",t.style.top=Math.random()*100+"%",t.style.animationDelay=Math.random()*8+"s",t.style.animationDuration=Math.random()*4+6+"s",e.appendChild(t)}}document.addEventListener("DOMContentLoaded",o);</script> </body> </html> 