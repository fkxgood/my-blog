<!DOCTYPE html><html lang="zh-CN" class="scroll-smooth"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Mr. Feng — 暗黑科技博客</title><meta name="description" content="编程不仅是科学，也是艺术。在代码中，我们找到了表达自我和解决问题的新途径。"><link rel="stylesheet" href="/my-blog/_astro/about.BfSHQvgF.css">
<style>.prose[data-astro-cid-gjtny2mx]{color:#fff}.prose[data-astro-cid-gjtny2mx] h1[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h2[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h3[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h4[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h5[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h6[data-astro-cid-gjtny2mx]{color:#fff;font-weight:700}.prose[data-astro-cid-gjtny2mx] h2[data-astro-cid-gjtny2mx]{border-bottom:2px solid rgba(0,255,136,.3);padding-bottom:.75rem;margin-top:2.5rem;margin-bottom:1.5rem;color:#0f8;text-shadow:0 0 10px rgba(0,255,136,.3)}.prose[data-astro-cid-gjtny2mx] h3[data-astro-cid-gjtny2mx]{color:#0f8;margin-top:2rem;margin-bottom:1rem}.prose[data-astro-cid-gjtny2mx] a[data-astro-cid-gjtny2mx]{color:#0f8;text-decoration:none;text-shadow:0 0 5px rgba(0,255,136,.3)}.prose[data-astro-cid-gjtny2mx] a[data-astro-cid-gjtny2mx]:hover{color:#fff;text-shadow:0 0 10px #00ff88;text-decoration:underline}.prose[data-astro-cid-gjtny2mx] code[data-astro-cid-gjtny2mx]{background:#00ff8826;border:1px solid rgba(0,255,136,.3);border-radius:.375rem;padding:.25rem .5rem;color:#0f8;font-size:.9em;font-weight:600}.prose[data-astro-cid-gjtny2mx] pre[data-astro-cid-gjtny2mx]{background:#0a0a0a;border:1px solid rgba(0,255,136,.3);border-radius:.75rem;padding:1.5rem;overflow-x:auto;box-shadow:0 0 20px #00ff881a}.prose[data-astro-cid-gjtny2mx] pre[data-astro-cid-gjtny2mx] code[data-astro-cid-gjtny2mx]{background:transparent;border:none;padding:0;color:#fff;text-shadow:none;font-weight:400}.prose[data-astro-cid-gjtny2mx] blockquote[data-astro-cid-gjtny2mx]{border-left:4px solid #00ff88;background:#00ff880d;margin:1.5rem 0;padding:1rem 1.5rem;font-style:italic;border-radius:0 .5rem .5rem 0}.prose[data-astro-cid-gjtny2mx] ul[data-astro-cid-gjtny2mx] li[data-astro-cid-gjtny2mx]::marker,.prose[data-astro-cid-gjtny2mx] ol[data-astro-cid-gjtny2mx] li[data-astro-cid-gjtny2mx]::marker{color:#0f8}.prose[data-astro-cid-gjtny2mx] strong[data-astro-cid-gjtny2mx]{color:#fff;font-weight:700}.prose[data-astro-cid-gjtny2mx] p[data-astro-cid-gjtny2mx]{line-height:1.8;margin-bottom:1.25rem}
</style>
<link rel="stylesheet" href="/my-blog/_astro/fingerprinthub_classify_blog.CxlJjaYK.css"></head> <body class="dark-bg grid-bg min-h-screen text-white font-sans relative overflow-x-hidden"> <!-- 增强的粒子背景 --> <div class="particles" id="particles"></div> <header class="bg-black/80 backdrop-blur-md border-b border-neon-green/30 sticky top-0 z-50"> <div class="max-w-6xl mx-auto px-4 flex items-center justify-between h-16"> <!-- Logo --> <a href="/my-blog/" class="flex items-center space-x-3 group"> <div class="w-12 h-12"> <!-- 代码风格Logo图标 - 基于第一个设计方案 --><svg viewBox="0 0 48 48" class="w-full h-full" data-astro-cid-hit3dubr> <defs data-astro-cid-hit3dubr> <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%" data-astro-cid-hit3dubr> <stop offset="0%" style="stop-color:#00ff88;stop-opacity:1" data-astro-cid-hit3dubr></stop> <stop offset="100%" style="stop-color:#3742fa;stop-opacity:1" data-astro-cid-hit3dubr></stop> </linearGradient> <filter id="logoGlow" data-astro-cid-hit3dubr> <feGaussianBlur stdDeviation="2" result="coloredBlur" data-astro-cid-hit3dubr></feGaussianBlur> <feMerge data-astro-cid-hit3dubr> <feMergeNode in="coloredBlur" data-astro-cid-hit3dubr></feMergeNode> <feMergeNode in="SourceGraphic" data-astro-cid-hit3dubr></feMergeNode> </feMerge> </filter> </defs> <!-- 外框 --> <rect x="2" y="2" width="44" height="44" fill="none" stroke="url(#logoGrad)" stroke-width="2" rx="8" filter="url(#logoGlow)" class="group-hover:stroke-width-3 transition-all duration-300" data-astro-cid-hit3dubr></rect> <!-- 字母F的代码风格设计 --> <path d="M12 12 L32 12 M12 12 L12 36 M12 24 L28 24" stroke="#00ff88" stroke-width="3" stroke-linecap="round" fill="none" filter="url(#logoGlow)" class="group-hover:stroke-white transition-all duration-300" data-astro-cid-hit3dubr></path> <!-- 装饰点 --> <circle cx="36" cy="16" r="2" fill="#00ff88" class="animate-pulse group-hover:fill-white transition-all duration-300" data-astro-cid-hit3dubr></circle> <circle cx="36" cy="28" r="1.5" fill="#3742fa" class="animate-pulse group-hover:fill-white transition-all duration-300" style="animation-delay: 0.5s" data-astro-cid-hit3dubr></circle> </svg>  </div> <span class="font-bold text-2xl neon-logo group-hover:neon-logo transition-all duration-300">
MR.FENG
</span> </a> <!-- 导航菜单 --> <nav class="hidden md:flex items-center space-x-8"> <a href="/my-blog/" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
首页
</a> <a href="/my-blog/categories" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
分类
</a> <a href="/my-blog/tags" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
标签
</a> <a href="/my-blog/about" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
关于
</a> </nav> <!-- 右侧工具栏 --> <div class="flex items-center space-x-4"> <div class="relative"> <input id="search-input" type="search" placeholder="搜索文章…" class="dark-input w-full sm:w-64 px-4 py-2 text-sm placeholder-gray-400"> <ul id="search-results" class="absolute top-full mt-2 w-full sm:w-96 bg-black/90 backdrop-blur-md border border-neon-green/30 rounded-lg shadow-2xl max-h-60 overflow-y-auto hidden z-50"></ul> </div> <script type="module">
  import Fuse from 'https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.esm.min.js';

  const input = document.getElementById('search-input');
  const resultsEl = document.getElementById('search-results');
  let fuse;

  async function initSearch() {
    const res = await fetch('/my-blog/search.json');
    const data = await res.json();
    fuse = new Fuse(data, {
      keys: ['title', 'content', 'category', 'tags'],
      threshold: 0.3,
      ignoreLocation: true,
    });
  }

  function render(results) {
    if (!results.length) {
      resultsEl.innerHTML = '<li class="p-4 text-center text-gray-400">无匹配结果</li>';
      return;
    }
    resultsEl.innerHTML = results
      .slice(0, 8)
      .map(r => `
        <li>
          <a href="${r.item.url}" class="block px-4 py-3 text-white hover:bg-neon-green/10 hover:border-l-2 hover:border-neon-green transition-all duration-300 border-l-2 border-transparent">
            <div class="font-medium">${r.item.title}</div>
            <div class="text-xs text-gray-400 mt-1">${r.item.category || '未分类'}</div>
          </a>
        </li>
      `) 
      .join('');
  }

  input.addEventListener('focus', () => {
    resultsEl.classList.remove('hidden');
    if (!fuse) initSearch();
  });

  document.addEventListener('click', (e) => {
    if (!input.contains(e.target) && !resultsEl.contains(e.target)) {
      resultsEl.classList.add('hidden');
    }
  });

  input.addEventListener('input', () => {
    if (!fuse) return;
    const q = input.value.trim();
    if (!q) {
      resultsEl.innerHTML = '';
      return;
    }
    const results = fuse.search(q);
    render(results);
  });
</script> <button id="theme-toggle" aria-label="切换暗色模式" class="w-9 h-9 rounded-full flex items-center justify-center hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"> <svg id="icon-sun" class="w-5 h-5 hidden" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"> <path d="M12 4.5V2m0 20v-2.5m7.778-12.728l1.768-1.768M2.454 21.546l1.768-1.768m0-14.556L2.454 4.454m18.092 16.092l-1.768-1.768M4.5 12H2m20 0h-2.5M6.222 17.778l-1.768 1.768m16.092-18.092l-1.768 1.768" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg id="icon-moon" class="w-5 h-5 hidden" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"> <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z"></path> </svg> </button> <script type="module">const l=document.getElementById("theme-toggle"),t=document.getElementById("icon-sun"),o=document.getElementById("icon-moon");if(l&&t&&o){const n=d=>{d?(o.style.display="none",t.style.display="block"):(t.style.display="none",o.style.display="block")},c=window.matchMedia("(prefers-color-scheme: dark)").matches,s=localStorage.getItem("theme");let e=s?s==="dark":c;document.documentElement.classList.toggle("dark",e),n(e),l.addEventListener("click",()=>{e=!e,document.documentElement.classList.toggle("dark",e),localStorage.setItem("theme",e?"dark":"light"),n(e)})}</script> <!-- 移动端菜单按钮 --> <button class="md:hidden p-2 text-white hover:neon-text transition-all duration-300" id="mobile-menu-btn"> <div class="w-6 h-0.5 bg-current mb-1 transition-all duration-300"></div> <div class="w-6 h-0.5 bg-current mb-1 transition-all duration-300"></div> <div class="w-6 h-0.5 bg-current transition-all duration-300"></div> </button> </div> </div> <!-- 移动端菜单 --> <div class="md:hidden bg-black/90 backdrop-blur-md border-t border-neon-green/30 hidden" id="mobile-menu"> <div class="px-4 py-6 space-y-4"> <a href="/my-blog/" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">首页</a> <a href="/my-blog/categories" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">分类</a> <a href="/my-blog/tags" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">标签</a> <a href="/my-blog/about" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">关于</a> </div> </div> </header> <script type="module">document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("mobile-menu-btn"),n=document.getElementById("mobile-menu");t?.addEventListener("click",()=>{n?.classList.toggle("hidden");const e=t.querySelectorAll("div");n?.classList.contains("hidden")?(e[0].style.transform="rotate(0deg)",e[1].style.opacity="1",e[2].style.transform="rotate(0deg)"):(e[0].style.transform="rotate(45deg) translate(5px, 5px)",e[1].style.opacity="0",e[2].style.transform="rotate(-45deg) translate(7px, -6px)")})});</script> <main class="max-w-6xl mx-auto px-4 py-8 relative z-10">   <nav class="mb-8 text-sm" data-astro-cid-gjtny2mx> <div class="flex items-center space-x-3 text-gray-400" data-astro-cid-gjtny2mx> <a href="/my-blog/" class="hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>首页</a> <span class="neon-text" data-astro-cid-gjtny2mx>•</span> <a href="/my-blog/categories" class="hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>分类</a> <span class="neon-text" data-astro-cid-gjtny2mx>•</span> <span class="neon-text font-bold" data-astro-cid-gjtny2mx>后端开发</span> </div> </nav>  <header class="mb-12" data-astro-cid-gjtny2mx> <div class="dark-card p-10 rounded-xl" data-astro-cid-gjtny2mx> <!-- 分类标签 --> <div class="mb-6" data-astro-cid-gjtny2mx> <span class="px-4 py-2 text-sm font-bold bg-neon-green/20 text-neon-green rounded-full border border-neon-green/40 uppercase tracking-wider" data-astro-cid-gjtny2mx> 后端开发 </span> </div> <!-- 文章标题 --> <h1 class="text-4xl md:text-5xl font-black text-white mb-6 leading-tight" data-astro-cid-gjtny2mx> Go 并发编程基础 —— 从进程到 goroutine 的深度理解 </h1> <!-- 文章描述 --> <p class="text-xl text-gray-300 mb-8 leading-relaxed" data-astro-cid-gjtny2mx> 深入理解 Go 并发编程的核心概念，从操作系统层面的进程线程，到 Go 语言的 goroutine 协程，掌握并发编程的基础知识 </p> <!-- 文章元信息 --> <div class="flex flex-wrap items-center gap-6 text-sm" data-astro-cid-gjtny2mx> <div class="flex items-center space-x-3" data-astro-cid-gjtny2mx> <div class="w-3 h-3 bg-neon-green rounded-full animate-pulse" data-astro-cid-gjtny2mx></div> <time class="font-mono text-gray-300 bg-dark-600/50 px-3 py-1 rounded" data-astro-cid-gjtny2mx> 2024年12月28日 </time> </div> <div class="flex items-center space-x-3" data-astro-cid-gjtny2mx> <div class="w-3 h-3 bg-neon-blue rounded-full animate-pulse" data-astro-cid-gjtny2mx></div> <div class="flex gap-2 flex-wrap" data-astro-cid-gjtny2mx> <span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#Go </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#Golang </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#并发编程 </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#进程 </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#线程 </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#goroutine </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#后端开发 </span> </div> </div> </div> </div> </header>  <div class="grid lg:grid-cols-4 gap-8" data-astro-cid-gjtny2mx> <!-- 主要内容 --> <article class="lg:col-span-3" data-astro-cid-gjtny2mx> <div class="dark-card p-10 rounded-xl" data-astro-cid-gjtny2mx> <div class="prose prose-invert prose-lg max-w-none" data-astro-cid-gjtny2mx> <h1 id="go-并发编程基础--从进程到-goroutine-的深度理解">Go 并发编程基础 —— 从进程到 goroutine 的深度理解</h1>
<blockquote>
<p>并发编程是现代软件开发中不可或缺的技能，而 Go 语言在并发处理方面有着天然的优势。这篇文章将从操作系统的基础概念开始，逐步深入到 Go 的并发模型。</p>
</blockquote>
<h2 id="理解并发的基础概念">理解并发的基础概念</h2>
<h3 id="进程程序的执行实例">进程：程序的执行实例</h3>
<p>在操作系统中，进程是程序执行的基本单位。每个进程都有自己独立的内存空间，包含代码段、数据段、堆栈等。</p>
<p><strong>进程的特点：</strong></p>
<ul>
<li>拥有独立的内存地址空间</li>
<li>进程间通信需要特殊机制（管道、信号、共享内存等）</li>
<li>创建和销毁开销较大</li>
<li>进程切换需要保存和恢复整个上下文</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// 在 Go 中查看进程信息</span></span>
<span class="line"><span style="color:#F97583">package</span><span style="color:#B392F0"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;</span><span style="color:#B392F0">fmt</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;</span><span style="color:#B392F0">os</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;</span><span style="color:#B392F0">runtime</span><span style="color:#9ECBFF">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // 获取当前进程 ID</span></span>
<span class="line"><span style="color:#E1E4E8">    pid </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> os.</span><span style="color:#B392F0">Getpid</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;当前进程 ID: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, pid)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 获取操作系统信息</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;操作系统: </span><span style="color:#79B8FF">%s\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, runtime.GOOS)</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;架构: </span><span style="color:#79B8FF">%s\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, runtime.GOARCH)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>输出结果：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>当前进程 ID: 12345</span></span>
<span class="line"><span>操作系统: windows</span></span>
<span class="line"><span>架构: amd64</span></span></code></pre>
<h3 id="线程轻量级的执行单元">线程：轻量级的执行单元</h3>
<p>线程是进程内的执行单元，共享进程的内存空间，但拥有独立的栈空间。</p>
<p><strong>线程的优势：</strong></p>
<ul>
<li>创建和销毁开销比进程小</li>
<li>线程间通信更简单（共享内存）</li>
<li>切换开销相对较小</li>
</ul>
<p><strong>线程的挑战：</strong></p>
<ul>
<li>需要手动管理同步和互斥</li>
<li>容易出现竞态条件</li>
<li>线程数量过多时性能下降</li>
</ul>
<h2 id="并发-vs-并行概念辨析">并发 vs 并行：概念辨析</h2>
<h3 id="并发concurrency">并发（Concurrency）</h3>
<p>并发是指多个任务在时间上交替执行，在任意时刻只有一个任务在执行。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// 并发示例：单核 CPU 上的多任务</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> concurrentExample</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // 任务 A 和任务 B 交替执行</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#B392F0"> taskA</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#B392F0"> taskB</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 在单核 CPU 上，A 和 B 会交替执行</span></span>
<span class="line"><span style="color:#6A737D">    // 但同一时刻只有一个在执行</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> taskA</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;任务A: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, i)</span></span>
<span class="line"><span style="color:#E1E4E8">        time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">100</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> time.Millisecond)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> taskB</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;任务B: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, i)</span></span>
<span class="line"><span style="color:#E1E4E8">        time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">100</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> time.Millisecond)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>输出结果：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>任务A: 0</span></span>
<span class="line"><span>任务B: 0</span></span>
<span class="line"><span>任务A: 1</span></span>
<span class="line"><span>任务B: 1</span></span>
<span class="line"><span>任务A: 2</span></span>
<span class="line"><span>任务B: 2</span></span></code></pre>
<h3 id="并行parallelism">并行（Parallelism）</h3>
<p>并行是指多个任务同时执行，需要多核 CPU 的支持。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// 并行示例：多核 CPU 上的同时执行</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> parallelExample</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // 设置使用多个 CPU 核心</span></span>
<span class="line"><span style="color:#E1E4E8">    runtime.</span><span style="color:#B392F0">GOMAXPROCS</span><span style="color:#E1E4E8">(runtime.</span><span style="color:#B392F0">NumCPU</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#B392F0"> taskA</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#B392F0"> taskB</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 在多核 CPU 上，A 和 B 可能真正同时执行</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="实际应用中的区别">实际应用中的区别</h3>






























<table><thead><tr><th>场景</th><th>并发</th><th>并行</th></tr></thead><tbody><tr><td><strong>单核 CPU</strong></td><td>✅ 支持</td><td>❌ 不支持</td></tr><tr><td><strong>多核 CPU</strong></td><td>✅ 支持</td><td>✅ 支持</td></tr><tr><td><strong>Web 服务器</strong></td><td>处理多个请求</td><td>同时处理请求</td></tr><tr><td><strong>数据处理</strong></td><td>分时处理任务</td><td>同时处理数据</td></tr></tbody></table>
<h2 id="go-的并发模型goroutine">Go 的并发模型：goroutine</h2>
<h3 id="goroutine-的本质">goroutine 的本质</h3>
<p>goroutine 是 Go 语言中的轻量级线程，由 Go runtime 管理，而不是操作系统。</p>
<p><strong>goroutine 的优势：</strong></p>
<ul>
<li>内存占用小（初始 2KB）</li>
<li>创建和销毁开销极小</li>
<li>由 Go runtime 调度，更高效</li>
<li>支持大量并发</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// goroutine 的基本使用</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> basicGoroutine</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // 启动一个 goroutine</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;这是在一个 goroutine 中执行的&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;这是在主 goroutine 中执行的&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 等待一段时间让 goroutine 执行</span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">100</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> time.Millisecond)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>输出结果：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>这是在主 goroutine 中执行的</span></span>
<span class="line"><span>这是在一个 goroutine 中执行的</span></span></code></pre>
<h3 id="goroutine-的生命周期">goroutine 的生命周期</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> goroutineLifecycle</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;主程序开始&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 启动 goroutine</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;goroutine 开始执行&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">200</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> time.Millisecond)</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;goroutine 执行完成&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;主程序继续执行&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">300</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> time.Millisecond)</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;主程序结束&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>输出结果：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>主程序开始</span></span>
<span class="line"><span>主程序继续执行</span></span>
<span class="line"><span>goroutine 开始执行</span></span>
<span class="line"><span>goroutine 执行完成</span></span>
<span class="line"><span>主程序结束</span></span></code></pre>
<h2 id="实战从简单到复杂的并发示例">实战：从简单到复杂的并发示例</h2>
<h3 id="1-基础并发执行">1. 基础并发执行</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> basicConcurrency</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;=== 基础并发示例 ===&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 启动多个 goroutine</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">            fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Goroutine </span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF"> 开始</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, id)</span></span>
<span class="line"><span style="color:#E1E4E8">            time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.</span><span style="color:#B392F0">Duration</span><span style="color:#E1E4E8">(id</span><span style="color:#F97583">*</span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> time.Millisecond)</span></span>
<span class="line"><span style="color:#E1E4E8">            fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Goroutine </span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF"> 结束</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, id)</span></span>
<span class="line"><span style="color:#E1E4E8">        }(i)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 主程序等待</span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">500</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> time.Millisecond)</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;所有 goroutine 执行完毕&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>输出结果：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>=== 基础并发示例 ===</span></span>
<span class="line"><span>Goroutine 0 开始</span></span>
<span class="line"><span>Goroutine 1 开始</span></span>
<span class="line"><span>Goroutine 2 开始</span></span>
<span class="line"><span>Goroutine 0 结束</span></span>
<span class="line"><span>Goroutine 1 结束</span></span>
<span class="line"><span>Goroutine 2 结束</span></span>
<span class="line"><span>所有 goroutine 执行完毕</span></span></code></pre>
<h3 id="2-使用-syncwaitgroup-等待">2. 使用 sync.WaitGroup 等待</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> waitGroupExample</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;=== WaitGroup 示例 ===&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> wg </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">WaitGroup</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 启动 3 个 goroutine</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        wg.</span><span style="color:#B392F0">Add</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// 增加等待计数</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">            defer</span><span style="color:#E1E4E8"> wg.</span><span style="color:#B392F0">Done</span><span style="color:#E1E4E8">() </span><span style="color:#6A737D">// 完成后减少计数</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#E1E4E8">            fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Worker </span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF"> 开始工作</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, id)</span></span>
<span class="line"><span style="color:#E1E4E8">            time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.</span><span style="color:#B392F0">Duration</span><span style="color:#E1E4E8">(id</span><span style="color:#F97583">*</span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> time.Millisecond)</span></span>
<span class="line"><span style="color:#E1E4E8">            fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Worker </span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF"> 完成工作</span><span style="color:#79B8FF">\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, id)</span></span>
<span class="line"><span style="color:#E1E4E8">        }(i)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 等待所有 goroutine 完成</span></span>
<span class="line"><span style="color:#E1E4E8">    wg.</span><span style="color:#B392F0">Wait</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;所有工作完成&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>输出结果：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>=== WaitGroup 示例 ===</span></span>
<span class="line"><span>Worker 0 开始工作</span></span>
<span class="line"><span>Worker 1 开始工作</span></span>
<span class="line"><span>Worker 2 开始工作</span></span>
<span class="line"><span>Worker 0 完成工作</span></span>
<span class="line"><span>Worker 1 完成工作</span></span>
<span class="line"><span>Worker 2 完成工作</span></span>
<span class="line"><span>所有工作完成</span></span></code></pre>
<h3 id="3-并发安全的计数器">3. 并发安全的计数器</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> concurrentCounter</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;=== 并发安全计数器 ===&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> counter </span><span style="color:#F97583">int</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> mu </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Mutex</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> wg </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">WaitGroup</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 启动多个 goroutine 同时增加计数器</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 1000</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        wg.</span><span style="color:#B392F0">Add</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">            defer</span><span style="color:#E1E4E8"> wg.</span><span style="color:#B392F0">Done</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#E1E4E8">            mu.</span><span style="color:#B392F0">Lock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">            counter</span><span style="color:#F97583">++</span></span>
<span class="line"><span style="color:#E1E4E8">            mu.</span><span style="color:#B392F0">Unlock</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">        }()</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    wg.</span><span style="color:#B392F0">Wait</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;最终计数: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, counter)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>输出结果：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>=== 并发安全计数器 ===</span></span>
<span class="line"><span>最终计数: 1000</span></span></code></pre>
<h3 id="4-使用-channel-进行通信">4. 使用 channel 进行通信</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> channelCommunication</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;=== Channel 通信示例 ===&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    ch </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 生产者</span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 5</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            ch </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> fmt.</span><span style="color:#B392F0">Sprintf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;消息 </span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, i)</span></span>
<span class="line"><span style="color:#E1E4E8">            time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">100</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> time.Millisecond)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#B392F0">        close</span><span style="color:#E1E4E8">(ch) </span><span style="color:#6A737D">// 关闭 channel</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 消费者</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> msg </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> ch {</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;收到: </span><span style="color:#79B8FF">%s\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, msg)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;通信完成&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>输出结果：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>=== Channel 通信示例 ===</span></span>
<span class="line"><span>收到: 消息 0</span></span>
<span class="line"><span>收到: 消息 1</span></span>
<span class="line"><span>收到: 消息 2</span></span>
<span class="line"><span>收到: 消息 3</span></span>
<span class="line"><span>收到: 消息 4</span></span>
<span class="line"><span>通信完成</span></span></code></pre>
<h2 id="go-runtime-的调度机制">Go Runtime 的调度机制</h2>
<h3 id="gmp-模型">GMP 模型</h3>
<p>Go 使用 GMP 模型进行调度：</p>
<ul>
<li><strong>G (Goroutine)</strong>：用户态的协程</li>
<li><strong>M (Machine)</strong>：系统线程</li>
<li><strong>P (Processor)</strong>：处理器，连接 G 和 M</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> runtimeInfo</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;CPU 核心数: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, runtime.</span><span style="color:#B392F0">NumCPU</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;当前 goroutine 数: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, runtime.</span><span style="color:#B392F0">NumGoroutine</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;当前系统线程数: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, runtime.</span><span style="color:#B392F0">GOMAXPROCS</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">))</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>输出结果：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>CPU 核心数: 8</span></span>
<span class="line"><span>当前 goroutine 数: 1</span></span>
<span class="line"><span>当前系统线程数: 8</span></span></code></pre>
<h3 id="调度策略">调度策略</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> schedulingDemo</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // 设置最大 CPU 使用数</span></span>
<span class="line"><span style="color:#E1E4E8">    runtime.</span><span style="color:#B392F0">GOMAXPROCS</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;设置后的 CPU 数: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, runtime.</span><span style="color:#B392F0">GOMAXPROCS</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">))</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 启动大量 goroutine 观察调度</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 100</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">            // 模拟 CPU 密集型任务</span></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; j </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 1000000</span><span style="color:#E1E4E8">; j</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">                _ </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> j </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> j</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }(i)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;活跃 goroutine 数: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, runtime.</span><span style="color:#B392F0">NumGoroutine</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>输出结果：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>设置后的 CPU 数: 2</span></span>
<span class="line"><span>活跃 goroutine 数: 101</span></span></code></pre>
<h2 id="性能调优和最佳实践">性能调优和最佳实践</h2>
<h3 id="1-合理设置-gomaxprocs">1. 合理设置 GOMAXPROCS</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> optimizeGOMAXPROCS</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // 获取 CPU 核心数</span></span>
<span class="line"><span style="color:#E1E4E8">    cpuNum </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> runtime.</span><span style="color:#B392F0">NumCPU</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;CPU 核心数: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, cpuNum)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 设置使用所有核心</span></span>
<span class="line"><span style="color:#E1E4E8">    runtime.</span><span style="color:#B392F0">GOMAXPROCS</span><span style="color:#E1E4E8">(cpuNum)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 或者根据负载设置</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> cpuNum </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> 4</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        runtime.</span><span style="color:#B392F0">GOMAXPROCS</span><span style="color:#E1E4E8">(cpuNum </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// 留一个核心给系统</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>输出结果：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>CPU 核心数: 8</span></span></code></pre>
<h3 id="2-避免-goroutine-泄漏">2. 避免 goroutine 泄漏</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> avoidLeak</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // 使用 context 控制 goroutine 生命周期</span></span>
<span class="line"><span style="color:#E1E4E8">    ctx, cancel </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> context.</span><span style="color:#B392F0">WithCancel</span><span style="color:#E1E4E8">(context.</span><span style="color:#B392F0">Background</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#B392F0"> cancel</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            select</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            case</span><span style="color:#F97583"> &lt;-</span><span style="color:#E1E4E8">ctx.</span><span style="color:#B392F0">Done</span><span style="color:#E1E4E8">():</span></span>
<span class="line"><span style="color:#E1E4E8">                fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;goroutine 被取消&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">                return</span></span>
<span class="line"><span style="color:#F97583">            default</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#6A737D">                // 执行任务</span></span>
<span class="line"><span style="color:#E1E4E8">                time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">100</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> time.Millisecond)</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 5 秒后取消</span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> time.Second)</span></span>
<span class="line"><span style="color:#B392F0">    cancel</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>输出结果：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>goroutine 被取消</span></span></code></pre>
<h3 id="3-监控-goroutine-数量">3. 监控 goroutine 数量</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> monitorGoroutines</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    ticker </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> time.</span><span style="color:#B392F0">NewTicker</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> ticker.</span><span style="color:#B392F0">Stop</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> ticker.C {</span></span>
<span class="line"><span style="color:#E1E4E8">        count </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> runtime.</span><span style="color:#B392F0">NumGoroutine</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;当前 goroutine 数: </span><span style="color:#79B8FF">%d\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, count)</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> count </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> 1000</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;警告：goroutine 数量过多&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>输出结果：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>当前 goroutine 数: 1</span></span>
<span class="line"><span>当前 goroutine 数: 1</span></span>
<span class="line"><span>当前 goroutine 数: 1</span></span></code></pre>
<h2 id="实际应用场景">实际应用场景</h2>
<h3 id="1-web-服务器并发处理">1. Web 服务器并发处理</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> webServerExample</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // 模拟处理 HTTP 请求</span></span>
<span class="line"><span style="color:#E1E4E8">    requests </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 启动多个 worker 处理请求</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">workerID</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">            for</span><span style="color:#E1E4E8"> req </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> requests {</span></span>
<span class="line"><span style="color:#E1E4E8">                fmt.</span><span style="color:#B392F0">Printf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Worker </span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF"> 处理请求: </span><span style="color:#79B8FF">%s\n</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, workerID, req)</span></span>
<span class="line"><span style="color:#E1E4E8">                time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">100</span><span style="color:#F97583"> *</span><span style="color:#E1E4E8"> time.Millisecond) </span><span style="color:#6A737D">// 模拟处理时间</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }(i)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 发送请求</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        requests </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> fmt.</span><span style="color:#B392F0">Sprintf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;请求-</span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, i)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#B392F0">    close</span><span style="color:#E1E4E8">(requests)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.Second)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>输出结果：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>Worker 0 处理请求: 请求-0</span></span>
<span class="line"><span>Worker 1 处理请求: 请求-1</span></span>
<span class="line"><span>Worker 2 处理请求: 请求-2</span></span>
<span class="line"><span>Worker 0 处理请求: 请求-3</span></span>
<span class="line"><span>Worker 1 处理请求: 请求-4</span></span>
<span class="line"><span>Worker 2 处理请求: 请求-5</span></span>
<span class="line"><span>Worker 0 处理请求: 请求-6</span></span>
<span class="line"><span>Worker 1 处理请求: 请求-7</span></span>
<span class="line"><span>Worker 2 处理请求: 请求-8</span></span>
<span class="line"><span>Worker 0 处理请求: 请求-9</span></span></code></pre>
<h3 id="2-并发文件处理">2. 并发文件处理</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> concurrentFileProcessing</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    files </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">{</span><span style="color:#9ECBFF">&quot;file1.txt&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&quot;file2.txt&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&quot;file3.txt&quot;</span><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#E1E4E8">    results </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">chan</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">len</span><span style="color:#E1E4E8">(files))</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 并发处理文件</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> _, file </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> files {</span></span>
<span class="line"><span style="color:#F97583">        go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">filename</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">            // 模拟文件处理</span></span>
<span class="line"><span style="color:#E1E4E8">            time.</span><span style="color:#B392F0">Sleep</span><span style="color:#E1E4E8">(time.</span><span style="color:#B392F0">Duration</span><span style="color:#E1E4E8">(rand.</span><span style="color:#B392F0">Intn</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">500</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">*</span><span style="color:#E1E4E8"> time.Millisecond)</span></span>
<span class="line"><span style="color:#E1E4E8">            results </span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8"> fmt.</span><span style="color:#B392F0">Sprintf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;处理完成: </span><span style="color:#79B8FF">%s</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, filename)</span></span>
<span class="line"><span style="color:#E1E4E8">        }(file)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // 收集结果</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&lt;</span><span style="color:#B392F0"> len</span><span style="color:#E1E4E8">(files); i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        fmt.</span><span style="color:#B392F0">Println</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&lt;-</span><span style="color:#E1E4E8">results)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>输出结果：</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>处理完成: file2.txt</span></span>
<span class="line"><span>处理完成: file1.txt</span></span>
<span class="line"><span>处理完成: file3.txt</span></span></code></pre>
<h2 id="总结和思考">总结和思考</h2>
<h3 id="关键要点">关键要点</h3>
<ol>
<li><strong>理解基础概念</strong>：进程、线程、并发、并行的区别</li>
<li><strong>掌握 goroutine</strong>：Go 的轻量级并发单元</li>
<li><strong>合理使用工具</strong>：sync.WaitGroup、channel、mutex</li>
<li><strong>注意性能调优</strong>：避免泄漏，监控资源使用</li>
</ol>
<h3 id="最佳实践">最佳实践</h3>
<ul>
<li><strong>适度并发</strong>：不要创建过多 goroutine</li>
<li><strong>同步机制</strong>：使用适当的同步原语</li>
<li><strong>监控资源</strong>：关注 goroutine 数量和内存使用</li>
<li><strong>性能调优</strong>：根据实际需求设置 GOMAXPROCS</li>
</ul>
<h3 id="进阶方向">进阶方向</h3>
<ul>
<li><strong>Channel 模式</strong>：深入理解 channel 的使用模式</li>
<li><strong>Context 包</strong>：学习上下文管理和取消机制</li>
<li><strong>内存模型</strong>：理解 Go 的内存一致性保证</li>
<li><strong>性能分析</strong>：使用 pprof 分析并发性能</li>
</ul>
<p>并发编程是 Go 语言的核心优势之一，掌握好这些基础概念，就能写出高效、可靠的并发程序。</p>
<blockquote>
<p><strong>小贴士</strong>：并发编程的核心是理解数据流和控制流，而不是简单地创建更多的 goroutine。</p>
</blockquote> </div> </div> <!-- 文章底部导航 --> <div class="mt-8 flex justify-between items-center" data-astro-cid-gjtny2mx> <a href="/my-blog/" class="dark-btn-outline px-6 py-3 rounded-lg text-sm" data-astro-cid-gjtny2mx>
← 返回首页
</a> <div class="flex space-x-4" data-astro-cid-gjtny2mx> <button class="dark-btn px-6 py-3 rounded-lg text-sm" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" data-astro-cid-gjtny2mx>
↑ 回到顶部
</button> </div> </div> </article> <!-- 侧边栏 --> <aside class="lg:col-span-1" data-astro-cid-gjtny2mx> <div class="sticky top-24 space-y-6" data-astro-cid-gjtny2mx> <!-- 文章信息卡片 --> <div class="dark-card p-6 rounded-xl" data-astro-cid-gjtny2mx> <h3 class="font-bold text-white mb-4 neon-text" data-astro-cid-gjtny2mx>文章信息</h3> <div class="space-y-4 text-sm" data-astro-cid-gjtny2mx> <div class="flex justify-between items-center" data-astro-cid-gjtny2mx> <span class="text-gray-400" data-astro-cid-gjtny2mx>发布时间</span> <span class="text-white font-mono" data-astro-cid-gjtny2mx>2024/12/28</span> </div> <div class="flex justify-between items-center" data-astro-cid-gjtny2mx> <span class="text-gray-400" data-astro-cid-gjtny2mx>分类</span> <span class="neon-text font-bold" data-astro-cid-gjtny2mx>后端开发</span> </div> <div data-astro-cid-gjtny2mx> <span class="text-gray-400 block mb-3" data-astro-cid-gjtny2mx>标签</span> <div class="flex flex-wrap gap-2" data-astro-cid-gjtny2mx> <span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> Go </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> Golang </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> 并发编程 </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> 进程 </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> 线程 </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> goroutine </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> 后端开发 </span> </div> </div> </div> </div> <!-- 目录 --> <div class="dark-card p-6 rounded-xl" data-astro-cid-gjtny2mx> <h3 class="font-bold text-white mb-4 neon-text" data-astro-cid-gjtny2mx>目录</h3> <div class="text-sm space-y-3" data-astro-cid-gjtny2mx> <a href="#" class="block text-gray-300 hover:neon-text transition-all duration-300 border-l-2 border-transparent hover:border-neon-green pl-3" data-astro-cid-gjtny2mx>
• 文章开始
</a> <a href="#" class="block text-gray-300 hover:neon-text transition-all duration-300 border-l-2 border-transparent hover:border-neon-green pl-3" data-astro-cid-gjtny2mx>
• 主要内容
</a> <a href="#" class="block text-gray-300 hover:neon-text transition-all duration-300 border-l-2 border-transparent hover:border-neon-green pl-3" data-astro-cid-gjtny2mx>
• 总结
</a> </div> </div> <!-- 相关文章 --> <div class="dark-card p-6 rounded-xl" data-astro-cid-gjtny2mx> <h3 class="font-bold text-white mb-4 neon-text" data-astro-cid-gjtny2mx>相关文章</h3> <div class="space-y-4 text-sm" data-astro-cid-gjtny2mx> <a href="/my-blog/posts/typescript-tips" class="block group border border-gray-700/50 rounded-lg p-3 hover:border-neon-green/40 transition-all duration-300" data-astro-cid-gjtny2mx> <span class="text-gray-300 group-hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>
TypeScript 小技巧
</span> <div class="text-xs text-gray-500 mt-1" data-astro-cid-gjtny2mx>编程语言</div> </a> <a href="/my-blog/posts/hello-astro" class="block group border border-gray-700/50 rounded-lg p-3 hover:border-neon-green/40 transition-all duration-300" data-astro-cid-gjtny2mx> <span class="text-gray-300 group-hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>
Hello Astro
</span> <div class="text-xs text-gray-500 mt-1" data-astro-cid-gjtny2mx>框架</div> </a> </div> </div> </div> </aside> </div>  </main> <footer class="mt-20 border-t border-neon-green/30 bg-black/60 backdrop-blur-sm"> <div class="max-w-6xl mx-auto px-4 py-12"> <!-- 居中的品牌信息 --> <div class="text-center mb-8"> <div class="flex items-center justify-center space-x-4 mb-6"> <div class="w-16 h-16 group"> <!-- 代码风格Logo图标 - 基于第一个设计方案 --><svg viewBox="0 0 48 48" class="w-full h-full" data-astro-cid-hit3dubr> <defs data-astro-cid-hit3dubr> <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%" data-astro-cid-hit3dubr> <stop offset="0%" style="stop-color:#00ff88;stop-opacity:1" data-astro-cid-hit3dubr></stop> <stop offset="100%" style="stop-color:#3742fa;stop-opacity:1" data-astro-cid-hit3dubr></stop> </linearGradient> <filter id="logoGlow" data-astro-cid-hit3dubr> <feGaussianBlur stdDeviation="2" result="coloredBlur" data-astro-cid-hit3dubr></feGaussianBlur> <feMerge data-astro-cid-hit3dubr> <feMergeNode in="coloredBlur" data-astro-cid-hit3dubr></feMergeNode> <feMergeNode in="SourceGraphic" data-astro-cid-hit3dubr></feMergeNode> </feMerge> </filter> </defs> <!-- 外框 --> <rect x="2" y="2" width="44" height="44" fill="none" stroke="url(#logoGrad)" stroke-width="2" rx="8" filter="url(#logoGlow)" class="group-hover:stroke-width-3 transition-all duration-300" data-astro-cid-hit3dubr></rect> <!-- 字母F的代码风格设计 --> <path d="M12 12 L32 12 M12 12 L12 36 M12 24 L28 24" stroke="#00ff88" stroke-width="3" stroke-linecap="round" fill="none" filter="url(#logoGlow)" class="group-hover:stroke-white transition-all duration-300" data-astro-cid-hit3dubr></path> <!-- 装饰点 --> <circle cx="36" cy="16" r="2" fill="#00ff88" class="animate-pulse group-hover:fill-white transition-all duration-300" data-astro-cid-hit3dubr></circle> <circle cx="36" cy="28" r="1.5" fill="#3742fa" class="animate-pulse group-hover:fill-white transition-all duration-300" style="animation-delay: 0.5s" data-astro-cid-hit3dubr></circle> </svg>  </div> <span class="font-black text-3xl neon-text tracking-wider">MR.FENG</span> </div> <p class="description-text text-xl leading-relaxed max-w-2xl mx-auto">
编程不仅是科学，也是艺术<br>
在代码中探索创新，在技术中发现美学
</p> <!-- 装饰性元素 --> <div class="flex justify-center items-center space-x-8 mt-8"> <div class="w-16 h-px bg-gradient-to-r from-transparent to-neon-green"></div> <div class="w-3 h-3 border-2 border-neon-green bg-neon-green/20 rounded-full animate-pulse"></div> <div class="w-16 h-px bg-gradient-to-l from-transparent to-neon-green"></div> </div> </div> <!-- 分割线 --> <div class="h-px bg-gradient-to-r from-transparent via-neon-green/50 to-transparent mb-6"></div> <!-- 底部信息 --> <div class="flex flex-col md:flex-row justify-between items-center text-sm text-gray-400"> <p>
© 2025 Mr. Feng •
<span class="neon-text">Powered by Astro</span> </p> <!-- 状态指示器 --> <div class="flex items-center space-x-2 mt-4 md:mt-0"> <div class="w-3 h-3 bg-neon-green rounded-full animate-pulse"></div> <span class="text-xs text-gray-500">SYSTEM ONLINE</span> </div> </div> </div> <!-- 底部发光效果 --> <div class="h-px bg-gradient-to-r from-transparent via-neon-green to-transparent opacity-60"></div> </footer> <!-- 增强的粒子生成脚本 --> <script type="module">function o(){const e=document.getElementById("particles");if(!e)return;const n=40;for(let a=0;a<n;a++){const t=document.createElement("div");t.className="particle",t.style.left=Math.random()*100+"%",t.style.top=Math.random()*100+"%",t.style.animationDelay=Math.random()*8+"s",t.style.animationDuration=Math.random()*4+6+"s",e.appendChild(t)}}document.addEventListener("DOMContentLoaded",o);</script> </body> </html> 