<!DOCTYPE html><html lang="zh-CN" class="scroll-smooth"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Mr. Feng â€” æš—é»‘ç§‘æŠ€åšå®¢</title><meta name="description" content="ç¼–ç¨‹ä¸ä»…æ˜¯ç§‘å­¦ï¼Œä¹Ÿæ˜¯è‰ºæœ¯ã€‚åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†è¡¨è¾¾è‡ªæˆ‘å’Œè§£å†³é—®é¢˜çš„æ–°é€”å¾„ã€‚"><link rel="stylesheet" href="/my-blog/_astro/about.BfSHQvgF.css">
<style>.prose[data-astro-cid-gjtny2mx]{color:#fff}.prose[data-astro-cid-gjtny2mx] h1[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h2[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h3[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h4[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h5[data-astro-cid-gjtny2mx],.prose[data-astro-cid-gjtny2mx] h6[data-astro-cid-gjtny2mx]{color:#fff;font-weight:700}.prose[data-astro-cid-gjtny2mx] h2[data-astro-cid-gjtny2mx]{border-bottom:2px solid rgba(0,255,136,.3);padding-bottom:.75rem;margin-top:2.5rem;margin-bottom:1.5rem;color:#0f8;text-shadow:0 0 10px rgba(0,255,136,.3)}.prose[data-astro-cid-gjtny2mx] h3[data-astro-cid-gjtny2mx]{color:#0f8;margin-top:2rem;margin-bottom:1rem}.prose[data-astro-cid-gjtny2mx] a[data-astro-cid-gjtny2mx]{color:#0f8;text-decoration:none;text-shadow:0 0 5px rgba(0,255,136,.3)}.prose[data-astro-cid-gjtny2mx] a[data-astro-cid-gjtny2mx]:hover{color:#fff;text-shadow:0 0 10px #00ff88;text-decoration:underline}.prose[data-astro-cid-gjtny2mx] code[data-astro-cid-gjtny2mx]{background:#00ff8826;border:1px solid rgba(0,255,136,.3);border-radius:.375rem;padding:.25rem .5rem;color:#0f8;font-size:.9em;font-weight:600}.prose[data-astro-cid-gjtny2mx] pre[data-astro-cid-gjtny2mx]{background:#0a0a0a;border:1px solid rgba(0,255,136,.3);border-radius:.75rem;padding:1.5rem;overflow-x:auto;box-shadow:0 0 20px #00ff881a}.prose[data-astro-cid-gjtny2mx] pre[data-astro-cid-gjtny2mx] code[data-astro-cid-gjtny2mx]{background:transparent;border:none;padding:0;color:#fff;text-shadow:none;font-weight:400}.prose[data-astro-cid-gjtny2mx] blockquote[data-astro-cid-gjtny2mx]{border-left:4px solid #00ff88;background:#00ff880d;margin:1.5rem 0;padding:1rem 1.5rem;font-style:italic;border-radius:0 .5rem .5rem 0}.prose[data-astro-cid-gjtny2mx] ul[data-astro-cid-gjtny2mx] li[data-astro-cid-gjtny2mx]::marker,.prose[data-astro-cid-gjtny2mx] ol[data-astro-cid-gjtny2mx] li[data-astro-cid-gjtny2mx]::marker{color:#0f8}.prose[data-astro-cid-gjtny2mx] strong[data-astro-cid-gjtny2mx]{color:#fff;font-weight:700}.prose[data-astro-cid-gjtny2mx] p[data-astro-cid-gjtny2mx]{line-height:1.8;margin-bottom:1.25rem}
</style>
<link rel="stylesheet" href="/my-blog/_astro/fingerprinthub_classify_blog.CxlJjaYK.css"></head> <body class="dark-bg grid-bg min-h-screen text-white font-sans relative overflow-x-hidden"> <!-- å¢å¼ºçš„ç²’å­èƒŒæ™¯ --> <div class="particles" id="particles"></div> <header class="bg-black/80 backdrop-blur-md border-b border-neon-green/30 sticky top-0 z-50"> <div class="max-w-6xl mx-auto px-4 flex items-center justify-between h-16"> <!-- Logo --> <a href="/my-blog/" class="flex items-center space-x-3 group"> <div class="w-12 h-12"> <!-- ä»£ç é£æ ¼Logoå›¾æ ‡ - åŸºäºç¬¬ä¸€ä¸ªè®¾è®¡æ–¹æ¡ˆ --><svg viewBox="0 0 48 48" class="w-full h-full" data-astro-cid-hit3dubr> <defs data-astro-cid-hit3dubr> <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%" data-astro-cid-hit3dubr> <stop offset="0%" style="stop-color:#00ff88;stop-opacity:1" data-astro-cid-hit3dubr></stop> <stop offset="100%" style="stop-color:#3742fa;stop-opacity:1" data-astro-cid-hit3dubr></stop> </linearGradient> <filter id="logoGlow" data-astro-cid-hit3dubr> <feGaussianBlur stdDeviation="2" result="coloredBlur" data-astro-cid-hit3dubr></feGaussianBlur> <feMerge data-astro-cid-hit3dubr> <feMergeNode in="coloredBlur" data-astro-cid-hit3dubr></feMergeNode> <feMergeNode in="SourceGraphic" data-astro-cid-hit3dubr></feMergeNode> </feMerge> </filter> </defs> <!-- å¤–æ¡† --> <rect x="2" y="2" width="44" height="44" fill="none" stroke="url(#logoGrad)" stroke-width="2" rx="8" filter="url(#logoGlow)" class="group-hover:stroke-width-3 transition-all duration-300" data-astro-cid-hit3dubr></rect> <!-- å­—æ¯Fçš„ä»£ç é£æ ¼è®¾è®¡ --> <path d="M12 12 L32 12 M12 12 L12 36 M12 24 L28 24" stroke="#00ff88" stroke-width="3" stroke-linecap="round" fill="none" filter="url(#logoGlow)" class="group-hover:stroke-white transition-all duration-300" data-astro-cid-hit3dubr></path> <!-- è£…é¥°ç‚¹ --> <circle cx="36" cy="16" r="2" fill="#00ff88" class="animate-pulse group-hover:fill-white transition-all duration-300" data-astro-cid-hit3dubr></circle> <circle cx="36" cy="28" r="1.5" fill="#3742fa" class="animate-pulse group-hover:fill-white transition-all duration-300" style="animation-delay: 0.5s" data-astro-cid-hit3dubr></circle> </svg>  </div> <span class="font-bold text-2xl neon-logo group-hover:neon-logo transition-all duration-300">
MR.FENG
</span> </a> <!-- å¯¼èˆªèœå• --> <nav class="hidden md:flex items-center space-x-8"> <a href="/my-blog/" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
é¦–é¡µ
</a> <a href="/my-blog/categories" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
åˆ†ç±»
</a> <a href="/my-blog/tags" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
æ ‡ç­¾
</a> <a href="/my-blog/about" class="text-white hover:neon-text transition-all duration-300 font-semibold uppercase tracking-wider text-sm">
å…³äº
</a> </nav> <!-- å³ä¾§å·¥å…·æ  --> <div class="flex items-center space-x-4"> <div class="relative"> <input id="search-input" type="search" placeholder="æœç´¢æ–‡ç« â€¦" class="dark-input w-full sm:w-64 px-4 py-2 text-sm placeholder-gray-400"> <ul id="search-results" class="absolute top-full mt-2 w-full sm:w-96 bg-black/90 backdrop-blur-md border border-neon-green/30 rounded-lg shadow-2xl max-h-60 overflow-y-auto hidden z-50"></ul> </div> <script type="module">
  import Fuse from 'https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.esm.min.js';

  const input = document.getElementById('search-input');
  const resultsEl = document.getElementById('search-results');
  let fuse;

  async function initSearch() {
    const res = await fetch('/my-blog/search.json');
    const data = await res.json();
    fuse = new Fuse(data, {
      keys: ['title', 'content', 'category', 'tags'],
      threshold: 0.3,
      ignoreLocation: true,
    });
  }

  function render(results) {
    if (!results.length) {
      resultsEl.innerHTML = '<li class="p-4 text-center text-gray-400">æ— åŒ¹é…ç»“æœ</li>';
      return;
    }
    resultsEl.innerHTML = results
      .slice(0, 8)
      .map(r => `
        <li>
          <a href="${r.item.url}" class="block px-4 py-3 text-white hover:bg-neon-green/10 hover:border-l-2 hover:border-neon-green transition-all duration-300 border-l-2 border-transparent">
            <div class="font-medium">${r.item.title}</div>
            <div class="text-xs text-gray-400 mt-1">${r.item.category || 'æœªåˆ†ç±»'}</div>
          </a>
        </li>
      `) 
      .join('');
  }

  input.addEventListener('focus', () => {
    resultsEl.classList.remove('hidden');
    if (!fuse) initSearch();
  });

  document.addEventListener('click', (e) => {
    if (!input.contains(e.target) && !resultsEl.contains(e.target)) {
      resultsEl.classList.add('hidden');
    }
  });

  input.addEventListener('input', () => {
    if (!fuse) return;
    const q = input.value.trim();
    if (!q) {
      resultsEl.innerHTML = '';
      return;
    }
    const results = fuse.search(q);
    render(results);
  });
</script> <button id="theme-toggle" aria-label="åˆ‡æ¢æš—è‰²æ¨¡å¼" class="w-9 h-9 rounded-full flex items-center justify-center hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"> <svg id="icon-sun" class="w-5 h-5 hidden" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"> <path d="M12 4.5V2m0 20v-2.5m7.778-12.728l1.768-1.768M2.454 21.546l1.768-1.768m0-14.556L2.454 4.454m18.092 16.092l-1.768-1.768M4.5 12H2m20 0h-2.5M6.222 17.778l-1.768 1.768m16.092-18.092l-1.768 1.768" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg id="icon-moon" class="w-5 h-5 hidden" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"> <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z"></path> </svg> </button> <script type="module">const l=document.getElementById("theme-toggle"),t=document.getElementById("icon-sun"),o=document.getElementById("icon-moon");if(l&&t&&o){const n=d=>{d?(o.style.display="none",t.style.display="block"):(t.style.display="none",o.style.display="block")},c=window.matchMedia("(prefers-color-scheme: dark)").matches,s=localStorage.getItem("theme");let e=s?s==="dark":c;document.documentElement.classList.toggle("dark",e),n(e),l.addEventListener("click",()=>{e=!e,document.documentElement.classList.toggle("dark",e),localStorage.setItem("theme",e?"dark":"light"),n(e)})}</script> <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® --> <button class="md:hidden p-2 text-white hover:neon-text transition-all duration-300" id="mobile-menu-btn"> <div class="w-6 h-0.5 bg-current mb-1 transition-all duration-300"></div> <div class="w-6 h-0.5 bg-current mb-1 transition-all duration-300"></div> <div class="w-6 h-0.5 bg-current transition-all duration-300"></div> </button> </div> </div> <!-- ç§»åŠ¨ç«¯èœå• --> <div class="md:hidden bg-black/90 backdrop-blur-md border-t border-neon-green/30 hidden" id="mobile-menu"> <div class="px-4 py-6 space-y-4"> <a href="/my-blog/" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">é¦–é¡µ</a> <a href="/my-blog/categories" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">åˆ†ç±»</a> <a href="/my-blog/tags" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">æ ‡ç­¾</a> <a href="/my-blog/about" class="block text-white hover:neon-text transition-all duration-300 py-3 font-semibold uppercase tracking-wider">å…³äº</a> </div> </div> </header> <script type="module">document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("mobile-menu-btn"),n=document.getElementById("mobile-menu");t?.addEventListener("click",()=>{n?.classList.toggle("hidden");const e=t.querySelectorAll("div");n?.classList.contains("hidden")?(e[0].style.transform="rotate(0deg)",e[1].style.opacity="1",e[2].style.transform="rotate(0deg)"):(e[0].style.transform="rotate(45deg) translate(5px, 5px)",e[1].style.opacity="0",e[2].style.transform="rotate(-45deg) translate(7px, -6px)")})});</script> <main class="max-w-6xl mx-auto px-4 py-8 relative z-10">   <nav class="mb-8 text-sm" data-astro-cid-gjtny2mx> <div class="flex items-center space-x-3 text-gray-400" data-astro-cid-gjtny2mx> <a href="/my-blog/" class="hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>é¦–é¡µ</a> <span class="neon-text" data-astro-cid-gjtny2mx>â€¢</span> <a href="/my-blog/categories" class="hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>åˆ†ç±»</a> <span class="neon-text" data-astro-cid-gjtny2mx>â€¢</span> <span class="neon-text font-bold" data-astro-cid-gjtny2mx>åç«¯å¼€å‘</span> </div> </nav>  <header class="mb-12" data-astro-cid-gjtny2mx> <div class="dark-card p-10 rounded-xl" data-astro-cid-gjtny2mx> <!-- åˆ†ç±»æ ‡ç­¾ --> <div class="mb-6" data-astro-cid-gjtny2mx> <span class="px-4 py-2 text-sm font-bold bg-neon-green/20 text-neon-green rounded-full border border-neon-green/40 uppercase tracking-wider" data-astro-cid-gjtny2mx> åç«¯å¼€å‘ </span> </div> <!-- æ–‡ç« æ ‡é¢˜ --> <h1 class="text-4xl md:text-5xl font-black text-white mb-6 leading-tight" data-astro-cid-gjtny2mx> go-zero æ¡†æ¶å…¥é—¨æŒ‡å— â€”â€” è®©å¾®æœåŠ¡å¼€å‘å˜å¾—ç®€å• </h1> <!-- æ–‡ç« æè¿° --> <p class="text-xl text-gray-300 mb-8 leading-relaxed" data-astro-cid-gjtny2mx> æ·±å…¥æµ…å‡ºåœ°ä»‹ç» go-zero æ¡†æ¶ï¼Œä»åŸºç¡€æ¦‚å¿µåˆ°å®æˆ˜åº”ç”¨ï¼Œå­¦ä¼šç”¨ go-zero å¿«é€Ÿæ­å»ºå¾®æœåŠ¡ç³»ç»Ÿ </p> <!-- æ–‡ç« å…ƒä¿¡æ¯ --> <div class="flex flex-wrap items-center gap-6 text-sm" data-astro-cid-gjtny2mx> <div class="flex items-center space-x-3" data-astro-cid-gjtny2mx> <div class="w-3 h-3 bg-neon-green rounded-full animate-pulse" data-astro-cid-gjtny2mx></div> <time class="font-mono text-gray-300 bg-dark-600/50 px-3 py-1 rounded" data-astro-cid-gjtny2mx> 2024å¹´12æœˆ28æ—¥ </time> </div> <div class="flex items-center space-x-3" data-astro-cid-gjtny2mx> <div class="w-3 h-3 bg-neon-blue rounded-full animate-pulse" data-astro-cid-gjtny2mx></div> <div class="flex gap-2 flex-wrap" data-astro-cid-gjtny2mx> <span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#Go </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#Golang </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#go-zero </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#å¾®æœåŠ¡ </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#åç«¯æ¡†æ¶ </span><span class="px-3 py-1 bg-dark-600/70 border border-gray-600/50 text-gray-300 rounded-full text-xs font-medium" data-astro-cid-gjtny2mx>
#åç«¯å¼€å‘ </span> </div> </div> </div> </div> </header>  <div class="grid lg:grid-cols-4 gap-8" data-astro-cid-gjtny2mx> <!-- ä¸»è¦å†…å®¹ --> <article class="lg:col-span-3" data-astro-cid-gjtny2mx> <div class="dark-card p-10 rounded-xl" data-astro-cid-gjtny2mx> <div class="prose prose-invert prose-lg max-w-none" data-astro-cid-gjtny2mx> <h1 id="go-zero-æ¡†æ¶å…¥é—¨æŒ‡å—--è®©å¾®æœåŠ¡å¼€å‘å˜å¾—ç®€å•">go-zero æ¡†æ¶å…¥é—¨æŒ‡å— â€”â€” è®©å¾®æœåŠ¡å¼€å‘å˜å¾—ç®€å•</h1>
<blockquote>
<p>go-zero æ˜¯å­—èŠ‚è·³åŠ¨å¼€æºçš„ä¸€ä¸ª Go å¾®æœåŠ¡æ¡†æ¶ï¼Œå·ç§°â€è®©å¾®æœåŠ¡å¼€å‘å˜å¾—ç®€å•â€ã€‚æœ€è¿‘è¯•äº†è¯•ï¼Œç¡®å®æŒºé¦™çš„ï¼Œæƒ³ç€æŠŠä½¿ç”¨å¿ƒå¾—è®°å½•ä¸‹æ¥ã€‚</p>
</blockquote>
<h2 id="-ä»€ä¹ˆæ˜¯-go-zeroä¸ºä»€ä¹ˆé€‰å®ƒ">ğŸ¤” ä»€ä¹ˆæ˜¯ go-zeroï¼Ÿä¸ºä»€ä¹ˆé€‰å®ƒï¼Ÿ</h2>
<h3 id="ç®€å•ç†è§£-go-zero">ç®€å•ç†è§£ go-zero</h3>
<p>go-zero å°±åƒæ˜¯ä¸€ä¸ªâ€å¾®æœåŠ¡å¼€å‘å·¥å…·ç®±â€ï¼Œå®ƒå¸®ä½ æŠŠæ­å»ºå¾®æœåŠ¡æ—¶é‚£äº›é‡å¤çš„ã€éº»çƒ¦çš„äº‹æƒ…éƒ½æå®šäº†ï¼š</p>









































<table><thead><tr><th>åŠŸèƒ½</th><th>ä¼ ç»Ÿæ–¹å¼</th><th>go-zero æ–¹å¼</th><th>æ„Ÿå—</th></tr></thead><tbody><tr><td><strong>API æœåŠ¡</strong></td><td>æ‰‹å†™è·¯ç”±ã€ä¸­é—´ä»¶ã€é”™è¯¯å¤„ç†</td><td>ä¸€è¡Œå‘½ä»¤ç”Ÿæˆå®Œæ•´é¡¹ç›®</td><td>çœŸçš„çœå¿ƒ</td></tr><tr><td><strong>æ•°æ®åº“æ“ä½œ</strong></td><td>æ‰‹å†™ SQLã€è¿æ¥æ± ã€äº‹åŠ¡</td><td>è‡ªåŠ¨ç”Ÿæˆ CRUD ä»£ç </td><td>ä¸ç”¨å†™é‡å¤ä»£ç </td></tr><tr><td><strong>æœåŠ¡å‘ç°</strong></td><td>è‡ªå·±å®ç°æ³¨å†Œã€å‘ç°é€»è¾‘</td><td>å†…ç½® etcd æ”¯æŒ</td><td>å¼€ç®±å³ç”¨</td></tr><tr><td><strong>é…ç½®ç®¡ç†</strong></td><td>æ‰‹å†™é…ç½®è§£æã€çƒ­æ›´æ–°</td><td>ç»Ÿä¸€çš„é…ç½®ä¸­å¿ƒ</td><td>ç®¡ç†èµ·æ¥æ–¹ä¾¿</td></tr><tr><td><strong>é“¾è·¯è¿½è¸ª</strong></td><td>é›†æˆ Jaegerã€Zipkin</td><td>å†…ç½® trace æ”¯æŒ</td><td>è°ƒè¯•é—®é¢˜å®¹æ˜“</td></tr></tbody></table>
<h3 id="ä¸ºä»€ä¹ˆé€‰-go-zero">ä¸ºä»€ä¹ˆé€‰ go-zeroï¼Ÿ</h3>
<p><strong>ğŸš€ å¼€å‘æ•ˆç‡é«˜</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># ä¸€è¡Œå‘½ä»¤ç”Ÿæˆå®Œæ•´çš„ API æœåŠ¡</span></span>
<span class="line"><span style="color:#B392F0">goctl</span><span style="color:#9ECBFF"> api</span><span style="color:#9ECBFF"> new</span><span style="color:#9ECBFF"> user-api</span></span></code></pre>
<p><strong>ğŸ”§ å·¥å…·é“¾å®Œæ•´</strong></p>
<ul>
<li><code>goctl</code>ï¼šä»£ç ç”Ÿæˆå·¥å…·</li>
<li><code>zrpc</code>ï¼šRPC æœåŠ¡æ¡†æ¶</li>
<li><code>zapi</code>ï¼šAPI ç½‘å…³</li>
<li><code>zmon</code>ï¼šç›‘æ§ç³»ç»Ÿ</li>
</ul>
<p><strong>ğŸ“¦ ç”Ÿæ€ä¸°å¯Œ</strong></p>
<ul>
<li>å†…ç½®ç¼“å­˜ã€é™æµã€ç†”æ–­</li>
<li>æ”¯æŒå¤šç§æ•°æ®åº“</li>
<li>é›†æˆé“¾è·¯è¿½è¸ª</li>
<li>å†…ç½®ç›‘æ§æŒ‡æ ‡</li>
</ul>
<h2 id="-go-zero-çš„æ ¸å¿ƒç»„ä»¶">ğŸ¯ go-zero çš„æ ¸å¿ƒç»„ä»¶</h2>
<h3 id="1-api-æœåŠ¡http-æœåŠ¡">1. API æœåŠ¡ï¼ˆHTTP æœåŠ¡ï¼‰</h3>
<p><strong>ä¼ ç»Ÿæ–¹å¼å†™ API</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// ä¼ ç»Ÿæ–¹å¼ - è¦å†™å¾ˆå¤šæ ·æ¿ä»£ç </span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    r </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> gin.</span><span style="color:#B392F0">Default</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // ä¸­é—´ä»¶</span></span>
<span class="line"><span style="color:#E1E4E8">    r.</span><span style="color:#B392F0">Use</span><span style="color:#E1E4E8">(cors.</span><span style="color:#B392F0">Default</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">    r.</span><span style="color:#B392F0">Use</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">logger</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">    r.</span><span style="color:#B392F0">Use</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">recovery</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // è·¯ç”±</span></span>
<span class="line"><span style="color:#E1E4E8">    r.</span><span style="color:#B392F0">GET</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;/api/users/:id&quot;</span><span style="color:#E1E4E8">, getUserHandler)</span></span>
<span class="line"><span style="color:#E1E4E8">    r.</span><span style="color:#B392F0">POST</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;/api/users&quot;</span><span style="color:#E1E4E8">, createUserHandler)</span></span>
<span class="line"><span style="color:#E1E4E8">    r.</span><span style="color:#B392F0">PUT</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;/api/users/:id&quot;</span><span style="color:#E1E4E8">, updateUserHandler)</span></span>
<span class="line"><span style="color:#E1E4E8">    r.</span><span style="color:#B392F0">DELETE</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;/api/users/:id&quot;</span><span style="color:#E1E4E8">, deleteUserHandler)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // é”™è¯¯å¤„ç†</span></span>
<span class="line"><span style="color:#E1E4E8">    r.</span><span style="color:#B392F0">NoRoute</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">func</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">c</span><span style="color:#F97583"> *</span><span style="color:#B392F0">gin</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Context</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        c.</span><span style="color:#B392F0">JSON</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">404</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">gin</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">H</span><span style="color:#E1E4E8">{</span><span style="color:#9ECBFF">&quot;error&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;not found&quot;</span><span style="color:#E1E4E8">})</span></span>
<span class="line"><span style="color:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    r.</span><span style="color:#B392F0">Run</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;:8080&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>go-zero æ–¹å¼</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// go-zero æ–¹å¼ - é…ç½®é©±åŠ¨</span></span>
<span class="line"><span style="color:#6A737D">// api/user.api</span></span>
<span class="line"><span style="color:#F97583">type</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#B392F0">    GetUserReq</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        Id</span><span style="color:#F97583"> int64</span><span style="color:#9ECBFF"> `path:&quot;id&quot;`</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#B392F0">    GetUserResp</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        Id</span><span style="color:#F97583">   int64</span><span style="color:#9ECBFF">  `json:&quot;id&quot;`</span></span>
<span class="line"><span style="color:#B392F0">        Name</span><span style="color:#F97583"> string</span><span style="color:#9ECBFF"> `json:&quot;name&quot;`</span></span>
<span class="line"><span style="color:#B392F0">        Age</span><span style="color:#F97583">  int</span><span style="color:#9ECBFF">    `json:&quot;age&quot;`</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">service user</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">api {</span></span>
<span class="line"><span style="color:#E1E4E8">    @handler GetUser</span></span>
<span class="line"><span style="color:#E1E4E8">    get </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">api</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">users</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">:id (GetUserReq) returns (GetUserResp)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># ç”Ÿæˆä»£ç </span></span>
<span class="line"><span style="color:#B392F0">goctl</span><span style="color:#9ECBFF"> api</span><span style="color:#9ECBFF"> go</span><span style="color:#79B8FF"> -api</span><span style="color:#9ECBFF"> api/user.api</span><span style="color:#79B8FF"> -dir</span><span style="color:#9ECBFF"> .</span></span></code></pre>
<h3 id="2-rpc-æœåŠ¡å†…éƒ¨æœåŠ¡é€šä¿¡">2. RPC æœåŠ¡ï¼ˆå†…éƒ¨æœåŠ¡é€šä¿¡ï¼‰</h3>
<p><strong>ä¼ ç»Ÿ gRPC æ–¹å¼</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="protobuf"><code><span class="line"><span style="color:#6A737D">// è¦å†™ protobuf æ–‡ä»¶</span></span>
<span class="line"><span style="color:#F97583">syntax</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> &quot;proto3&quot;</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">service</span><span style="color:#B392F0"> UserService</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    rpc</span><span style="color:#B392F0"> GetUser</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">GetUserRequest</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">returns</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">GetUserResponse</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">message</span><span style="color:#B392F0"> GetUserRequest</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    int64</span><span style="color:#E1E4E8"> id </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">message</span><span style="color:#B392F0"> GetUserResponse</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    int64</span><span style="color:#E1E4E8"> id </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    string</span><span style="color:#E1E4E8"> name </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    int32</span><span style="color:#E1E4E8"> age </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>go-zero æ–¹å¼</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// ç›´æ¥ç”¨ Go è¯­æ³•å®šä¹‰</span></span>
<span class="line"><span style="color:#F97583">type</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#B392F0">    GetUserReq</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        Id</span><span style="color:#F97583"> int64</span><span style="color:#9ECBFF"> `json:&quot;id&quot;`</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#B392F0">    GetUserResp</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        Id</span><span style="color:#F97583">   int64</span><span style="color:#9ECBFF">  `json:&quot;id&quot;`</span></span>
<span class="line"><span style="color:#B392F0">        Name</span><span style="color:#F97583"> string</span><span style="color:#9ECBFF"> `json:&quot;name&quot;`</span></span>
<span class="line"><span style="color:#B392F0">        Age</span><span style="color:#F97583">  int</span><span style="color:#9ECBFF">    `json:&quot;age&quot;`</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">service user</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">rpc {</span></span>
<span class="line"><span style="color:#E1E4E8">    @handler GetUser</span></span>
<span class="line"><span style="color:#E1E4E8">    rpc </span><span style="color:#B392F0">GetUser</span><span style="color:#E1E4E8">(GetUserReq) returns (GetUserResp)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="-å¿«é€Ÿå¼€å§‹æ­å»ºä¸€ä¸ªç”¨æˆ·æœåŠ¡">ğŸš€ å¿«é€Ÿå¼€å§‹ï¼šæ­å»ºä¸€ä¸ªç”¨æˆ·æœåŠ¡</h2>
<h3 id="1-å®‰è£…-go-zero">1. å®‰è£… go-zero</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># å®‰è£… goctl å·¥å…·</span></span>
<span class="line"><span style="color:#B392F0">go</span><span style="color:#9ECBFF"> install</span><span style="color:#9ECBFF"> github.com/zeromicro/go-zero/tools/goctl@latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># éªŒè¯å®‰è£…</span></span>
<span class="line"><span style="color:#B392F0">goctl</span><span style="color:#79B8FF"> --version</span></span></code></pre>
<h3 id="2-åˆ›å»º-api-æœåŠ¡">2. åˆ›å»º API æœåŠ¡</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># åˆ›å»ºé¡¹ç›®</span></span>
<span class="line"><span style="color:#B392F0">mkdir</span><span style="color:#9ECBFF"> user-service</span><span style="color:#E1E4E8"> &amp;&amp; </span><span style="color:#79B8FF">cd</span><span style="color:#9ECBFF"> user-service</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># ç”Ÿæˆ API æœåŠ¡</span></span>
<span class="line"><span style="color:#B392F0">goctl</span><span style="color:#9ECBFF"> api</span><span style="color:#9ECBFF"> new</span><span style="color:#9ECBFF"> user-api</span></span></code></pre>
<p><strong>ç”Ÿæˆçš„ç›®å½•ç»“æ„</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>user-api/</span></span>
<span class="line"><span>â”œâ”€â”€ api/</span></span>
<span class="line"><span>â”‚   â””â”€â”€ user.api          # API å®šä¹‰æ–‡ä»¶</span></span>
<span class="line"><span>â”œâ”€â”€ etc/</span></span>
<span class="line"><span>â”‚   â””â”€â”€ user-api.yaml     # é…ç½®æ–‡ä»¶</span></span>
<span class="line"><span>â”œâ”€â”€ internal/</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ handler/          # å¤„ç†å™¨</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ logic/           # ä¸šåŠ¡é€»è¾‘</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ svc/             # æœåŠ¡ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span>â”‚   â””â”€â”€ types/           # ç±»å‹å®šä¹‰</span></span>
<span class="line"><span>â”œâ”€â”€ user-api.go          # ä¸»ç¨‹åº</span></span>
<span class="line"><span>â””â”€â”€ go.mod</span></span></code></pre>
<h3 id="3-å®šä¹‰-api-æ¥å£">3. å®šä¹‰ API æ¥å£</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// api/user.api</span></span>
<span class="line"><span style="color:#F97583">type</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#B392F0">    CreateUserReq</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        Name</span><span style="color:#F97583"> string</span><span style="color:#9ECBFF"> `json:&quot;name&quot;`</span></span>
<span class="line"><span style="color:#B392F0">        Age</span><span style="color:#F97583">  int</span><span style="color:#9ECBFF">    `json:&quot;age&quot;`</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#B392F0">    CreateUserResp</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        Id</span><span style="color:#F97583"> int64</span><span style="color:#9ECBFF"> `json:&quot;id&quot;`</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#B392F0">    GetUserReq</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        Id</span><span style="color:#F97583"> int64</span><span style="color:#9ECBFF"> `path:&quot;id&quot;`</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#B392F0">    GetUserResp</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        Id</span><span style="color:#F97583">   int64</span><span style="color:#9ECBFF">  `json:&quot;id&quot;`</span></span>
<span class="line"><span style="color:#B392F0">        Name</span><span style="color:#F97583"> string</span><span style="color:#9ECBFF"> `json:&quot;name&quot;`</span></span>
<span class="line"><span style="color:#B392F0">        Age</span><span style="color:#F97583">  int</span><span style="color:#9ECBFF">    `json:&quot;age&quot;`</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">service user</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">api {</span></span>
<span class="line"><span style="color:#E1E4E8">    @handler CreateUser</span></span>
<span class="line"><span style="color:#E1E4E8">    post </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">api</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">users (CreateUserReq) returns (CreateUserResp)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @handler GetUser</span></span>
<span class="line"><span style="color:#E1E4E8">    get </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">api</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">users</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">:id (GetUserReq) returns (GetUserResp)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="4-ç”Ÿæˆä»£ç ">4. ç”Ÿæˆä»£ç </h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># ç”Ÿæˆ Go ä»£ç </span></span>
<span class="line"><span style="color:#B392F0">goctl</span><span style="color:#9ECBFF"> api</span><span style="color:#9ECBFF"> go</span><span style="color:#79B8FF"> -api</span><span style="color:#9ECBFF"> api/user.api</span><span style="color:#79B8FF"> -dir</span><span style="color:#9ECBFF"> .</span></span></code></pre>
<h3 id="5-å®ç°ä¸šåŠ¡é€»è¾‘">5. å®ç°ä¸šåŠ¡é€»è¾‘</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// internal/logic/createuserlogic.go</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">l </span><span style="color:#F97583">*</span><span style="color:#B392F0">CreateUserLogic</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">CreateUser</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">req</span><span style="color:#F97583"> *</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">CreateUserReq</span><span style="color:#E1E4E8">) (</span><span style="color:#FFAB70">resp</span><span style="color:#F97583"> *</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">CreateUserResp</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">err</span><span style="color:#F97583"> error</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // è¿™é‡Œå†™ä½ çš„ä¸šåŠ¡é€»è¾‘</span></span>
<span class="line"><span style="color:#E1E4E8">    user </span><span style="color:#F97583">:=</span><span style="color:#F97583"> &amp;</span><span style="color:#B392F0">model</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">User</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">        Name: req.Name,</span></span>
<span class="line"><span style="color:#E1E4E8">        Age:  req.Age,</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // ä¿å­˜åˆ°æ•°æ®åº“</span></span>
<span class="line"><span style="color:#E1E4E8">    id, err </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> l.svcCtx.UserModel.</span><span style="color:#B392F0">Insert</span><span style="color:#E1E4E8">(l.ctx, user)</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> err </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8">, err</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> &amp;</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">CreateUserResp</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">        Id: id,</span></span>
<span class="line"><span style="color:#E1E4E8">    }, </span><span style="color:#79B8FF">nil</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="6-é…ç½®æ•°æ®åº“">6. é…ç½®æ•°æ®åº“</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#6A737D"># etc/user-api.yaml</span></span>
<span class="line"><span style="color:#85E89D">Name</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">user-api</span></span>
<span class="line"><span style="color:#85E89D">Host</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">0.0.0.0</span></span>
<span class="line"><span style="color:#85E89D">Port</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">8888</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">MySQL</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  DataSource</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">root:password@tcp(localhost:3306)/user_db?charset=utf8mb4&amp;parseTime=True&amp;loc=Local</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D">CacheRedis</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">  - </span><span style="color:#85E89D">Host</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">localhost:6379</span></span>
<span class="line"><span style="color:#85E89D">    Type</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">node</span></span></code></pre>
<h3 id="7-è¿è¡ŒæœåŠ¡">7. è¿è¡ŒæœåŠ¡</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># å¯åŠ¨æœåŠ¡</span></span>
<span class="line"><span style="color:#B392F0">go</span><span style="color:#9ECBFF"> run</span><span style="color:#9ECBFF"> user-api.go</span><span style="color:#79B8FF"> -f</span><span style="color:#9ECBFF"> etc/user-api.yaml</span></span></code></pre>
<h2 id="-go-zero-çš„é«˜çº§ç‰¹æ€§">ğŸ”§ go-zero çš„é«˜çº§ç‰¹æ€§</h2>
<h3 id="1-ä¸­é—´ä»¶ç³»ç»Ÿ">1. ä¸­é—´ä»¶ç³»ç»Ÿ</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// è‡ªå®šä¹‰ä¸­é—´ä»¶</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> AuthMiddleware</span><span style="color:#E1E4E8">() </span><span style="color:#B392F0">http</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">HandlerFunc</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">w</span><span style="color:#B392F0"> http</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">ResponseWriter</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">r</span><span style="color:#F97583"> *</span><span style="color:#B392F0">http</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Request</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        token </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> r.Header.</span><span style="color:#B392F0">Get</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;Authorization&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> token </span><span style="color:#F97583">==</span><span style="color:#9ECBFF"> &quot;&quot;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            http.</span><span style="color:#B392F0">Error</span><span style="color:#E1E4E8">(w, </span><span style="color:#9ECBFF">&quot;unauthorized&quot;</span><span style="color:#E1E4E8">, http.StatusUnauthorized)</span></span>
<span class="line"><span style="color:#F97583">            return</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#6A737D">        // éªŒè¯ token</span></span>
<span class="line"><span style="color:#E1E4E8">        r </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> r.</span><span style="color:#B392F0">WithContext</span><span style="color:#E1E4E8">(context.</span><span style="color:#B392F0">WithValue</span><span style="color:#E1E4E8">(r.</span><span style="color:#B392F0">Context</span><span style="color:#E1E4E8">(), </span><span style="color:#9ECBFF">&quot;user_id&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&quot;123&quot;</span><span style="color:#E1E4E8">))</span></span>
<span class="line"><span style="color:#6A737D">        // ç»§ç»­å¤„ç†</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// åœ¨ API æ–‡ä»¶ä¸­ä½¿ç”¨</span></span>
<span class="line"><span style="color:#E1E4E8">service user</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">api {</span></span>
<span class="line"><span style="color:#E1E4E8">    @middleware AuthMiddleware</span></span>
<span class="line"><span style="color:#E1E4E8">    @handler GetUser</span></span>
<span class="line"><span style="color:#E1E4E8">    get </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">api</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">users</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">:id (GetUserReq) returns (GetUserResp)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="2-æ•°æ®åº“æ“ä½œ">2. æ•°æ®åº“æ“ä½œ</h3>
<p><strong>ä¼ ç»Ÿæ–¹å¼</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// æ‰‹å†™ SQL</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> GetUser</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">id</span><span style="color:#F97583"> int64</span><span style="color:#E1E4E8">) (</span><span style="color:#F97583">*</span><span style="color:#B392F0">User</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">error</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    query </span><span style="color:#F97583">:=</span><span style="color:#9ECBFF"> &quot;SELECT id, name, age FROM users WHERE id = ?&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">    row </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> db.</span><span style="color:#B392F0">QueryRow</span><span style="color:#E1E4E8">(query, id)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> user </span><span style="color:#B392F0">User</span></span>
<span class="line"><span style="color:#E1E4E8">    err </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> row.</span><span style="color:#B392F0">Scan</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">user.ID, </span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">user.Name, </span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">user.Age)</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> err </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8">, err</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> &amp;</span><span style="color:#E1E4E8">user, </span><span style="color:#79B8FF">nil</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>go-zero æ–¹å¼</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># ç”Ÿæˆæ•°æ®åº“æ¨¡å‹</span></span>
<span class="line"><span style="color:#B392F0">goctl</span><span style="color:#9ECBFF"> model</span><span style="color:#9ECBFF"> mysql</span><span style="color:#9ECBFF"> ddl</span><span style="color:#79B8FF"> -src</span><span style="color:#9ECBFF"> user.sql</span><span style="color:#79B8FF"> -dir</span><span style="color:#9ECBFF"> .</span><span style="color:#79B8FF"> -c</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># è‡ªåŠ¨ç”Ÿæˆ CRUD æ–¹æ³•</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// ç”Ÿæˆçš„ä»£ç </span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">m </span><span style="color:#F97583">*</span><span style="color:#B392F0">UserModel</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">FindOne</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ctx</span><span style="color:#B392F0"> context</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Context</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">id</span><span style="color:#F97583"> int64</span><span style="color:#E1E4E8">) (</span><span style="color:#F97583">*</span><span style="color:#B392F0">User</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">error</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // è‡ªåŠ¨ç”Ÿæˆçš„æŸ¥è¯¢é€»è¾‘</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">m </span><span style="color:#F97583">*</span><span style="color:#B392F0">UserModel</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Insert</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">ctx</span><span style="color:#B392F0"> context</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Context</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">data</span><span style="color:#F97583"> *</span><span style="color:#B392F0">User</span><span style="color:#E1E4E8">) (</span><span style="color:#F97583">int64</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">error</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // è‡ªåŠ¨ç”Ÿæˆçš„æ’å…¥é€»è¾‘</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="3-ç¼“å­˜é›†æˆ">3. ç¼“å­˜é›†æˆ</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// åœ¨ logic ä¸­ä½¿ç”¨ç¼“å­˜</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">l </span><span style="color:#F97583">*</span><span style="color:#B392F0">GetUserLogic</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">GetUser</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">req</span><span style="color:#F97583"> *</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserReq</span><span style="color:#E1E4E8">) (</span><span style="color:#FFAB70">resp</span><span style="color:#F97583"> *</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserResp</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">err</span><span style="color:#F97583"> error</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // å…ˆä»ç¼“å­˜è·å–</span></span>
<span class="line"><span style="color:#E1E4E8">    cacheKey </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> fmt.</span><span style="color:#B392F0">Sprintf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;user:</span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, req.Id)</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> user </span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserResp</span></span>
<span class="line"><span style="color:#E1E4E8">    err </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> l.svcCtx.Cache.</span><span style="color:#B392F0">Get</span><span style="color:#E1E4E8">(l.ctx, cacheKey, </span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">user)</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> err </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#F97583"> &amp;</span><span style="color:#E1E4E8">user, </span><span style="color:#79B8FF">nil</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // ç¼“å­˜æ²¡æœ‰ï¼Œä»æ•°æ®åº“è·å–</span></span>
<span class="line"><span style="color:#E1E4E8">    dbUser, err </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> l.svcCtx.UserModel.</span><span style="color:#B392F0">FindOne</span><span style="color:#E1E4E8">(l.ctx, req.Id)</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> err </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8">, err</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    resp </span><span style="color:#F97583">=</span><span style="color:#F97583"> &amp;</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserResp</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">        Id:   dbUser.Id,</span></span>
<span class="line"><span style="color:#E1E4E8">        Name: dbUser.Name,</span></span>
<span class="line"><span style="color:#E1E4E8">        Age:  dbUser.Age,</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // è®¾ç½®ç¼“å­˜</span></span>
<span class="line"><span style="color:#E1E4E8">    l.svcCtx.Cache.</span><span style="color:#B392F0">Set</span><span style="color:#E1E4E8">(l.ctx, cacheKey, resp)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> resp, </span><span style="color:#79B8FF">nil</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="4-é™æµå’Œç†”æ–­">4. é™æµå’Œç†”æ–­</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// åœ¨ API æ–‡ä»¶ä¸­é…ç½®é™æµ</span></span>
<span class="line"><span style="color:#E1E4E8">service user</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">api {</span></span>
<span class="line"><span style="color:#E1E4E8">    @handler GetUser</span></span>
<span class="line"><span style="color:#E1E4E8">    get </span><span style="color:#F97583">/</span><span style="color:#E1E4E8">api</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">users</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">:id (GetUserReq) returns (GetUserResp)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®é™æµ</span></span>
<span class="line"><span style="color:#E1E4E8">Name: user</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">api</span></span>
<span class="line"><span style="color:#E1E4E8">Host: </span><span style="color:#FDAEB7;font-style:italic">0.0.0.0</span></span>
<span class="line"><span style="color:#E1E4E8">Port: </span><span style="color:#79B8FF">8888</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">Limit:</span></span>
<span class="line"><span style="color:#E1E4E8">  Rate: </span><span style="color:#79B8FF">1000</span><span style="color:#E1E4E8">  # æ¯ç§’è¯·æ±‚æ•°</span></span>
<span class="line"><span style="color:#E1E4E8">  Burst: </span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">  # çªå‘è¯·æ±‚æ•°</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">Breaker:</span></span>
<span class="line"><span style="color:#E1E4E8">  Threshold: </span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">   # é”™è¯¯é˜ˆå€¼</span></span>
<span class="line"><span style="color:#E1E4E8">  Timeout: </span><span style="color:#FDAEB7;font-style:italic">10s</span><span style="color:#E1E4E8">   # ç†”æ–­æ—¶é—´</span></span></code></pre>
<h3 id="5-é“¾è·¯è¿½è¸ª">5. é“¾è·¯è¿½è¸ª</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// è‡ªåŠ¨é›†æˆ trace</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">l </span><span style="color:#F97583">*</span><span style="color:#B392F0">GetUserLogic</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">GetUser</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">req</span><span style="color:#F97583"> *</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserReq</span><span style="color:#E1E4E8">) (</span><span style="color:#FFAB70">resp</span><span style="color:#F97583"> *</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserResp</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">err</span><span style="color:#F97583"> error</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // è‡ªåŠ¨ç”Ÿæˆ trace span</span></span>
<span class="line"><span style="color:#E1E4E8">    span </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> trace.</span><span style="color:#B392F0">SpanFromContext</span><span style="color:#E1E4E8">(l.ctx)</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> span.</span><span style="color:#B392F0">Finish</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // ä½ çš„ä¸šåŠ¡é€»è¾‘</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> resp, </span><span style="color:#79B8FF">nil</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="ï¸-å¾®æœåŠ¡æ¶æ„å®æˆ˜">ğŸ—ï¸ å¾®æœåŠ¡æ¶æ„å®æˆ˜</h2>
<h3 id="1-æœåŠ¡æ‹†åˆ†">1. æœåŠ¡æ‹†åˆ†</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>user-service/</span></span>
<span class="line"><span>â”œâ”€â”€ user-api/          # API ç½‘å…³</span></span>
<span class="line"><span>â”œâ”€â”€ user-rpc/          # ç”¨æˆ·æœåŠ¡</span></span>
<span class="line"><span>â”œâ”€â”€ order-api/         # è®¢å• API</span></span>
<span class="line"><span>â”œâ”€â”€ order-rpc/         # è®¢å•æœåŠ¡</span></span>
<span class="line"><span>â””â”€â”€ payment-rpc/       # æ”¯ä»˜æœåŠ¡</span></span></code></pre>
<h3 id="2-æœåŠ¡é—´é€šä¿¡">2. æœåŠ¡é—´é€šä¿¡</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// åœ¨ user-api ä¸­è°ƒç”¨ user-rpc</span></span>
<span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> UserApiLogic</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    logx</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Logger</span></span>
<span class="line"><span style="color:#E1E4E8">    ctx    </span><span style="color:#B392F0">context</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Context</span></span>
<span class="line"><span style="color:#E1E4E8">    svcCtx </span><span style="color:#F97583">*</span><span style="color:#B392F0">svc</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">ServiceContext</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">l </span><span style="color:#F97583">*</span><span style="color:#B392F0">UserApiLogic</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">GetUser</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">req</span><span style="color:#F97583"> *</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserReq</span><span style="color:#E1E4E8">) (</span><span style="color:#FFAB70">resp</span><span style="color:#F97583"> *</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserResp</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">err</span><span style="color:#F97583"> error</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // è°ƒç”¨ RPC æœåŠ¡</span></span>
<span class="line"><span style="color:#E1E4E8">    rpcResp, err </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> l.svcCtx.UserRpc.</span><span style="color:#B392F0">GetUser</span><span style="color:#E1E4E8">(l.ctx, </span><span style="color:#F97583">&amp;</span><span style="color:#B392F0">userpb</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserReq</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">        Id: req.Id,</span></span>
<span class="line"><span style="color:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> err </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8">, err</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> &amp;</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserResp</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">        Id:   rpcResp.Id,</span></span>
<span class="line"><span style="color:#E1E4E8">        Name: rpcResp.Name,</span></span>
<span class="line"><span style="color:#E1E4E8">        Age:  rpcResp.Age,</span></span>
<span class="line"><span style="color:#E1E4E8">    }, </span><span style="color:#79B8FF">nil</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="3-é…ç½®ä¸­å¿ƒ">3. é…ç½®ä¸­å¿ƒ</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#6A737D"># etcd é…ç½®</span></span>
<span class="line"><span style="color:#85E89D">Etcd</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#85E89D">  Hosts</span><span style="color:#E1E4E8">:</span></span>
<span class="line"><span style="color:#E1E4E8">    - </span><span style="color:#9ECBFF">127.0.0.1:2379</span></span>
<span class="line"><span style="color:#85E89D">  Key</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">user.rpc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># æœåŠ¡å‘ç°</span></span>
<span class="line"><span style="color:#85E89D">Target</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">etcd://127.0.0.1:2379/user.rpc</span></span></code></pre>
<h2 id="-å®é™…é¡¹ç›®ç»éªŒ">ğŸ¯ å®é™…é¡¹ç›®ç»éªŒ</h2>
<h3 id="1-é¡¹ç›®ç»“æ„æœ€ä½³å®è·µ">1. é¡¹ç›®ç»“æ„æœ€ä½³å®è·µ</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="plaintext"><code><span class="line"><span>myproject/</span></span>
<span class="line"><span>â”œâ”€â”€ api/              # API å®šä¹‰</span></span>
<span class="line"><span>â”œâ”€â”€ rpc/              # RPC æœåŠ¡</span></span>
<span class="line"><span>â”œâ”€â”€ shared/           # å…±äº«ä»£ç </span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ constants/    # å¸¸é‡</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ errors/       # é”™è¯¯å®šä¹‰</span></span>
<span class="line"><span>â”‚   â””â”€â”€ utils/        # å·¥å…·å‡½æ•°</span></span>
<span class="line"><span>â”œâ”€â”€ deploy/           # éƒ¨ç½²é…ç½®</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ docker/       # Docker é…ç½®</span></span>
<span class="line"><span>â”‚   â””â”€â”€ k8s/          # Kubernetes é…ç½®</span></span>
<span class="line"><span>â””â”€â”€ scripts/          # è„šæœ¬æ–‡ä»¶</span></span></code></pre>
<h3 id="2-é”™è¯¯å¤„ç†">2. é”™è¯¯å¤„ç†</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// å®šä¹‰é”™è¯¯ç </span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#79B8FF">    ErrUserNotFound</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> &quot;user not found&quot;</span></span>
<span class="line"><span style="color:#79B8FF">    ErrInvalidParam</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> &quot;invalid parameter&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// åœ¨ logic ä¸­ä½¿ç”¨</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">l </span><span style="color:#F97583">*</span><span style="color:#B392F0">GetUserLogic</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">GetUser</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">req</span><span style="color:#F97583"> *</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserReq</span><span style="color:#E1E4E8">) (</span><span style="color:#FFAB70">resp</span><span style="color:#F97583"> *</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserResp</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">err</span><span style="color:#F97583"> error</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> req.Id </span><span style="color:#F97583">&lt;=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8">, errors.</span><span style="color:#B392F0">New</span><span style="color:#E1E4E8">(ErrInvalidParam)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    user, err </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> l.svcCtx.UserModel.</span><span style="color:#B392F0">FindOne</span><span style="color:#E1E4E8">(l.ctx, req.Id)</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> err </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> err </span><span style="color:#F97583">==</span><span style="color:#E1E4E8"> sql.ErrNoRows {</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8">, errors.</span><span style="color:#B392F0">New</span><span style="color:#E1E4E8">(ErrUserNotFound)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8">, err</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> &amp;</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserResp</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">        Id:   user.Id,</span></span>
<span class="line"><span style="color:#E1E4E8">        Name: user.Name,</span></span>
<span class="line"><span style="color:#E1E4E8">        Age:  user.Age,</span></span>
<span class="line"><span style="color:#E1E4E8">    }, </span><span style="color:#79B8FF">nil</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="3-æ—¥å¿—å’Œç›‘æ§">3. æ—¥å¿—å’Œç›‘æ§</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// ç»“æ„åŒ–æ—¥å¿—</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">l </span><span style="color:#F97583">*</span><span style="color:#B392F0">CreateUserLogic</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">CreateUser</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">req</span><span style="color:#F97583"> *</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">CreateUserReq</span><span style="color:#E1E4E8">) (</span><span style="color:#FFAB70">resp</span><span style="color:#F97583"> *</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">CreateUserResp</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">err</span><span style="color:#F97583"> error</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    logx.</span><span style="color:#B392F0">WithContext</span><span style="color:#E1E4E8">(l.ctx).</span><span style="color:#B392F0">Infof</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;creating user: name=</span><span style="color:#79B8FF">%s</span><span style="color:#9ECBFF">, age=</span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, req.Name, req.Age)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // ä¸šåŠ¡é€»è¾‘</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    logx.</span><span style="color:#B392F0">WithContext</span><span style="color:#E1E4E8">(l.ctx).</span><span style="color:#B392F0">Infof</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;user created: id=</span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, resp.Id)</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> resp, </span><span style="color:#79B8FF">nil</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="-æ€§èƒ½ä¼˜åŒ–æŠ€å·§">ğŸš€ æ€§èƒ½ä¼˜åŒ–æŠ€å·§</h2>
<h3 id="1-æ•°æ®åº“ä¼˜åŒ–">1. æ•°æ®åº“ä¼˜åŒ–</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// ä½¿ç”¨è¿æ¥æ± </span></span>
<span class="line"><span style="color:#E1E4E8">MySQL:</span></span>
<span class="line"><span style="color:#E1E4E8">  DataSource: root:password@</span><span style="color:#B392F0">tcp</span><span style="color:#E1E4E8">(localhost:</span><span style="color:#79B8FF">3306</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">user_db?charset</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">utf8mb4</span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">parseTime</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">True</span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">loc</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">Local</span></span>
<span class="line"><span style="color:#E1E4E8">  MaxOpenConns: </span><span style="color:#79B8FF">100</span></span>
<span class="line"><span style="color:#E1E4E8">  MaxIdleConns: </span><span style="color:#79B8FF">10</span></span>
<span class="line"><span style="color:#E1E4E8">  ConnMaxLifetime: </span><span style="color:#FDAEB7;font-style:italic">3600s</span></span></code></pre>
<h3 id="2-ç¼“å­˜ç­–ç•¥">2. ç¼“å­˜ç­–ç•¥</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// å¤šçº§ç¼“å­˜</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">l </span><span style="color:#F97583">*</span><span style="color:#B392F0">GetUserLogic</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">GetUser</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">req</span><span style="color:#F97583"> *</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserReq</span><span style="color:#E1E4E8">) (</span><span style="color:#FFAB70">resp</span><span style="color:#F97583"> *</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserResp</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">err</span><span style="color:#F97583"> error</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // L1: æœ¬åœ°ç¼“å­˜</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> user, ok </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> l.localCache.</span><span style="color:#B392F0">Get</span><span style="color:#E1E4E8">(req.Id); ok {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> user.(</span><span style="color:#F97583">*</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserResp</span><span style="color:#E1E4E8">), </span><span style="color:#79B8FF">nil</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // L2: Redis ç¼“å­˜</span></span>
<span class="line"><span style="color:#E1E4E8">    cacheKey </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> fmt.</span><span style="color:#B392F0">Sprintf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;user:</span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF">&quot;</span><span style="color:#E1E4E8">, req.Id)</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> user </span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserResp</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> err </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> l.svcCtx.Cache.</span><span style="color:#B392F0">Get</span><span style="color:#E1E4E8">(l.ctx, cacheKey, </span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">user); err </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        l.localCache.</span><span style="color:#B392F0">Set</span><span style="color:#E1E4E8">(req.Id, </span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">user, time.Minute</span><span style="color:#F97583">*</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#F97583"> &amp;</span><span style="color:#E1E4E8">user, </span><span style="color:#79B8FF">nil</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // L3: æ•°æ®åº“</span></span>
<span class="line"><span style="color:#E1E4E8">    dbUser, err </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> l.svcCtx.UserModel.</span><span style="color:#B392F0">FindOne</span><span style="color:#E1E4E8">(l.ctx, req.Id)</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> err </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> nil</span><span style="color:#E1E4E8">, err</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    resp </span><span style="color:#F97583">=</span><span style="color:#F97583"> &amp;</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserResp</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">        Id:   dbUser.Id,</span></span>
<span class="line"><span style="color:#E1E4E8">        Name: dbUser.Name,</span></span>
<span class="line"><span style="color:#E1E4E8">        Age:  dbUser.Age,</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // å›å¡«ç¼“å­˜</span></span>
<span class="line"><span style="color:#E1E4E8">    l.svcCtx.Cache.</span><span style="color:#B392F0">Set</span><span style="color:#E1E4E8">(l.ctx, cacheKey, resp, time.Hour)</span></span>
<span class="line"><span style="color:#E1E4E8">    l.localCache.</span><span style="color:#B392F0">Set</span><span style="color:#E1E4E8">(req.Id, resp, time.Minute</span><span style="color:#F97583">*</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> resp, </span><span style="color:#79B8FF">nil</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="3-å¹¶å‘å¤„ç†">3. å¹¶å‘å¤„ç†</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6A737D">// ä½¿ç”¨ goroutine å¤„ç†å¹¶å‘ä»»åŠ¡</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">l </span><span style="color:#F97583">*</span><span style="color:#B392F0">GetUserLogic</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">GetUserWithOrders</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">req</span><span style="color:#F97583"> *</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserReq</span><span style="color:#E1E4E8">) (</span><span style="color:#FFAB70">resp</span><span style="color:#F97583"> *</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserWithOrdersResp</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">err</span><span style="color:#F97583"> error</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> wg </span><span style="color:#B392F0">sync</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">WaitGroup</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> user </span><span style="color:#F97583">*</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserResp</span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> orders []</span><span style="color:#F97583">*</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Order</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // å¹¶å‘è·å–ç”¨æˆ·ä¿¡æ¯å’Œè®¢å•</span></span>
<span class="line"><span style="color:#E1E4E8">    wg.</span><span style="color:#B392F0">Add</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        defer</span><span style="color:#E1E4E8"> wg.</span><span style="color:#B392F0">Done</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">        user, _ </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> l.</span><span style="color:#B392F0">GetUser</span><span style="color:#E1E4E8">(req)</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    go</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        defer</span><span style="color:#E1E4E8"> wg.</span><span style="color:#B392F0">Done</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">        orders, _ </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> l.</span><span style="color:#B392F0">GetUserOrders</span><span style="color:#E1E4E8">(req.Id)</span></span>
<span class="line"><span style="color:#E1E4E8">    }()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    wg.</span><span style="color:#B392F0">Wait</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> &amp;</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserWithOrdersResp</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">        User:   user,</span></span>
<span class="line"><span style="color:#E1E4E8">        Orders: orders,</span></span>
<span class="line"><span style="color:#E1E4E8">    }, </span><span style="color:#79B8FF">nil</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="-æµ‹è¯•ç­–ç•¥">ğŸ§ª æµ‹è¯•ç­–ç•¥</h2>
<h3 id="1-å•å…ƒæµ‹è¯•">1. å•å…ƒæµ‹è¯•</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> TestGetUserLogic_GetUser</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">t</span><span style="color:#F97583"> *</span><span style="color:#B392F0">testing</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    ctrl </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> gomock.</span><span style="color:#B392F0">NewController</span><span style="color:#E1E4E8">(t)</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> ctrl.</span><span style="color:#B392F0">Finish</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    mockUserModel </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> mock.</span><span style="color:#B392F0">NewMockUserModel</span><span style="color:#E1E4E8">(ctrl)</span></span>
<span class="line"><span style="color:#E1E4E8">    mockUserModel.</span><span style="color:#B392F0">EXPECT</span><span style="color:#E1E4E8">().</span></span>
<span class="line"><span style="color:#B392F0">        FindOne</span><span style="color:#E1E4E8">(gomock.</span><span style="color:#B392F0">Any</span><span style="color:#E1E4E8">(), </span><span style="color:#F97583">int64</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)).</span></span>
<span class="line"><span style="color:#B392F0">        Return</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&amp;</span><span style="color:#B392F0">model</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">User</span><span style="color:#E1E4E8">{Id: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, Name: </span><span style="color:#9ECBFF">&quot;Alice&quot;</span><span style="color:#E1E4E8">, Age: </span><span style="color:#79B8FF">25</span><span style="color:#E1E4E8">}, </span><span style="color:#79B8FF">nil</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    l </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> NewGetUserLogic</span><span style="color:#E1E4E8">(context.</span><span style="color:#B392F0">Background</span><span style="color:#E1E4E8">(), </span><span style="color:#F97583">&amp;</span><span style="color:#B392F0">svc</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">ServiceContext</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">        UserModel: mockUserModel,</span></span>
<span class="line"><span style="color:#E1E4E8">    })</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    resp, err </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> l.</span><span style="color:#B392F0">GetUser</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&amp;</span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserReq</span><span style="color:#E1E4E8">{Id: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">})</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    assert.</span><span style="color:#B392F0">NoError</span><span style="color:#E1E4E8">(t, err)</span></span>
<span class="line"><span style="color:#E1E4E8">    assert.</span><span style="color:#B392F0">Equal</span><span style="color:#E1E4E8">(t, </span><span style="color:#9ECBFF">&quot;Alice&quot;</span><span style="color:#E1E4E8">, resp.Name)</span></span>
<span class="line"><span style="color:#E1E4E8">    assert.</span><span style="color:#B392F0">Equal</span><span style="color:#E1E4E8">(t, </span><span style="color:#79B8FF">25</span><span style="color:#E1E4E8">, resp.Age)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="2-é›†æˆæµ‹è¯•">2. é›†æˆæµ‹è¯•</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> TestUserAPI_GetUser</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">t</span><span style="color:#F97583"> *</span><span style="color:#B392F0">testing</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    server </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> httptest.</span><span style="color:#B392F0">NewServer</span><span style="color:#E1E4E8">(handler)</span></span>
<span class="line"><span style="color:#F97583">    defer</span><span style="color:#E1E4E8"> server.</span><span style="color:#B392F0">Close</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    resp, err </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> http.</span><span style="color:#B392F0">Get</span><span style="color:#E1E4E8">(server.URL </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> &quot;/api/users/1&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    assert.</span><span style="color:#B392F0">NoError</span><span style="color:#E1E4E8">(t, err)</span></span>
<span class="line"><span style="color:#E1E4E8">    assert.</span><span style="color:#B392F0">Equal</span><span style="color:#E1E4E8">(t, http.StatusOK, resp.StatusCode)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    var</span><span style="color:#E1E4E8"> result </span><span style="color:#B392F0">types</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">GetUserResp</span></span>
<span class="line"><span style="color:#E1E4E8">    json.</span><span style="color:#B392F0">NewDecoder</span><span style="color:#E1E4E8">(resp.Body).</span><span style="color:#B392F0">Decode</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">&amp;</span><span style="color:#E1E4E8">result)</span></span>
<span class="line"><span style="color:#E1E4E8">    assert.</span><span style="color:#B392F0">Equal</span><span style="color:#E1E4E8">(t, </span><span style="color:#9ECBFF">&quot;Alice&quot;</span><span style="color:#E1E4E8">, result.Name)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="-æ€»ç»“ä¸€ä¸‹">ğŸ¤” æ€»ç»“ä¸€ä¸‹</h2>
<p>go-zero ç¡®å®è®©å¾®æœåŠ¡å¼€å‘å˜å¾—ç®€å•äº†å¾ˆå¤šï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸­å°å‹é¡¹ç›®ã€‚</p>
<p><strong>go-zero çš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>ğŸš€ å¼€å‘æ•ˆç‡é«˜ï¼Œä»£ç ç”Ÿæˆå¾ˆå¼ºå¤§</li>
<li>ğŸ”§ å·¥å…·é“¾å®Œæ•´ï¼Œä»å¼€å‘åˆ°éƒ¨ç½²éƒ½æœ‰æ”¯æŒ</li>
<li>ğŸ“¦ å†…ç½®åŠŸèƒ½ä¸°å¯Œï¼Œç¼“å­˜ã€é™æµã€ç†”æ–­éƒ½æœ‰</li>
<li>ğŸ›¡ï¸ ç”Ÿäº§å°±ç»ªï¼Œå­—èŠ‚è·³åŠ¨å†…éƒ¨å¤§é‡ä½¿ç”¨</li>
<li>ğŸ“– æ–‡æ¡£é½å…¨ï¼Œç¤¾åŒºæ´»è·ƒ</li>
</ul>
<p><strong>ä¸å¤ªçˆ½çš„åœ°æ–¹</strong>ï¼š</p>
<ul>
<li>ğŸ“ å­¦ä¹ æ›²çº¿ç›¸å¯¹é™¡å³­ï¼Œæ¦‚å¿µæ¯”è¾ƒå¤š</li>
<li>ğŸ” è°ƒè¯•ç›¸å¯¹å¤æ‚ï¼Œç‰¹åˆ«æ˜¯ RPC è°ƒç”¨</li>
<li>ğŸ“Š ç›‘æ§å’Œæ—¥å¿—éœ€è¦é¢å¤–é…ç½®</li>
<li>ğŸ› é”™è¯¯å¤„ç†æœ‰æ—¶å€™ä¸å¤Ÿç›´è§‚</li>
</ul>
<p><strong>ä½¿ç”¨å»ºè®®</strong>ï¼š</p>
<ol>
<li><strong>å…ˆä»å°é¡¹ç›®å¼€å§‹</strong>ï¼šç†Ÿæ‚‰åŸºæœ¬æ¦‚å¿µå’Œå·¥å…·</li>
<li><strong>å¤šçœ‹å®˜æ–¹ç¤ºä¾‹</strong>ï¼šç†è§£æœ€ä½³å®è·µ</li>
<li><strong>åˆç†ä½¿ç”¨ä»£ç ç”Ÿæˆ</strong>ï¼šä¸è¦è¿‡åº¦ä¾èµ–</li>
<li><strong>æ³¨æ„æ€§èƒ½è°ƒä¼˜</strong>ï¼šç¼“å­˜ã€è¿æ¥æ± ç­‰é…ç½®</li>
<li><strong>åšå¥½ç›‘æ§å’Œæ—¥å¿—</strong>ï¼šç”Ÿäº§ç¯å¢ƒå¾ˆé‡è¦</li>
</ol>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>ğŸ¢ ä¸­å°å‹å¾®æœåŠ¡é¡¹ç›®</li>
<li>ğŸš€ éœ€è¦å¿«é€Ÿå¼€å‘çš„é¡¹ç›®</li>
<li>ğŸ“± é«˜å¹¶å‘åœºæ™¯</li>
<li>ğŸ”§ æœ‰ä¸€å®š Go åŸºç¡€</li>
</ul> </div> </div> <!-- æ–‡ç« åº•éƒ¨å¯¼èˆª --> <div class="mt-8 flex justify-between items-center" data-astro-cid-gjtny2mx> <a href="/my-blog/" class="dark-btn-outline px-6 py-3 rounded-lg text-sm" data-astro-cid-gjtny2mx>
â† è¿”å›é¦–é¡µ
</a> <div class="flex space-x-4" data-astro-cid-gjtny2mx> <button class="dark-btn px-6 py-3 rounded-lg text-sm" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" data-astro-cid-gjtny2mx>
â†‘ å›åˆ°é¡¶éƒ¨
</button> </div> </div> </article> <!-- ä¾§è¾¹æ  --> <aside class="lg:col-span-1" data-astro-cid-gjtny2mx> <div class="sticky top-24 space-y-6" data-astro-cid-gjtny2mx> <!-- æ–‡ç« ä¿¡æ¯å¡ç‰‡ --> <div class="dark-card p-6 rounded-xl" data-astro-cid-gjtny2mx> <h3 class="font-bold text-white mb-4 neon-text" data-astro-cid-gjtny2mx>æ–‡ç« ä¿¡æ¯</h3> <div class="space-y-4 text-sm" data-astro-cid-gjtny2mx> <div class="flex justify-between items-center" data-astro-cid-gjtny2mx> <span class="text-gray-400" data-astro-cid-gjtny2mx>å‘å¸ƒæ—¶é—´</span> <span class="text-white font-mono" data-astro-cid-gjtny2mx>2024/12/28</span> </div> <div class="flex justify-between items-center" data-astro-cid-gjtny2mx> <span class="text-gray-400" data-astro-cid-gjtny2mx>åˆ†ç±»</span> <span class="neon-text font-bold" data-astro-cid-gjtny2mx>åç«¯å¼€å‘</span> </div> <div data-astro-cid-gjtny2mx> <span class="text-gray-400 block mb-3" data-astro-cid-gjtny2mx>æ ‡ç­¾</span> <div class="flex flex-wrap gap-2" data-astro-cid-gjtny2mx> <span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> Go </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> Golang </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> go-zero </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> å¾®æœåŠ¡ </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> åç«¯æ¡†æ¶ </span><span class="px-3 py-1 bg-neon-green/20 text-neon-green rounded-full text-xs border border-neon-green/40" data-astro-cid-gjtny2mx> åç«¯å¼€å‘ </span> </div> </div> </div> </div> <!-- ç›®å½• --> <div class="dark-card p-6 rounded-xl" data-astro-cid-gjtny2mx> <h3 class="font-bold text-white mb-4 neon-text" data-astro-cid-gjtny2mx>ç›®å½•</h3> <div class="text-sm space-y-3" data-astro-cid-gjtny2mx> <a href="#" class="block text-gray-300 hover:neon-text transition-all duration-300 border-l-2 border-transparent hover:border-neon-green pl-3" data-astro-cid-gjtny2mx>
â€¢ æ–‡ç« å¼€å§‹
</a> <a href="#" class="block text-gray-300 hover:neon-text transition-all duration-300 border-l-2 border-transparent hover:border-neon-green pl-3" data-astro-cid-gjtny2mx>
â€¢ ä¸»è¦å†…å®¹
</a> <a href="#" class="block text-gray-300 hover:neon-text transition-all duration-300 border-l-2 border-transparent hover:border-neon-green pl-3" data-astro-cid-gjtny2mx>
â€¢ æ€»ç»“
</a> </div> </div> <!-- ç›¸å…³æ–‡ç«  --> <div class="dark-card p-6 rounded-xl" data-astro-cid-gjtny2mx> <h3 class="font-bold text-white mb-4 neon-text" data-astro-cid-gjtny2mx>ç›¸å…³æ–‡ç« </h3> <div class="space-y-4 text-sm" data-astro-cid-gjtny2mx> <a href="/my-blog/posts/typescript-tips" class="block group border border-gray-700/50 rounded-lg p-3 hover:border-neon-green/40 transition-all duration-300" data-astro-cid-gjtny2mx> <span class="text-gray-300 group-hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>
TypeScript å°æŠ€å·§
</span> <div class="text-xs text-gray-500 mt-1" data-astro-cid-gjtny2mx>ç¼–ç¨‹è¯­è¨€</div> </a> <a href="/my-blog/posts/hello-astro" class="block group border border-gray-700/50 rounded-lg p-3 hover:border-neon-green/40 transition-all duration-300" data-astro-cid-gjtny2mx> <span class="text-gray-300 group-hover:neon-text transition-all duration-300 font-medium" data-astro-cid-gjtny2mx>
Hello Astro
</span> <div class="text-xs text-gray-500 mt-1" data-astro-cid-gjtny2mx>æ¡†æ¶</div> </a> </div> </div> </div> </aside> </div>  </main> <footer class="mt-20 border-t border-neon-green/30 bg-black/60 backdrop-blur-sm"> <div class="max-w-6xl mx-auto px-4 py-12"> <!-- å±…ä¸­çš„å“ç‰Œä¿¡æ¯ --> <div class="text-center mb-8"> <div class="flex items-center justify-center space-x-4 mb-6"> <div class="w-16 h-16 group"> <!-- ä»£ç é£æ ¼Logoå›¾æ ‡ - åŸºäºç¬¬ä¸€ä¸ªè®¾è®¡æ–¹æ¡ˆ --><svg viewBox="0 0 48 48" class="w-full h-full" data-astro-cid-hit3dubr> <defs data-astro-cid-hit3dubr> <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%" data-astro-cid-hit3dubr> <stop offset="0%" style="stop-color:#00ff88;stop-opacity:1" data-astro-cid-hit3dubr></stop> <stop offset="100%" style="stop-color:#3742fa;stop-opacity:1" data-astro-cid-hit3dubr></stop> </linearGradient> <filter id="logoGlow" data-astro-cid-hit3dubr> <feGaussianBlur stdDeviation="2" result="coloredBlur" data-astro-cid-hit3dubr></feGaussianBlur> <feMerge data-astro-cid-hit3dubr> <feMergeNode in="coloredBlur" data-astro-cid-hit3dubr></feMergeNode> <feMergeNode in="SourceGraphic" data-astro-cid-hit3dubr></feMergeNode> </feMerge> </filter> </defs> <!-- å¤–æ¡† --> <rect x="2" y="2" width="44" height="44" fill="none" stroke="url(#logoGrad)" stroke-width="2" rx="8" filter="url(#logoGlow)" class="group-hover:stroke-width-3 transition-all duration-300" data-astro-cid-hit3dubr></rect> <!-- å­—æ¯Fçš„ä»£ç é£æ ¼è®¾è®¡ --> <path d="M12 12 L32 12 M12 12 L12 36 M12 24 L28 24" stroke="#00ff88" stroke-width="3" stroke-linecap="round" fill="none" filter="url(#logoGlow)" class="group-hover:stroke-white transition-all duration-300" data-astro-cid-hit3dubr></path> <!-- è£…é¥°ç‚¹ --> <circle cx="36" cy="16" r="2" fill="#00ff88" class="animate-pulse group-hover:fill-white transition-all duration-300" data-astro-cid-hit3dubr></circle> <circle cx="36" cy="28" r="1.5" fill="#3742fa" class="animate-pulse group-hover:fill-white transition-all duration-300" style="animation-delay: 0.5s" data-astro-cid-hit3dubr></circle> </svg>  </div> <span class="font-black text-3xl neon-text tracking-wider">MR.FENG</span> </div> <p class="description-text text-xl leading-relaxed max-w-2xl mx-auto">
ç¼–ç¨‹ä¸ä»…æ˜¯ç§‘å­¦ï¼Œä¹Ÿæ˜¯è‰ºæœ¯<br>
åœ¨ä»£ç ä¸­æ¢ç´¢åˆ›æ–°ï¼Œåœ¨æŠ€æœ¯ä¸­å‘ç°ç¾å­¦
</p> <!-- è£…é¥°æ€§å…ƒç´  --> <div class="flex justify-center items-center space-x-8 mt-8"> <div class="w-16 h-px bg-gradient-to-r from-transparent to-neon-green"></div> <div class="w-3 h-3 border-2 border-neon-green bg-neon-green/20 rounded-full animate-pulse"></div> <div class="w-16 h-px bg-gradient-to-l from-transparent to-neon-green"></div> </div> </div> <!-- åˆ†å‰²çº¿ --> <div class="h-px bg-gradient-to-r from-transparent via-neon-green/50 to-transparent mb-6"></div> <!-- åº•éƒ¨ä¿¡æ¯ --> <div class="flex flex-col md:flex-row justify-between items-center text-sm text-gray-400"> <p>
Â© 2025 Mr. Feng â€¢
<span class="neon-text">Powered by Astro</span> </p> <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ --> <div class="flex items-center space-x-2 mt-4 md:mt-0"> <div class="w-3 h-3 bg-neon-green rounded-full animate-pulse"></div> <span class="text-xs text-gray-500">SYSTEM ONLINE</span> </div> </div> </div> <!-- åº•éƒ¨å‘å…‰æ•ˆæœ --> <div class="h-px bg-gradient-to-r from-transparent via-neon-green to-transparent opacity-60"></div> </footer> <!-- å¢å¼ºçš„ç²’å­ç”Ÿæˆè„šæœ¬ --> <script type="module">function o(){const e=document.getElementById("particles");if(!e)return;const n=40;for(let a=0;a<n;a++){const t=document.createElement("div");t.className="particle",t.style.left=Math.random()*100+"%",t.style.top=Math.random()*100+"%",t.style.animationDelay=Math.random()*8+"s",t.style.animationDuration=Math.random()*4+6+"s",e.appendChild(t)}}document.addEventListener("DOMContentLoaded",o);</script> </body> </html> 